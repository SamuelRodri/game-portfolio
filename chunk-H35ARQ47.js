import{Aa as Ys,Ba as Xs,Ca as Hl,Da as Zs,Ea as Ct,a as ue,b as xn,d as ke,e as p,f as Wt,g as $l,h as De,j as Ue,la as $s,ma as Or,n as zl,na as zs,o as Bs,oa as Gs,pa as Ks,qa as Gl,ra as Kl,sa as Ws,ta as Zo,ua as Ve,va as Hs,wa as Ye,xa as Wl,ya as Qs,za as Js}from"./chunk-JT6ALP74.js";var Ql=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Jl={};var ct,ea;(function(){var n;function e(T,y){function b(){}b.prototype=y.prototype,T.F=y.prototype,T.prototype=new b,T.prototype.constructor=T,T.D=function(I,E,P){for(var v=Array(arguments.length-2),xe=2;xe<arguments.length;xe++)v[xe-2]=arguments[xe];return y.prototype[E].apply(I,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,y,b){b||(b=0);let I=Array(16);if(typeof y=="string")for(var E=0;E<16;++E)I[E]=y.charCodeAt(b++)|y.charCodeAt(b++)<<8|y.charCodeAt(b++)<<16|y.charCodeAt(b++)<<24;else for(E=0;E<16;++E)I[E]=y[b++]|y[b++]<<8|y[b++]<<16|y[b++]<<24;y=T.g[0],b=T.g[1],E=T.g[2];let P=T.g[3],v;v=y+(P^b&(E^P))+I[0]+3614090360&4294967295,y=b+(v<<7&4294967295|v>>>25),v=P+(E^y&(b^E))+I[1]+3905402710&4294967295,P=y+(v<<12&4294967295|v>>>20),v=E+(b^P&(y^b))+I[2]+606105819&4294967295,E=P+(v<<17&4294967295|v>>>15),v=b+(y^E&(P^y))+I[3]+3250441966&4294967295,b=E+(v<<22&4294967295|v>>>10),v=y+(P^b&(E^P))+I[4]+4118548399&4294967295,y=b+(v<<7&4294967295|v>>>25),v=P+(E^y&(b^E))+I[5]+1200080426&4294967295,P=y+(v<<12&4294967295|v>>>20),v=E+(b^P&(y^b))+I[6]+2821735955&4294967295,E=P+(v<<17&4294967295|v>>>15),v=b+(y^E&(P^y))+I[7]+4249261313&4294967295,b=E+(v<<22&4294967295|v>>>10),v=y+(P^b&(E^P))+I[8]+1770035416&4294967295,y=b+(v<<7&4294967295|v>>>25),v=P+(E^y&(b^E))+I[9]+2336552879&4294967295,P=y+(v<<12&4294967295|v>>>20),v=E+(b^P&(y^b))+I[10]+4294925233&4294967295,E=P+(v<<17&4294967295|v>>>15),v=b+(y^E&(P^y))+I[11]+2304563134&4294967295,b=E+(v<<22&4294967295|v>>>10),v=y+(P^b&(E^P))+I[12]+1804603682&4294967295,y=b+(v<<7&4294967295|v>>>25),v=P+(E^y&(b^E))+I[13]+4254626195&4294967295,P=y+(v<<12&4294967295|v>>>20),v=E+(b^P&(y^b))+I[14]+2792965006&4294967295,E=P+(v<<17&4294967295|v>>>15),v=b+(y^E&(P^y))+I[15]+1236535329&4294967295,b=E+(v<<22&4294967295|v>>>10),v=y+(E^P&(b^E))+I[1]+4129170786&4294967295,y=b+(v<<5&4294967295|v>>>27),v=P+(b^E&(y^b))+I[6]+3225465664&4294967295,P=y+(v<<9&4294967295|v>>>23),v=E+(y^b&(P^y))+I[11]+643717713&4294967295,E=P+(v<<14&4294967295|v>>>18),v=b+(P^y&(E^P))+I[0]+3921069994&4294967295,b=E+(v<<20&4294967295|v>>>12),v=y+(E^P&(b^E))+I[5]+3593408605&4294967295,y=b+(v<<5&4294967295|v>>>27),v=P+(b^E&(y^b))+I[10]+38016083&4294967295,P=y+(v<<9&4294967295|v>>>23),v=E+(y^b&(P^y))+I[15]+3634488961&4294967295,E=P+(v<<14&4294967295|v>>>18),v=b+(P^y&(E^P))+I[4]+3889429448&4294967295,b=E+(v<<20&4294967295|v>>>12),v=y+(E^P&(b^E))+I[9]+568446438&4294967295,y=b+(v<<5&4294967295|v>>>27),v=P+(b^E&(y^b))+I[14]+3275163606&4294967295,P=y+(v<<9&4294967295|v>>>23),v=E+(y^b&(P^y))+I[3]+4107603335&4294967295,E=P+(v<<14&4294967295|v>>>18),v=b+(P^y&(E^P))+I[8]+1163531501&4294967295,b=E+(v<<20&4294967295|v>>>12),v=y+(E^P&(b^E))+I[13]+2850285829&4294967295,y=b+(v<<5&4294967295|v>>>27),v=P+(b^E&(y^b))+I[2]+4243563512&4294967295,P=y+(v<<9&4294967295|v>>>23),v=E+(y^b&(P^y))+I[7]+1735328473&4294967295,E=P+(v<<14&4294967295|v>>>18),v=b+(P^y&(E^P))+I[12]+2368359562&4294967295,b=E+(v<<20&4294967295|v>>>12),v=y+(b^E^P)+I[5]+4294588738&4294967295,y=b+(v<<4&4294967295|v>>>28),v=P+(y^b^E)+I[8]+2272392833&4294967295,P=y+(v<<11&4294967295|v>>>21),v=E+(P^y^b)+I[11]+1839030562&4294967295,E=P+(v<<16&4294967295|v>>>16),v=b+(E^P^y)+I[14]+4259657740&4294967295,b=E+(v<<23&4294967295|v>>>9),v=y+(b^E^P)+I[1]+2763975236&4294967295,y=b+(v<<4&4294967295|v>>>28),v=P+(y^b^E)+I[4]+1272893353&4294967295,P=y+(v<<11&4294967295|v>>>21),v=E+(P^y^b)+I[7]+4139469664&4294967295,E=P+(v<<16&4294967295|v>>>16),v=b+(E^P^y)+I[10]+3200236656&4294967295,b=E+(v<<23&4294967295|v>>>9),v=y+(b^E^P)+I[13]+681279174&4294967295,y=b+(v<<4&4294967295|v>>>28),v=P+(y^b^E)+I[0]+3936430074&4294967295,P=y+(v<<11&4294967295|v>>>21),v=E+(P^y^b)+I[3]+3572445317&4294967295,E=P+(v<<16&4294967295|v>>>16),v=b+(E^P^y)+I[6]+76029189&4294967295,b=E+(v<<23&4294967295|v>>>9),v=y+(b^E^P)+I[9]+3654602809&4294967295,y=b+(v<<4&4294967295|v>>>28),v=P+(y^b^E)+I[12]+3873151461&4294967295,P=y+(v<<11&4294967295|v>>>21),v=E+(P^y^b)+I[15]+530742520&4294967295,E=P+(v<<16&4294967295|v>>>16),v=b+(E^P^y)+I[2]+3299628645&4294967295,b=E+(v<<23&4294967295|v>>>9),v=y+(E^(b|~P))+I[0]+4096336452&4294967295,y=b+(v<<6&4294967295|v>>>26),v=P+(b^(y|~E))+I[7]+1126891415&4294967295,P=y+(v<<10&4294967295|v>>>22),v=E+(y^(P|~b))+I[14]+2878612391&4294967295,E=P+(v<<15&4294967295|v>>>17),v=b+(P^(E|~y))+I[5]+4237533241&4294967295,b=E+(v<<21&4294967295|v>>>11),v=y+(E^(b|~P))+I[12]+1700485571&4294967295,y=b+(v<<6&4294967295|v>>>26),v=P+(b^(y|~E))+I[3]+2399980690&4294967295,P=y+(v<<10&4294967295|v>>>22),v=E+(y^(P|~b))+I[10]+4293915773&4294967295,E=P+(v<<15&4294967295|v>>>17),v=b+(P^(E|~y))+I[1]+2240044497&4294967295,b=E+(v<<21&4294967295|v>>>11),v=y+(E^(b|~P))+I[8]+1873313359&4294967295,y=b+(v<<6&4294967295|v>>>26),v=P+(b^(y|~E))+I[15]+4264355552&4294967295,P=y+(v<<10&4294967295|v>>>22),v=E+(y^(P|~b))+I[6]+2734768916&4294967295,E=P+(v<<15&4294967295|v>>>17),v=b+(P^(E|~y))+I[13]+1309151649&4294967295,b=E+(v<<21&4294967295|v>>>11),v=y+(E^(b|~P))+I[4]+4149444226&4294967295,y=b+(v<<6&4294967295|v>>>26),v=P+(b^(y|~E))+I[11]+3174756917&4294967295,P=y+(v<<10&4294967295|v>>>22),v=E+(y^(P|~b))+I[2]+718787259&4294967295,E=P+(v<<15&4294967295|v>>>17),v=b+(P^(E|~y))+I[9]+3951481745&4294967295,T.g[0]=T.g[0]+y&4294967295,T.g[1]=T.g[1]+(E+(v<<21&4294967295|v>>>11))&4294967295,T.g[2]=T.g[2]+E&4294967295,T.g[3]=T.g[3]+P&4294967295}r.prototype.v=function(T,y){y===void 0&&(y=T.length);let b=y-this.blockSize,I=this.C,E=this.h,P=0;for(;P<y;){if(E==0)for(;P<=b;)s(this,T,P),P+=this.blockSize;if(typeof T=="string"){for(;P<y;)if(I[E++]=T.charCodeAt(P++),E==this.blockSize){s(this,I),E=0;break}}else for(;P<y;)if(I[E++]=T[P++],E==this.blockSize){s(this,I),E=0;break}}this.h=E,this.o+=y},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var y=1;y<T.length-8;++y)T[y]=0;y=this.o*8;for(var b=T.length-8;b<T.length;++b)T[b]=y&255,y/=256;for(this.v(T),T=Array(16),y=0,b=0;b<4;++b)for(let I=0;I<32;I+=8)T[y++]=this.g[b]>>>I&255;return T};function i(T,y){var b=u;return Object.prototype.hasOwnProperty.call(b,T)?b[T]:b[T]=y(T)}function a(T,y){this.h=y;let b=[],I=!0;for(let E=T.length-1;E>=0;E--){let P=T[E]|0;I&&P==y||(b[E]=P,I=!1)}this.g=b}var u={};function c(T){return-128<=T&&T<128?i(T,function(y){return new a([y|0],y<0?-1:0)}):new a([T|0],T<0?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return g;if(T<0)return k(h(-T));let y=[],b=1;for(let I=0;T>=b;I++)y[I]=T/b|0,b*=4294967296;return new a(y,0)}function f(T,y){if(T.length==0)throw Error("number format error: empty string");if(y=y||10,y<2||36<y)throw Error("radix out of range: "+y);if(T.charAt(0)=="-")return k(f(T.substring(1),y));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');let b=h(Math.pow(y,8)),I=g;for(let P=0;P<T.length;P+=8){var E=Math.min(8,T.length-P);let v=parseInt(T.substring(P,P+E),y);E<8?(E=h(Math.pow(y,E)),I=I.j(E).add(h(v))):(I=I.j(b),I=I.add(h(v)))}return I}var g=c(0),_=c(1),w=c(16777216);n=a.prototype,n.m=function(){if(R(this))return-k(this).m();let T=0,y=1;for(let b=0;b<this.g.length;b++){let I=this.i(b);T+=(I>=0?I:4294967296+I)*y,y*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(A(this))return"0";if(R(this))return"-"+k(this).toString(T);let y=h(Math.pow(T,6));var b=this;let I="";for(;;){let E=D(b,y).g;b=O(b,E.j(y));let P=((b.g.length>0?b.g[0]:b.h)>>>0).toString(T);if(b=E,A(b))return P+I;for(;P.length<6;)P="0"+P;I=P+I}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function A(T){if(T.h!=0)return!1;for(let y=0;y<T.g.length;y++)if(T.g[y]!=0)return!1;return!0}function R(T){return T.h==-1}n.l=function(T){return T=O(this,T),R(T)?-1:A(T)?0:1};function k(T){let y=T.g.length,b=[];for(let I=0;I<y;I++)b[I]=~T.g[I];return new a(b,~T.h).add(_)}n.abs=function(){return R(this)?k(this):this},n.add=function(T){let y=Math.max(this.g.length,T.g.length),b=[],I=0;for(let E=0;E<=y;E++){let P=I+(this.i(E)&65535)+(T.i(E)&65535),v=(P>>>16)+(this.i(E)>>>16)+(T.i(E)>>>16);I=v>>>16,P&=65535,v&=65535,b[E]=v<<16|P}return new a(b,b[b.length-1]&-2147483648?-1:0)};function O(T,y){return T.add(k(y))}n.j=function(T){if(A(this)||A(T))return g;if(R(this))return R(T)?k(this).j(k(T)):k(k(this).j(T));if(R(T))return k(this.j(k(T)));if(this.l(w)<0&&T.l(w)<0)return h(this.m()*T.m());let y=this.g.length+T.g.length,b=[];for(var I=0;I<2*y;I++)b[I]=0;for(I=0;I<this.g.length;I++)for(let E=0;E<T.g.length;E++){let P=this.i(I)>>>16,v=this.i(I)&65535,xe=T.i(E)>>>16,It=T.i(E)&65535;b[2*I+2*E]+=v*It,M(b,2*I+2*E),b[2*I+2*E+1]+=P*It,M(b,2*I+2*E+1),b[2*I+2*E+1]+=v*xe,M(b,2*I+2*E+1),b[2*I+2*E+2]+=P*xe,M(b,2*I+2*E+2)}for(T=0;T<y;T++)b[T]=b[2*T+1]<<16|b[2*T];for(T=y;T<2*y;T++)b[T]=0;return new a(b,0)};function M(T,y){for(;(T[y]&65535)!=T[y];)T[y+1]+=T[y]>>>16,T[y]&=65535,y++}function V(T,y){this.g=T,this.h=y}function D(T,y){if(A(y))throw Error("division by zero");if(A(T))return new V(g,g);if(R(T))return y=D(k(T),y),new V(k(y.g),k(y.h));if(R(y))return y=D(T,k(y)),new V(k(y.g),y.h);if(T.g.length>30){if(R(T)||R(y))throw Error("slowDivide_ only works with positive integers.");for(var b=_,I=y;I.l(T)<=0;)b=z(b),I=z(I);var E=X(b,1),P=X(I,1);for(I=X(I,2),b=X(b,2);!A(I);){var v=P.add(I);v.l(T)<=0&&(E=E.add(b),P=v),I=X(I,1),b=X(b,1)}return y=O(T,E.j(y)),new V(E,y)}for(E=g;T.l(y)>=0;){for(b=Math.max(1,Math.floor(T.m()/y.m())),I=Math.ceil(Math.log(b)/Math.LN2),I=I<=48?1:Math.pow(2,I-48),P=h(b),v=P.j(y);R(v)||v.l(T)>0;)b-=I,P=h(b),v=P.j(y);A(P)&&(P=_),E=E.add(P),T=O(T,v)}return new V(E,T)}n.B=function(T){return D(this,T).h},n.and=function(T){let y=Math.max(this.g.length,T.g.length),b=[];for(let I=0;I<y;I++)b[I]=this.i(I)&T.i(I);return new a(b,this.h&T.h)},n.or=function(T){let y=Math.max(this.g.length,T.g.length),b=[];for(let I=0;I<y;I++)b[I]=this.i(I)|T.i(I);return new a(b,this.h|T.h)},n.xor=function(T){let y=Math.max(this.g.length,T.g.length),b=[];for(let I=0;I<y;I++)b[I]=this.i(I)^T.i(I);return new a(b,this.h^T.h)};function z(T){let y=T.g.length+1,b=[];for(let I=0;I<y;I++)b[I]=T.i(I)<<1|T.i(I-1)>>>31;return new a(b,T.h)}function X(T,y){let b=y>>5;y%=32;let I=T.g.length-b,E=[];for(let P=0;P<I;P++)E[P]=y>0?T.i(P+b)>>>y|T.i(P+b+1)<<32-y:T.i(P+b);return new a(E,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,ea=Jl.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,ct=Jl.Integer=a}).apply(typeof Ql<"u"?Ql:typeof self<"u"?self:typeof window<"u"?window:{});var ei=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},lt={};var ta,Tm,Cn,na,Nr,ti,ra,sa,ia;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof ei=="object"&&ei];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function s(o,l){if(l)e:{var d=r;o=o.split(".");for(var m=0;m<o.length-1;m++){var S=o[m];if(!(S in d))break e;d=d[S]}o=o[o.length-1],m=d[o],l=l(m),l!=m&&l!=null&&e(d,o,{configurable:!0,writable:!0,value:l})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(l){var d=[],m;for(m in l)Object.prototype.hasOwnProperty.call(l,m)&&d.push([m,l[m]]);return d}});var i=i||{},a=this||self;function u(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function c(o,l,d){return o.call.apply(o.bind,arguments)}function h(o,l,d){return h=c,h.apply(null,arguments)}function f(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function g(o,l){function d(){}d.prototype=l.prototype,o.Z=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Ob=function(m,S,x){for(var L=Array(arguments.length-2),H=2;H<arguments.length;H++)L[H-2]=arguments[H];return l.prototype[S].apply(m,L)}}var _=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function w(o){let l=o.length;if(l>0){let d=Array(l);for(let m=0;m<l;m++)d[m]=o[m];return d}return[]}function A(o,l){for(let m=1;m<arguments.length;m++){let S=arguments[m];var d=typeof S;if(d=d!="object"?d:S?Array.isArray(S)?"array":d:"null",d=="array"||d=="object"&&typeof S.length=="number"){d=o.length||0;let x=S.length||0;o.length=d+x;for(let L=0;L<x;L++)o[d+L]=S[L]}else o.push(S)}}class R{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return this.h>0?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function k(o){a.setTimeout(()=>{throw o},0)}function O(){var o=T;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class M{constructor(){this.h=this.g=null}add(l,d){let m=V.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}}var V=new R(()=>new D,o=>o.reset());class D{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let z,X=!1,T=new M,y=()=>{let o=Promise.resolve(void 0);z=()=>{o.then(b)}};function b(){for(var o;o=O();){try{o.h.call(o.g)}catch(d){k(d)}var l=V;l.j(o),l.h<100&&(l.h++,o.next=l.g,l.g=o)}X=!1}function I(){this.u=this.u,this.C=this.C}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function E(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}E.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let d=()=>{};a.addEventListener("test",d,l),a.removeEventListener("test",d,l)}catch{}return o}();function v(o){return/^[\s\xa0]*$/.test(o)}function xe(o,l){E.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,l)}g(xe,E),xe.prototype.init=function(o,l){let d=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget,l||(d=="mouseover"?l=o.fromElement:d=="mouseout"&&(l=o.toElement)),this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&xe.Z.h.call(this)},xe.prototype.h=function(){xe.Z.h.call(this);let o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var It="closure_listenable_"+(Math.random()*1e6|0),Gp=0;function Kp(o,l,d,m,S){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=S,this.key=++Gp,this.da=this.fa=!1}function Ss(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Rs(o,l,d){for(let m in o)l.call(d,o[m],m,o)}function Wp(o,l){for(let d in o)l.call(void 0,o[d],d,o)}function qc(o){let l={};for(let d in o)l[d]=o[d];return l}let Bc="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $c(o,l){let d,m;for(let S=1;S<arguments.length;S++){m=arguments[S];for(d in m)o[d]=m[d];for(let x=0;x<Bc.length;x++)d=Bc[x],Object.prototype.hasOwnProperty.call(m,d)&&(o[d]=m[d])}}function Ps(o){this.src=o,this.g={},this.h=0}Ps.prototype.add=function(o,l,d,m,S){let x=o.toString();o=this.g[x],o||(o=this.g[x]=[],this.h++);let L=xo(o,l,m,S);return L>-1?(l=o[L],d||(l.fa=!1)):(l=new Kp(l,this.src,x,!!m,S),l.fa=d,o.push(l)),l};function ko(o,l){let d=l.type;if(d in o.g){var m=o.g[d],S=Array.prototype.indexOf.call(m,l,void 0),x;(x=S>=0)&&Array.prototype.splice.call(m,S,1),x&&(Ss(l),o.g[d].length==0&&(delete o.g[d],o.h--))}}function xo(o,l,d,m){for(let S=0;S<o.length;++S){let x=o[S];if(!x.da&&x.listener==l&&x.capture==!!d&&x.ha==m)return S}return-1}var Co="closure_lm_"+(Math.random()*1e6|0),Oo={};function zc(o,l,d,m,S){if(m&&m.once)return Kc(o,l,d,m,S);if(Array.isArray(l)){for(let x=0;x<l.length;x++)zc(o,l[x],d,m,S);return null}return d=Lo(d),o&&o[It]?o.J(l,d,u(m)?!!m.capture:!!m,S):Gc(o,l,d,!1,m,S)}function Gc(o,l,d,m,S,x){if(!l)throw Error("Invalid event type");let L=u(S)?!!S.capture:!!S,H=Do(o);if(H||(o[Co]=H=new Ps(o)),d=H.add(l,d,m,L,x),d.proxy)return d;if(m=Hp(),d.proxy=m,m.src=o,m.listener=d,o.addEventListener)P||(S=L),S===void 0&&(S=!1),o.addEventListener(l.toString(),m,S);else if(o.attachEvent)o.attachEvent(Hc(l.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return d}function Hp(){function o(d){return l.call(o.src,o.listener,d)}let l=Qp;return o}function Kc(o,l,d,m,S){if(Array.isArray(l)){for(let x=0;x<l.length;x++)Kc(o,l[x],d,m,S);return null}return d=Lo(d),o&&o[It]?o.K(l,d,u(m)?!!m.capture:!!m,S):Gc(o,l,d,!0,m,S)}function Wc(o,l,d,m,S){if(Array.isArray(l))for(var x=0;x<l.length;x++)Wc(o,l[x],d,m,S);else m=u(m)?!!m.capture:!!m,d=Lo(d),o&&o[It]?(o=o.i,x=String(l).toString(),x in o.g&&(l=o.g[x],d=xo(l,d,m,S),d>-1&&(Ss(l[d]),Array.prototype.splice.call(l,d,1),l.length==0&&(delete o.g[x],o.h--)))):o&&(o=Do(o))&&(l=o.g[l.toString()],o=-1,l&&(o=xo(l,d,m,S)),(d=o>-1?l[o]:null)&&No(d))}function No(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[It])ko(l.i,o);else{var d=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(d,m,o.capture):l.detachEvent?l.detachEvent(Hc(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=Do(l))?(ko(d,o),d.h==0&&(d.src=null,l[Co]=null)):Ss(o)}}}function Hc(o){return o in Oo?Oo[o]:Oo[o]="on"+o}function Qp(o,l){if(o.da)o=!0;else{l=new xe(l,this);let d=o.listener,m=o.ha||o.src;o.fa&&No(o),o=d.call(m,l)}return o}function Do(o){return o=o[Co],o instanceof Ps?o:null}var Vo="__closure_events_fn_"+(Math.random()*1e9>>>0);function Lo(o){return typeof o=="function"?o:(o[Vo]||(o[Vo]=function(l){return o.handleEvent(l)}),o[Vo])}function Ae(){I.call(this),this.i=new Ps(this),this.M=this,this.G=null}g(Ae,I),Ae.prototype[It]=!0,Ae.prototype.removeEventListener=function(o,l,d,m){Wc(this,o,l,d,m)};function Re(o,l){var d,m=o.G;if(m)for(d=[];m;m=m.G)d.push(m);if(o=o.M,m=l.type||l,typeof l=="string")l=new E(l,o);else if(l instanceof E)l.target=l.target||o;else{var S=l;l=new E(m,o),$c(l,S)}S=!0;let x,L;if(d)for(L=d.length-1;L>=0;L--)x=l.g=d[L],S=ks(x,m,!0,l)&&S;if(x=l.g=o,S=ks(x,m,!0,l)&&S,S=ks(x,m,!1,l)&&S,d)for(L=0;L<d.length;L++)x=l.g=d[L],S=ks(x,m,!1,l)&&S}Ae.prototype.N=function(){if(Ae.Z.N.call(this),this.i){var o=this.i;for(let l in o.g){let d=o.g[l];for(let m=0;m<d.length;m++)Ss(d[m]);delete o.g[l],o.h--}}this.G=null},Ae.prototype.J=function(o,l,d,m){return this.i.add(String(o),l,!1,d,m)},Ae.prototype.K=function(o,l,d,m){return this.i.add(String(o),l,!0,d,m)};function ks(o,l,d,m){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();let S=!0;for(let x=0;x<l.length;++x){let L=l[x];if(L&&!L.da&&L.capture==d){let H=L.listener,me=L.ha||L.src;L.fa&&ko(o.i,L),S=H.call(me,m)!==!1&&S}}return S&&!m.defaultPrevented}function Jp(o,l){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=h(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(l)>2147483647?-1:a.setTimeout(o,l||0)}function Qc(o){o.g=Jp(()=>{o.g=null,o.i&&(o.i=!1,Qc(o))},o.l);let l=o.h;o.h=null,o.m.apply(null,l)}class Yp extends I{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Qc(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function gr(o){I.call(this),this.h=o,this.g={}}g(gr,I);var Jc=[];function Yc(o){Rs(o.g,function(l,d){this.g.hasOwnProperty(d)&&No(l)},o),o.g={}}gr.prototype.N=function(){gr.Z.N.call(this),Yc(this)},gr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Uo=a.JSON.stringify,Xp=a.JSON.parse,Zp=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Xc(){}function Zc(){}var _r={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Fo(){E.call(this,"d")}g(Fo,E);function Mo(){E.call(this,"c")}g(Mo,E);var Bt={},el=null;function xs(){return el=el||new Ae}Bt.Ia="serverreachability";function tl(o){E.call(this,Bt.Ia,o)}g(tl,E);function yr(o){let l=xs();Re(l,new tl(l))}Bt.STAT_EVENT="statevent";function nl(o,l){E.call(this,Bt.STAT_EVENT,o),this.stat=l}g(nl,E);function Pe(o){let l=xs();Re(l,new nl(l,o))}Bt.Ja="timingevent";function rl(o,l){E.call(this,Bt.Ja,o),this.size=l}g(rl,E);function wr(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},l)}function vr(){this.g=!0}vr.prototype.ua=function(){this.g=!1};function em(o,l,d,m,S,x){o.info(function(){if(o.g)if(x){var L="",H=x.split("&");for(let ee=0;ee<H.length;ee++){var me=H[ee].split("=");if(me.length>1){let we=me[0];me=me[1];let Je=we.split("_");L=Je.length>=2&&Je[1]=="type"?L+(we+"="+me+"&"):L+(we+"=redacted&")}}}else L=null;else L=x;return"XMLHTTP REQ ("+m+") [attempt "+S+"]: "+l+`
`+d+`
`+L})}function tm(o,l,d,m,S,x,L){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+S+"]: "+l+`
`+d+`
`+x+" "+L})}function Rn(o,l,d,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+rm(o,d)+(m?" "+m:"")})}function nm(o,l){o.info(function(){return"TIMEOUT: "+l})}vr.prototype.info=function(){};function rm(o,l){if(!o.g)return l;if(!l)return null;try{let x=JSON.parse(l);if(x){for(o=0;o<x.length;o++)if(Array.isArray(x[o])){var d=x[o];if(!(d.length<2)){var m=d[1];if(Array.isArray(m)&&!(m.length<1)){var S=m[0];if(S!="noop"&&S!="stop"&&S!="close")for(let L=1;L<m.length;L++)m[L]=""}}}}return Uo(x)}catch{return l}}var Cs={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},sl={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},il;function jo(){}g(jo,Xc),jo.prototype.g=function(){return new XMLHttpRequest},il=new jo;function br(o){return encodeURIComponent(String(o))}function sm(o){var l=1;o=o.split(":");let d=[];for(;l>0&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function At(o,l,d,m){this.j=o,this.i=l,this.l=d,this.S=m||1,this.V=new gr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ol}function ol(){this.i=null,this.g="",this.h=!1}var al={},qo={};function Bo(o,l,d){o.M=1,o.A=Ns(Qe(l)),o.u=d,o.R=!0,ul(o,null)}function ul(o,l){o.F=Date.now(),Os(o),o.B=Qe(o.A);var d=o.B,m=o.S;Array.isArray(m)||(m=[String(m)]),bl(d.i,"t",m),o.C=0,d=o.j.L,o.h=new ol,o.g=Ml(o.j,d?l:null,!o.u),o.P>0&&(o.O=new Yp(h(o.Y,o,o.g),o.P)),l=o.V,d=o.g,m=o.ba;var S="readystatechange";Array.isArray(S)||(S&&(Jc[0]=S.toString()),S=Jc);for(let x=0;x<S.length;x++){let L=zc(d,S[x],m||l.handleEvent,!1,l.h||l);if(!L)break;l.g[L.key]=L}l=o.J?qc(o.J):{},o.u?(o.v||(o.v="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,l)):(o.v="GET",o.g.ea(o.B,o.v,null,l)),yr(),em(o.i,o.v,o.B,o.l,o.S,o.u)}At.prototype.ba=function(o){o=o.target;let l=this.O;l&&Pt(o)==3?l.j():this.Y(o)},At.prototype.Y=function(o){try{if(o==this.g)e:{let H=Pt(this.g),me=this.g.ya(),ee=this.g.ca();if(!(H<3)&&(H!=3||this.g&&(this.h.h||this.g.la()||Pl(this.g)))){this.K||H!=4||me==7||(me==8||ee<=0?yr(3):yr(2)),$o(this);var l=this.g.ca();this.X=l;var d=im(this);if(this.o=l==200,tm(this.i,this.v,this.B,this.l,this.S,H,l),this.o){if(this.U&&!this.L){t:{if(this.g){var m,S=this.g;if((m=S.g?S.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!v(m)){var x=m;break t}}x=null}if(o=x)Rn(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,zo(this,o);else{this.o=!1,this.m=3,Pe(12),$t(this),Tr(this);break e}}if(this.R){o=!0;let we;for(;!this.K&&this.C<d.length;)if(we=om(this,d),we==qo){H==4&&(this.m=4,Pe(14),o=!1),Rn(this.i,this.l,null,"[Incomplete Response]");break}else if(we==al){this.m=4,Pe(15),Rn(this.i,this.l,d,"[Invalid Chunk]"),o=!1;break}else Rn(this.i,this.l,we,null),zo(this,we);if(cl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),H!=4||d.length!=0||this.h.h||(this.m=1,Pe(16),o=!1),this.o=this.o&&o,!o)Rn(this.i,this.l,d,"[Invalid Chunked Response]"),$t(this),Tr(this);else if(d.length>0&&!this.W){this.W=!0;var L=this.j;L.g==this&&L.aa&&!L.P&&(L.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),Yo(L),L.P=!0,Pe(11))}}else Rn(this.i,this.l,d,null),zo(this,d);H==4&&$t(this),this.o&&!this.K&&(H==4?Vl(this.j,this):(this.o=!1,Os(this)))}else vm(this.g),l==400&&d.indexOf("Unknown SID")>0?(this.m=3,Pe(12)):(this.m=0,Pe(13)),$t(this),Tr(this)}}}catch{}finally{}};function im(o){if(!cl(o))return o.g.la();let l=Pl(o.g);if(l==="")return"";let d="",m=l.length,S=Pt(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return $t(o),Tr(o),"";o.h.i=new a.TextDecoder}for(let x=0;x<m;x++)o.h.h=!0,d+=o.h.i.decode(l[x],{stream:!(S&&x==m-1)});return l.length=0,o.h.g+=d,o.C=0,o.h.g}function cl(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function om(o,l){var d=o.C,m=l.indexOf(`
`,d);return m==-1?qo:(d=Number(l.substring(d,m)),isNaN(d)?al:(m+=1,m+d>l.length?qo:(l=l.slice(m,m+d),o.C=m+d,l)))}At.prototype.cancel=function(){this.K=!0,$t(this)};function Os(o){o.T=Date.now()+o.H,ll(o,o.H)}function ll(o,l){if(o.D!=null)throw Error("WatchDog timer not null");o.D=wr(h(o.aa,o),l)}function $o(o){o.D&&(a.clearTimeout(o.D),o.D=null)}At.prototype.aa=function(){this.D=null;let o=Date.now();o-this.T>=0?(nm(this.i,this.B),this.M!=2&&(yr(),Pe(17)),$t(this),this.m=2,Tr(this)):ll(this,this.T-o)};function Tr(o){o.j.I==0||o.K||Vl(o.j,o)}function $t(o){$o(o);var l=o.O;l&&typeof l.dispose=="function"&&l.dispose(),o.O=null,Yc(o.V),o.g&&(l=o.g,o.g=null,l.abort(),l.dispose())}function zo(o,l){try{var d=o.j;if(d.I!=0&&(d.g==o||Go(d.h,o))){if(!o.L&&Go(d.h,o)&&d.I==3){try{var m=d.Ba.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var S=m;if(S[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<o.F)Ms(d),Us(d);else break e;Jo(d),Pe(18)}}else d.xa=S[1],0<d.xa-d.K&&S[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=wr(h(d.Va,d),6e3));fl(d.h)<=1&&d.ta&&(d.ta=void 0)}else Gt(d,11)}else if((o.L||d.g==o)&&Ms(d),!v(l))for(S=d.Ba.g.parse(l),l=0;l<S.length;l++){let ee=S[l],we=ee[0];if(!(we<=d.K))if(d.K=we,ee=ee[1],d.I==2)if(ee[0]=="c"){d.M=ee[1],d.ba=ee[2];let Je=ee[3];Je!=null&&(d.ka=Je,d.j.info("VER="+d.ka));let Kt=ee[4];Kt!=null&&(d.za=Kt,d.j.info("SVER="+d.za));let kt=ee[5];kt!=null&&typeof kt=="number"&&kt>0&&(m=1.5*kt,d.O=m,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;let xt=o.g;if(xt){let qs=xt.g?xt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(qs){var x=m.h;x.g||qs.indexOf("spdy")==-1&&qs.indexOf("quic")==-1&&qs.indexOf("h2")==-1||(x.j=x.l,x.g=new Set,x.h&&(Ko(x,x.h),x.h=null))}if(m.G){let Xo=xt.g?xt.g.getResponseHeader("X-HTTP-Session-Id"):null;Xo&&(m.wa=Xo,te(m.J,m.G,Xo))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-o.F,d.j.info("Handshake RTT: "+d.T+"ms")),m=d;var L=o;if(m.na=Fl(m,m.L?m.ba:null,m.W),L.L){pl(m.h,L);var H=L,me=m.O;me&&(H.H=me),H.D&&($o(H),Os(H)),m.g=L}else Nl(m);d.i.length>0&&Fs(d)}else ee[0]!="stop"&&ee[0]!="close"||Gt(d,7);else d.I==3&&(ee[0]=="stop"||ee[0]=="close"?ee[0]=="stop"?Gt(d,7):Qo(d):ee[0]!="noop"&&d.l&&d.l.qa(ee),d.A=0)}}yr(4)}catch{}}var am=class{constructor(o,l){this.g=o,this.map=l}};function hl(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function dl(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function fl(o){return o.h?1:o.g?o.g.size:0}function Go(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function Ko(o,l){o.g?o.g.add(l):o.h=l}function pl(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}hl.prototype.cancel=function(){if(this.i=ml(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function ml(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let l=o.i;for(let d of o.g.values())l=l.concat(d.G);return l}return w(o.i)}var gl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function um(o,l){if(o){o=o.split("&");for(let d=0;d<o.length;d++){let m=o[d].indexOf("="),S,x=null;m>=0?(S=o[d].substring(0,m),x=o[d].substring(m+1)):S=o[d],l(S,x?decodeURIComponent(x.replace(/\+/g," ")):"")}}}function St(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let l;o instanceof St?(this.l=o.l,Er(this,o.j),this.o=o.o,this.g=o.g,Ir(this,o.u),this.h=o.h,Wo(this,Tl(o.i)),this.m=o.m):o&&(l=String(o).match(gl))?(this.l=!1,Er(this,l[1]||"",!0),this.o=Ar(l[2]||""),this.g=Ar(l[3]||"",!0),Ir(this,l[4]),this.h=Ar(l[5]||"",!0),Wo(this,l[6]||"",!0),this.m=Ar(l[7]||"")):(this.l=!1,this.i=new Rr(null,this.l))}St.prototype.toString=function(){let o=[];var l=this.j;l&&o.push(Sr(l,_l,!0),":");var d=this.g;return(d||l=="file")&&(o.push("//"),(l=this.o)&&o.push(Sr(l,_l,!0),"@"),o.push(br(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&o.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(Sr(d,d.charAt(0)=="/"?hm:lm,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",Sr(d,fm)),o.join("")},St.prototype.resolve=function(o){let l=Qe(this),d=!!o.j;d?Er(l,o.j):d=!!o.o,d?l.o=o.o:d=!!o.g,d?l.g=o.g:d=o.u!=null;var m=o.h;if(d)Ir(l,o.u);else if(d=!!o.h){if(m.charAt(0)!="/")if(this.g&&!this.h)m="/"+m;else{var S=l.h.lastIndexOf("/");S!=-1&&(m=l.h.slice(0,S+1)+m)}if(S=m,S==".."||S==".")m="";else if(S.indexOf("./")!=-1||S.indexOf("/.")!=-1){m=S.lastIndexOf("/",0)==0,S=S.split("/");let x=[];for(let L=0;L<S.length;){let H=S[L++];H=="."?m&&L==S.length&&x.push(""):H==".."?((x.length>1||x.length==1&&x[0]!="")&&x.pop(),m&&L==S.length&&x.push("")):(x.push(H),m=!0)}m=x.join("/")}else m=S}return d?l.h=m:d=o.i.toString()!=="",d?Wo(l,Tl(o.i)):d=!!o.m,d&&(l.m=o.m),l};function Qe(o){return new St(o)}function Er(o,l,d){o.j=d?Ar(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function Ir(o,l){if(l){if(l=Number(l),isNaN(l)||l<0)throw Error("Bad port number "+l);o.u=l}else o.u=null}function Wo(o,l,d){l instanceof Rr?(o.i=l,pm(o.i,o.l)):(d||(l=Sr(l,dm)),o.i=new Rr(l,o.l))}function te(o,l,d){o.i.set(l,d)}function Ns(o){return te(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function Ar(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Sr(o,l,d){return typeof o=="string"?(o=encodeURI(o).replace(l,cm),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function cm(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var _l=/[#\/\?@]/g,lm=/[#\?:]/g,hm=/[#\?]/g,dm=/[#\?@]/g,fm=/#/g;function Rr(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function zt(o){o.g||(o.g=new Map,o.h=0,o.i&&um(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}n=Rr.prototype,n.add=function(o,l){zt(this),this.i=null,o=Pn(this,o);let d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this};function yl(o,l){zt(o),l=Pn(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function wl(o,l){return zt(o),l=Pn(o,l),o.g.has(l)}n.forEach=function(o,l){zt(this),this.g.forEach(function(d,m){d.forEach(function(S){o.call(l,S,m,this)},this)},this)};function vl(o,l){zt(o);let d=[];if(typeof l=="string")wl(o,l)&&(d=d.concat(o.g.get(Pn(o,l))));else for(o=Array.from(o.g.values()),l=0;l<o.length;l++)d=d.concat(o[l]);return d}n.set=function(o,l){return zt(this),this.i=null,o=Pn(this,o),wl(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},n.get=function(o,l){return o?(o=vl(this,o),o.length>0?String(o[0]):l):l};function bl(o,l,d){yl(o,l),d.length>0&&(o.i=null,o.g.set(Pn(o,l),w(d)),o.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],l=Array.from(this.g.keys());for(let m=0;m<l.length;m++){var d=l[m];let S=br(d);d=vl(this,d);for(let x=0;x<d.length;x++){let L=S;d[x]!==""&&(L+="="+br(d[x])),o.push(L)}}return this.i=o.join("&")};function Tl(o){let l=new Rr;return l.i=o.i,o.g&&(l.g=new Map(o.g),l.h=o.h),l}function Pn(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function pm(o,l){l&&!o.j&&(zt(o),o.i=null,o.g.forEach(function(d,m){let S=m.toLowerCase();m!=S&&(yl(this,m),bl(this,S,d))},o)),o.j=l}function mm(o,l){let d=new vr;if(a.Image){let m=new Image;m.onload=f(Rt,d,"TestLoadImage: loaded",!0,l,m),m.onerror=f(Rt,d,"TestLoadImage: error",!1,l,m),m.onabort=f(Rt,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=f(Rt,d,"TestLoadImage: timeout",!1,l,m),a.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}function gm(o,l){let d=new vr,m=new AbortController,S=setTimeout(()=>{m.abort(),Rt(d,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:m.signal}).then(x=>{clearTimeout(S),x.ok?Rt(d,"TestPingServer: ok",!0,l):Rt(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(S),Rt(d,"TestPingServer: error",!1,l)})}function Rt(o,l,d,m,S){try{S&&(S.onload=null,S.onerror=null,S.onabort=null,S.ontimeout=null),m(d)}catch{}}function _m(){this.g=new Zp}function Ds(o){this.i=o.Sb||null,this.h=o.ab||!1}g(Ds,Xc),Ds.prototype.g=function(){return new Vs(this.i,this.h)};function Vs(o,l){Ae.call(this),this.H=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(Vs,Ae),n=Vs.prototype,n.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=l,this.readyState=1,kr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let l={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(l.body=o),(this.H||a).fetch(new Request(this.D,l)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Pr(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,kr(this)),this.g&&(this.readyState=3,kr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;El(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function El(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.B.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?Pr(this):kr(this),this.readyState==3&&El(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,Pr(this))},n.Na=function(o){this.g&&(this.response=o,Pr(this))},n.ga=function(){this.g&&Pr(this)};function Pr(o){o.readyState=4,o.l=null,o.j=null,o.B=null,kr(o)}n.setRequestHeader=function(o,l){this.A.append(o,l)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=l.next();return o.join(`\r
`)};function kr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Vs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Il(o){let l="";return Rs(o,function(d,m){l+=m,l+=":",l+=d,l+=`\r
`}),l}function Ho(o,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=Il(d),typeof o=="string"?d!=null&&br(d):te(o,l,d))}function ae(o){Ae.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(ae,Ae);var ym=/^https?$/i,wm=["POST","PUT"];n=ae.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():il.g(),this.g.onreadystatechange=_(h(this.Ca,this));try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(x){Al(this,x);return}if(o=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var S in m)d.set(S,m[S]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let x of m.keys())d.set(x,m.get(x));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(d.keys()).find(x=>x.toLowerCase()=="content-type"),S=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(wm,l,void 0)>=0)||m||S||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[x,L]of d)this.g.setRequestHeader(x,L);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(x){Al(this,x)}};function Al(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.o=5,Sl(o),Ls(o)}function Sl(o){o.A||(o.A=!0,Re(o,"complete"),Re(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,Re(this,"complete"),Re(this,"abort"),Ls(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ls(this,!0)),ae.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Rl(this):this.Xa())},n.Xa=function(){Rl(this)};function Rl(o){if(o.h&&typeof i<"u"){if(o.v&&Pt(o)==4)setTimeout(o.Ca.bind(o),0);else if(Re(o,"readystatechange"),Pt(o)==4){o.h=!1;try{let x=o.ca();e:switch(x){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=x===0){let L=String(o.D).match(gl)[1]||null;!L&&a.self&&a.self.location&&(L=a.self.location.protocol.slice(0,-1)),m=!ym.test(L?L.toLowerCase():"")}d=m}if(d)Re(o,"complete"),Re(o,"success");else{o.o=6;try{var S=Pt(o)>2?o.g.statusText:""}catch{S=""}o.l=S+" ["+o.ca()+"]",Sl(o)}}finally{Ls(o)}}}}function Ls(o,l){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);let d=o.g;o.g=null,l||Re(o,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Pt(o){return o.g?o.g.readyState:0}n.ca=function(){try{return Pt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),Xp(l)}};function Pl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function vm(o){let l={};o=(o.g&&Pt(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(v(o[m]))continue;var d=sm(o[m]);let S=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let x=l[S]||[];l[S]=x,x.push(d)}Wp(l,function(m){return m.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function xr(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function kl(o){this.za=0,this.i=[],this.j=new vr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=xr("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=xr("baseRetryDelayMs",5e3,o),this.Za=xr("retryDelaySeedMs",1e4,o),this.Ta=xr("forwardChannelMaxRetries",2,o),this.va=xr("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new hl(o&&o.concurrentRequestLimit),this.Ba=new _m,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=kl.prototype,n.ka=8,n.I=1,n.connect=function(o,l,d,m){Pe(0),this.W=o,this.H=l||{},d&&m!==void 0&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.J=Fl(this,null,this.W),Fs(this)};function Qo(o){if(xl(o),o.I==3){var l=o.V++,d=Qe(o.J);if(te(d,"SID",o.M),te(d,"RID",l),te(d,"TYPE","terminate"),Cr(o,d),l=new At(o,o.j,l),l.M=2,l.A=Ns(Qe(d)),d=!1,a.navigator&&a.navigator.sendBeacon)try{d=a.navigator.sendBeacon(l.A.toString(),"")}catch{}!d&&a.Image&&(new Image().src=l.A,d=!0),d||(l.g=Ml(l.j,null),l.g.ea(l.A)),l.F=Date.now(),Os(l)}Ul(o)}function Us(o){o.g&&(Yo(o),o.g.cancel(),o.g=null)}function xl(o){Us(o),o.v&&(a.clearTimeout(o.v),o.v=null),Ms(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function Fs(o){if(!dl(o.h)&&!o.m){o.m=!0;var l=o.Ea;z||y(),X||(z(),X=!0),T.add(l,o),o.D=0}}function bm(o,l){return fl(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=l.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=wr(h(o.Ea,o,l),Ll(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;let S=new At(this,this.j,o),x=this.o;if(this.U&&(x?(x=qc(x),$c(x,this.U)):x=this.U),this.u!==null||this.R||(S.J=x,x=null),this.S)e:{for(var l=0,d=0;d<this.i.length;d++){t:{var m=this.i[d];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(l+=m,l>4096){l=d;break e}if(l===4096||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Ol(this,S,l),d=Qe(this.J),te(d,"RID",o),te(d,"CVER",22),this.G&&te(d,"X-HTTP-Session-Id",this.G),Cr(this,d),x&&(this.R?l="headers="+br(Il(x))+"&"+l:this.u&&Ho(d,this.u,x)),Ko(this.h,S),this.Ra&&te(d,"TYPE","init"),this.S?(te(d,"$req",l),te(d,"SID","null"),S.U=!0,Bo(S,d,null)):Bo(S,d,l),this.I=2}}else this.I==3&&(o?Cl(this,o):this.i.length==0||dl(this.h)||Cl(this))};function Cl(o,l){var d;l?d=l.l:d=o.V++;let m=Qe(o.J);te(m,"SID",o.M),te(m,"RID",d),te(m,"AID",o.K),Cr(o,m),o.u&&o.o&&Ho(m,o.u,o.o),d=new At(o,o.j,d,o.D+1),o.u===null&&(d.J=o.o),l&&(o.i=l.G.concat(o.i)),l=Ol(o,d,1e3),d.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),Ko(o.h,d),Bo(d,m,l)}function Cr(o,l){o.H&&Rs(o.H,function(d,m){te(l,m,d)}),o.l&&Rs({},function(d,m){te(l,m,d)})}function Ol(o,l,d){d=Math.min(o.i.length,d);let m=o.l?h(o.l.Ka,o.l,o):null;e:{var S=o.i;let H=-1;for(;;){let me=["count="+d];H==-1?d>0?(H=S[0].g,me.push("ofs="+H)):H=0:me.push("ofs="+H);let ee=!0;for(let we=0;we<d;we++){var x=S[we].g;let Je=S[we].map;if(x-=H,x<0)H=Math.max(0,S[we].g-100),ee=!1;else try{x="req"+x+"_"||"";try{var L=Je instanceof Map?Je:Object.entries(Je);for(let[Kt,kt]of L){let xt=kt;u(kt)&&(xt=Uo(kt)),me.push(x+Kt+"="+encodeURIComponent(xt))}}catch(Kt){throw me.push(x+"type="+encodeURIComponent("_badmap")),Kt}}catch{m&&m(Je)}}if(ee){L=me.join("&");break e}}L=void 0}return o=o.i.splice(0,d),l.G=o,L}function Nl(o){if(!o.g&&!o.v){o.Y=1;var l=o.Da;z||y(),X||(z(),X=!0),T.add(l,o),o.A=0}}function Jo(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=wr(h(o.Da,o),Ll(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,Dl(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=wr(h(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Pe(10),Us(this),Dl(this))};function Yo(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function Dl(o){o.g=new At(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var l=Qe(o.na);te(l,"RID","rpc"),te(l,"SID",o.M),te(l,"AID",o.K),te(l,"CI",o.F?"0":"1"),!o.F&&o.ia&&te(l,"TO",o.ia),te(l,"TYPE","xmlhttp"),Cr(o,l),o.u&&o.o&&Ho(l,o.u,o.o),o.O&&(o.g.H=o.O);var d=o.g;o=o.ba,d.M=1,d.A=Ns(Qe(l)),d.u=null,d.R=!0,ul(d,o)}n.Va=function(){this.C!=null&&(this.C=null,Us(this),Jo(this),Pe(19))};function Ms(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function Vl(o,l){var d=null;if(o.g==l){Ms(o),Yo(o),o.g=null;var m=2}else if(Go(o.h,l))d=l.G,pl(o.h,l),m=1;else return;if(o.I!=0){if(l.o)if(m==1){d=l.u?l.u.length:0,l=Date.now()-l.F;var S=o.D;m=xs(),Re(m,new rl(m,d)),Fs(o)}else Nl(o);else if(S=l.m,S==3||S==0&&l.X>0||!(m==1&&bm(o,l)||m==2&&Jo(o)))switch(d&&d.length>0&&(l=o.h,l.i=l.i.concat(d)),S){case 1:Gt(o,5);break;case 4:Gt(o,10);break;case 3:Gt(o,6);break;default:Gt(o,2)}}}function Ll(o,l){let d=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(d*=2),d*l}function Gt(o,l){if(o.j.info("Error code "+l),l==2){var d=h(o.bb,o),m=o.Ua;let S=!m;m=new St(m||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Er(m,"https"),Ns(m),S?mm(m.toString(),d):gm(m.toString(),d)}else Pe(2);o.I=0,o.l&&o.l.pa(l),Ul(o),xl(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),Pe(2)):(this.j.info("Failed to ping google.com"),Pe(1))};function Ul(o){if(o.I=0,o.ja=[],o.l){let l=ml(o.h);(l.length!=0||o.i.length!=0)&&(A(o.ja,l),A(o.ja,o.i),o.h.i.length=0,w(o.i),o.i.length=0),o.l.oa()}}function Fl(o,l,d){var m=d instanceof St?Qe(d):new St(d);if(m.g!="")l&&(m.g=l+"."+m.g),Ir(m,m.u);else{var S=a.location;m=S.protocol,l=l?l+"."+S.hostname:S.hostname,S=+S.port;let x=new St(null);m&&Er(x,m),l&&(x.g=l),S&&Ir(x,S),d&&(x.h=d),m=x}return d=o.G,l=o.wa,d&&l&&te(m,d,l),te(m,"VER",o.ka),Cr(o,m),m}function Ml(o,l,d){if(l&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Aa&&!o.ma?new ae(new Ds({ab:d})):new ae(o.ma),l.Fa(o.L),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function jl(){}n=jl.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function js(){}js.prototype.g=function(o,l){return new Ne(o,l)};function Ne(o,l){Ae.call(this),this.g=new kl(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.sa&&(o?o["X-WebChannel-Client-Profile"]=l.sa:o={"X-WebChannel-Client-Profile":l.sa}),this.g.U=o,(o=l&&l.Qb)&&!v(o)&&(this.g.u=o),this.A=l&&l.supportsCrossDomainXhr||!1,this.v=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!v(l)&&(this.g.G=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new kn(this)}g(Ne,Ae),Ne.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ne.prototype.close=function(){Qo(this.g)},Ne.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.v&&(d={},d.__data__=Uo(o),o=d);l.i.push(new am(l.Ya++,o)),l.I==3&&Fs(l)},Ne.prototype.N=function(){this.g.l=null,delete this.j,Qo(this.g),delete this.g,Ne.Z.N.call(this)};function ql(o){Fo.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(let d in l){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}g(ql,Fo);function Bl(){Mo.call(this),this.status=1}g(Bl,Mo);function kn(o){this.g=o}g(kn,jl),kn.prototype.ra=function(){Re(this.g,"a")},kn.prototype.qa=function(o){Re(this.g,new ql(o))},kn.prototype.pa=function(o){Re(this.g,new Bl)},kn.prototype.oa=function(){Re(this.g,"b")},js.prototype.createWebChannel=js.prototype.g,Ne.prototype.send=Ne.prototype.o,Ne.prototype.open=Ne.prototype.m,Ne.prototype.close=Ne.prototype.close,ia=lt.createWebChannelTransport=function(){return new js},sa=lt.getStatEventTarget=function(){return xs()},ra=lt.Event=Bt,ti=lt.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Cs.NO_ERROR=0,Cs.TIMEOUT=8,Cs.HTTP_ERROR=6,Nr=lt.ErrorCode=Cs,sl.COMPLETE="complete",na=lt.EventType=sl,Zc.EventType=_r,_r.OPEN="a",_r.CLOSE="b",_r.ERROR="c",_r.MESSAGE="d",Ae.prototype.listen=Ae.prototype.J,Cn=lt.WebChannel=Zc,Tm=lt.FetchXmlHttpFactory=Ds,ae.prototype.listenOnce=ae.prototype.K,ae.prototype.getLastError=ae.prototype.Ha,ae.prototype.getLastErrorCode=ae.prototype.ya,ae.prototype.getStatus=ae.prototype.ca,ae.prototype.getResponseJson=ae.prototype.La,ae.prototype.getResponseText=ae.prototype.la,ae.prototype.send=ae.prototype.ea,ae.prototype.setWithCredentials=ae.prototype.Fa,ta=lt.XhrIo=ae}).apply(typeof ei<"u"?ei:typeof self<"u"?self:typeof window<"u"?window:{});var ve=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ve.UNAUTHENTICATED=new ve(null),ve.GOOGLE_CREDENTIALS=new ve("google-credentials-uid"),ve.FIRST_PARTY=new ve("first-party-uid"),ve.MOCK_USER=new ve("mock-user");var Jn="12.9.0";function Lh(n){Jn=n}var Jt=new Wl("@firebase/firestore");function On(){return Jt.logLevel}function F(n,...e){if(Jt.logLevel<=Ye.DEBUG){let t=e.map(Vu);Jt.debug(`Firestore (${Jn}): ${n}`,...t)}}function ft(n,...e){if(Jt.logLevel<=Ye.ERROR){let t=e.map(Vu);Jt.error(`Firestore (${Jn}): ${n}`,...t)}}function pt(n,...e){if(Jt.logLevel<=Ye.WARN){let t=e.map(Vu);Jt.warn(`Firestore (${Jn}): ${n}`,...t)}}function Vu(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function $(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Uh(n,r,t)}function Uh(n,e,t){let r=`FIRESTORE (${Jn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw ft(r),new Error(r)}function Z(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||Uh(e,s,r)}function K(n,e){return n}var C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},U=class extends Ws{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ze=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var ui=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},ci=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ve.UNAUTHENTICATED))}shutdown(){}},ha=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},li=class{constructor(e){this.t=e,this.currentUser=ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Z(this.o===void 0,42304);let r=this.i,s=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve(),i=new ze;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ze,e.enqueueRetryable(()=>s(this.currentUser))};let a=()=>{let c=i;e.enqueueRetryable(()=>p(this,null,function*(){yield c.promise,yield s(this.currentUser)}))},u=c=>{F("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(F("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ze)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(F("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Z(typeof r.accessToken=="string",31837,{l:r}),new ui(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Z(e===null||typeof e=="string",2055,{h:e}),new ve(e)}},da=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=ve.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}},fa=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new da(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ve.FIRST_PARTY))}shutdown(){}invalidateToken(){}},hi=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},di=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ys(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Z(this.o===void 0,3512);let r=i=>{i.error!=null&&F("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);let a=i.token!==this.m;return this.m=i.token,F("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};let s=i=>{F("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){let i=this.V.getImmediate({optional:!0});i?s(i):F("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new hi(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Z(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new hi(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Em(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Yt=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let s=Em(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}};function J(n,e){return n<e?-1:n>e?1:0}function pa(n,e){let t=Math.min(n.length,e.length);for(let r=0;r<t;r++){let s=n.charAt(r),i=e.charAt(r);if(s!==i)return oa(s)===oa(i)?J(s,i):oa(s)?1:-1}return J(n.length,e.length)}var Im=55296,Am=57343;function oa(n){let e=n.charCodeAt(0);return e>=Im&&e<=Am}function Mn(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}var Yl="__name__",fi=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&$(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&$(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let s=0;s<r;s++){let i=n.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return J(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),s=n.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?n.extractNumericId(e).compare(n.extractNumericId(t)):pa(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ct.fromString(e.substring(4,e.length-2))}},ne=class n extends fi{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new U(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new n(t)}static emptyPath(){return new n([])}},Sm=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Oe=class n extends fi{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return Sm.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Yl}static keyField(){return new n([Yl])}static fromServerFormat(e){let t=[],r="",s=0,i=()=>{if(r.length===0)throw new U(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;s<e.length;){let u=e[s];if(u==="\\"){if(s+1===e.length)throw new U(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new U(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(r+=u,s++):(i(),s++)}if(i(),a)throw new U(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var q=class n{constructor(e){this.path=e}static fromPath(e){return new n(ne.fromString(e))}static fromName(e){return new n(ne.fromString(e).popFirst(5))}static empty(){return new n(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ne.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ne(e.slice()))}};function Fh(n,e,t){if(!t)throw new U(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Mh(n,e,t,r){if(e===!0&&r===!0)throw new U(C.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Xl(n){if(!q.isDocumentKey(n))throw new U(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Zl(n){if(q.isDocumentKey(n))throw new U(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function jh(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Yr(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$(12329,{type:typeof n})}function Ke(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new U(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Yr(n);throw new U(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function de(n,e){let t={typeString:n};return e&&(t.value=e),t}function Yn(n,e){if(!jh(n))throw new U(C.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new U(C.INVALID_ARGUMENT,t);return!0}var eh=-62135596800,th=1e6,re=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*th);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new U(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new U(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<eh)throw new U(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new U(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/th}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Yn(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-eh;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};re._jsonSchemaVersion="firestore/timestamp/1.0",re._jsonSchema={type:de("string",re._jsonSchemaVersion),seconds:de("number"),nanoseconds:de("number")};var W=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new re(0,0))}static max(){return new n(new re(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Mr=-1,pi=class{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}};pi.UNKNOWN_ID=-1;function Rm(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=W.fromTimestamp(r===1e9?new re(t+1,0):new re(t,r));return new Xt(s,q.empty(),e)}function Pm(n){return new Xt(n.readTime,n.key,Mr)}var Xt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(W.min(),q.empty(),Mr)}static max(){return new n(W.max(),q.empty(),Mr)}};function km(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=q.comparator(n.documentKey,e.documentKey),t!==0?t:J(n.largestBatchId,e.largestBatchId))}var xm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ma=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Xn(n){return p(this,null,function*(){if(n.code!==C.FAILED_PRECONDITION||n.message!==xm)throw n;F("LocalStore","Unexpectedly lost primary lease")})}var N=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let s=0,i=0,a=!1;e.forEach(u=>{++s,u.next(()=>{++i,a&&i===s&&t()},c=>r(c))}),a=!0,i===s&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(s=>s?n.resolve(s):r());return t}static forEach(e,t){let r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new n((r,s)=>{let i=e.length,a=new Array(i),u=0;for(let c=0;c<i;c++){let h=c;t(e[h]).next(f=>{a[h]=f,++u,u===i&&r(a)},f=>s(f))}})}static doWhile(e,t){return new n((r,s)=>{let i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}};function Cm(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Zn(n){return n.name==="IndexedDbTransactionError"}var Lu=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>r.writeSequenceNumber(s))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ue&&this.ue(t),t}}n.ce=-1;return n})(),Uu=-1;function Gi(n){return n==null}function jr(n){return n===0&&1/n==-1/0}function Om(n){return typeof n=="number"&&Number.isInteger(n)&&!jr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var qh="";function Nm(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=nh(e)),e=Dm(n.get(t),e);return nh(e)}function Dm(n,e){let t=e,r=n.length;for(let s=0;s<r;s++){let i=n.charAt(s);switch(i){case"\0":t+="";break;case qh:t+="";break;default:t+=i}}return t}function nh(n){return n+qh+""}var Vm="remoteDocuments",Bh="owner";var $h="mutationQueues";var zh="mutations";var Gh="documentMutations",Lm="remoteDocumentsV14";var Kh="remoteDocumentGlobal";var Wh="targets";var Hh="targetDocuments";var Qh="targetGlobal",Jh="collectionParents";var Yh="clientMetadata";var Xh="bundles";var Zh="namedQueries";var Um="indexConfiguration";var Fm="indexState";var Mm="indexEntries";var ed="documentOverlays";var jm="globals";var qm=[$h,zh,Gh,Vm,Wh,Bh,Qh,Hh,Yh,Kh,Jh,Xh,Zh],Xw=[...qm,ed],Bm=[$h,zh,Gh,Lm,Wh,Bh,Qh,Hh,Yh,Kh,Jh,Xh,Zh,ed],$m=Bm,zm=[...$m,Um,Fm,Mm];var Zw=[...zm,jm];function rh(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Lt(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function td(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ce=class n{constructor(e,t){this.comparator=e,this.root=t||Xe.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Xe.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Xe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ln(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ln(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ln(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ln(this.root,e,this.comparator,!0)}},Ln=class{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Xe=class n{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=i??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new n(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this,i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw $(27949);return e+(this.isRed()?0:1)}};Xe.EMPTY=null,Xe.RED=!0,Xe.BLACK=!1;Xe.EMPTY=new class{constructor(){this.size=0}get key(){throw $(57766)}get value(){throw $(16141)}get color(){throw $(16727)}get left(){throw $(29726)}get right(){throw $(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Xe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var be=class n{constructor(e){this.comparator=e,this.data=new ce(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new mi(this.data.getIterator())}getIteratorFrom(e){return new mi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},mi=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Me=class n{constructor(e){this.fields=e,e.sort(Oe.comparator)}static empty(){return new n([])}unionWith(e){let t=new be(Oe.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Mn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var gi=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Ee=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new gi("Invalid base64 string: "+i):i}}(e);return new n(t)}static fromUint8Array(e){let t=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ee.EMPTY_BYTE_STRING=new Ee("");var Gm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mt(n){if(Z(!!n,39018),typeof n=="string"){let e=0,t=Gm.exec(n);if(Z(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ie(n.seconds),nanos:ie(n.nanos)}}function ie(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function gt(n){return typeof n=="string"?Ee.fromBase64String(n):Ee.fromUint8Array(n)}var nd="server_timestamp",rd="__type__",sd="__previous_value__",id="__local_write_time__";function Ki(n){return(n?.mapValue?.fields||{})[rd]?.stringValue===nd}function Wi(n){let e=n.mapValue.fields[sd];return Ki(e)?Wi(e):e}function qr(n){let e=mt(n.mapValue.fields[id].timestampValue);return new re(e.seconds,e.nanos)}var ga=class{constructor(e,t,r,s,i,a,u,c,h,f,g){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=f,this.apiKey=g}},_i="(default)",Br=class n{constructor(e,t){this.projectId=e,this.database=t||_i}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===_i}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function od(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new U(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Br(n.options.projectId,e)}var Fu="__type__",ad="__max__",ni={mapValue:{fields:{__type__:{stringValue:ad}}}},Mu="__vector__",jn="value";function Ot(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ki(n)?4:cd(n)?9007199254740991:ud(n)?10:11:$(28295,{value:n})}function st(n,e){if(n===e)return!0;let t=Ot(n);if(t!==Ot(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return qr(n).isEqual(qr(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;let a=mt(s.timestampValue),u=mt(i.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return gt(s.bytesValue).isEqual(gt(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return ie(s.geoPointValue.latitude)===ie(i.geoPointValue.latitude)&&ie(s.geoPointValue.longitude)===ie(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return ie(s.integerValue)===ie(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){let a=ie(s.doubleValue),u=ie(i.doubleValue);return a===u?jr(a)===jr(u):isNaN(a)&&isNaN(u)}return!1}(n,e);case 9:return Mn(n.arrayValue.values||[],e.arrayValue.values||[],st);case 10:case 11:return function(s,i){let a=s.mapValue.fields||{},u=i.mapValue.fields||{};if(rh(a)!==rh(u))return!1;for(let c in a)if(a.hasOwnProperty(c)&&(u[c]===void 0||!st(a[c],u[c])))return!1;return!0}(n,e);default:return $(52216,{left:n})}}function $r(n,e){return(n.values||[]).find(t=>st(t,e))!==void 0}function qn(n,e){if(n===e)return 0;let t=Ot(n),r=Ot(e);if(t!==r)return J(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(n.booleanValue,e.booleanValue);case 2:return function(i,a){let u=ie(i.integerValue||i.doubleValue),c=ie(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(n,e);case 3:return sh(n.timestampValue,e.timestampValue);case 4:return sh(qr(n),qr(e));case 5:return pa(n.stringValue,e.stringValue);case 6:return function(i,a){let u=gt(i),c=gt(a);return u.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(i,a){let u=i.split("/"),c=a.split("/");for(let h=0;h<u.length&&h<c.length;h++){let f=J(u[h],c[h]);if(f!==0)return f}return J(u.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,a){let u=J(ie(i.latitude),ie(a.latitude));return u!==0?u:J(ie(i.longitude),ie(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return ih(n.arrayValue,e.arrayValue);case 10:return function(i,a){let u=i.fields||{},c=a.fields||{},h=u[jn]?.arrayValue,f=c[jn]?.arrayValue,g=J(h?.values?.length||0,f?.values?.length||0);return g!==0?g:ih(h,f)}(n.mapValue,e.mapValue);case 11:return function(i,a){if(i===ni.mapValue&&a===ni.mapValue)return 0;if(i===ni.mapValue)return 1;if(a===ni.mapValue)return-1;let u=i.fields||{},c=Object.keys(u),h=a.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let g=0;g<c.length&&g<f.length;++g){let _=pa(c[g],f[g]);if(_!==0)return _;let w=qn(u[c[g]],h[f[g]]);if(w!==0)return w}return J(c.length,f.length)}(n.mapValue,e.mapValue);default:throw $(23264,{he:t})}}function sh(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return J(n,e);let t=mt(n),r=mt(e),s=J(t.seconds,r.seconds);return s!==0?s:J(t.nanos,r.nanos)}function ih(n,e){let t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){let i=qn(t[s],r[s]);if(i)return i}return J(t.length,r.length)}function Bn(n){return _a(n)}function _a(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=mt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return gt(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return q.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(let i of t.values||[])s?s=!1:r+=",",r+=_a(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),s="{",i=!0;for(let a of r)i?i=!1:s+=",",s+=`${a}:${_a(t.fields[a])}`;return s+"}"}(n.mapValue):$(61005,{value:n})}function ii(n){switch(Ot(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Wi(n);return e?16+ii(e):16;case 5:return 2*n.stringValue.length;case 6:return gt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+ii(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Lt(r.fields,(i,a)=>{s+=i.length+ii(a)}),s}(n.mapValue);default:throw $(13486,{value:n})}}function ju(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ya(n){return!!n&&"integerValue"in n}function qu(n){return!!n&&"arrayValue"in n}function oh(n){return!!n&&"nullValue"in n}function ah(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function oi(n){return!!n&&"mapValue"in n}function ud(n){return(n?.mapValue?.fields||{})[Fu]?.stringValue===Mu}function Lr(n){if(n.geoPointValue)return{geoPointValue:ue({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:ue({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Lt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Lr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Lr(n.arrayValue.values[t]);return e}return ue({},n)}function cd(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===ad}var tv={mapValue:{fields:{[Fu]:{stringValue:Mu},[jn]:{arrayValue:{}}}}};var Ce=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!oi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Lr(t)}setAll(e){let t=Oe.emptyPath(),r={},s=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let c=this.getFieldsMap(t);this.applyChanges(c,r,s),r={},s=[],t=u.popLast()}a?r[u.lastSegment()]=Lr(a):s.push(u.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){let t=this.field(e.popLast());oi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return st(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];oi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Lt(t,(s,i)=>e[s]=i);for(let s of r)delete e[s]}clone(){return new n(Lr(this.value))}};function ld(n){let e=[];return Lt(n.fields,(t,r)=>{let s=new Oe([t]);if(oi(r)){let i=ld(r.mapValue).fields;if(i.length===0)e.push(s);else for(let a of i)e.push(s.child(a))}else e.push(s)}),new Me(e)}var Ge=class n{constructor(e,t,r,s,i,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=u}static newInvalidDocument(e){return new n(e,0,W.min(),W.min(),W.min(),Ce.empty(),0)}static newFoundDocument(e,t,r,s){return new n(e,1,t,W.min(),r,s,0)}static newNoDocument(e,t){return new n(e,2,t,W.min(),W.min(),Ce.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,W.min(),W.min(),Ce.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(W.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ce.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ce.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=W.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Zt=class{constructor(e,t){this.position=e,this.inclusive=t}};function uh(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){let i=e[s],a=n.position[s];if(i.field.isKeyField()?r=q.comparator(q.fromName(a.referenceValue),t.key):r=qn(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function ch(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!st(n.position[t],e.position[t]))return!1;return!0}var en=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Km(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var yi=class{},he=class n extends yi{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new va(e,t,r):t==="array-contains"?new Ea(e,r):t==="in"?new Ia(e,r):t==="not-in"?new Aa(e,r):t==="array-contains-any"?new Sa(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new ba(e,r):new Ta(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(qn(t,this.value)):t!==null&&Ot(this.value)===Ot(t)&&this.matchesComparison(qn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},je=class n extends yi{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new n(e,t)}matches(e){return hd(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function hd(n){return n.op==="and"}function dd(n){return Wm(n)&&hd(n)}function Wm(n){for(let e of n.filters)if(e instanceof je)return!1;return!0}function wa(n){if(n instanceof he)return n.field.canonicalString()+n.op.toString()+Bn(n.value);if(dd(n))return n.filters.map(e=>wa(e)).join(",");{let e=n.filters.map(t=>wa(t)).join(",");return`${n.op}(${e})`}}function fd(n,e){return n instanceof he?function(r,s){return s instanceof he&&r.op===s.op&&r.field.isEqual(s.field)&&st(r.value,s.value)}(n,e):n instanceof je?function(r,s){return s instanceof je&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,u)=>i&&fd(a,s.filters[u]),!0):!1}(n,e):void $(19439)}function pd(n){return n instanceof he?function(t){return`${t.field.canonicalString()} ${t.op} ${Bn(t.value)}`}(n):n instanceof je?function(t){return t.op.toString()+" {"+t.getFilters().map(pd).join(" ,")+"}"}(n):"Filter"}var va=class extends he{constructor(e,t,r){super(e,t,r),this.key=q.fromName(r.referenceValue)}matches(e){let t=q.comparator(e.key,this.key);return this.matchesComparison(t)}},ba=class extends he{constructor(e,t){super(e,"in",t),this.keys=md("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Ta=class extends he{constructor(e,t){super(e,"not-in",t),this.keys=md("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function md(n,e){return(e.arrayValue?.values||[]).map(t=>q.fromName(t.referenceValue))}var Ea=class extends he{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return qu(t)&&$r(t.arrayValue,this.value)}},Ia=class extends he{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&$r(this.value.arrayValue,t)}},Aa=class extends he{constructor(e,t){super(e,"not-in",t)}matches(e){if($r(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!$r(this.value.arrayValue,t)}},Sa=class extends he{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!qu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>$r(this.value.arrayValue,r))}};var Ra=class{constructor(e,t=null,r=[],s=[],i=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=u,this.Te=null}};function lh(n,e=null,t=[],r=[],s=null,i=null,a=null){return new Ra(n,e,t,r,s,i,a)}function Bu(n){let e=K(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>wa(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Gi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Bn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Bn(r)).join(",")),e.Te=t}return e.Te}function $u(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Km(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!fd(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!ch(n.startAt,e.startAt)&&ch(n.endAt,e.endAt)}function Pa(n){return q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var tn=class{constructor(e,t=null,r=[],s=[],i=null,a="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=u,this.endAt=c,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}};function Hm(n,e,t,r,s,i,a,u){return new tn(n,e,t,r,s,i,a,u)}function Hi(n){return new tn(n)}function hh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Qm(n){return q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function zu(n){return n.collectionGroup!==null}function Un(n){let e=K(n);if(e.Ie===null){e.Ie=[];let t=new Set;for(let i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new be(Oe.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new en(i,r))}),t.has(Oe.keyField().canonicalString())||e.Ie.push(new en(Oe.keyField(),r))}return e.Ie}function Ze(n){let e=K(n);return e.Ee||(e.Ee=Jm(e,Un(n))),e.Ee}function Jm(n,e){if(n.limitType==="F")return lh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{let i=s.dir==="desc"?"asc":"desc";return new en(s.field,i)});let t=n.endAt?new Zt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Zt(n.startAt.position,n.startAt.inclusive):null;return lh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Qi(n,e){let t=n.filters.concat([e]);return new tn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function wi(n,e,t){return new tn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ji(n,e){return $u(Ze(n),Ze(e))&&n.limitType===e.limitType}function gd(n){return`${Bu(Ze(n))}|lt:${n.limitType}`}function Nn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>pd(s)).join(", ")}]`),Gi(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Bn(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Bn(s)).join(",")),`Target(${r})`}(Ze(n))}; limitType=${n.limitType})`}function Yi(n,e){return e.isFoundDocument()&&function(r,s){let i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):q.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(let i of Un(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(let i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(a,u,c){let h=uh(a,u,c);return a.inclusive?h<=0:h<0}(r.startAt,Un(r),s)||r.endAt&&!function(a,u,c){let h=uh(a,u,c);return a.inclusive?h>=0:h>0}(r.endAt,Un(r),s))}(n,e)}function Ym(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function _d(n){return(e,t)=>{let r=!1;for(let s of Un(n)){let i=Xm(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function Xm(n,e,t){let r=n.field.isKeyField()?q.comparator(e.key,t.key):function(i,a,u){let c=a.data.field(i),h=u.data.field(i);return c!==null&&h!==null?qn(c,h):$(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return $(19790,{direction:n.dir})}}var _t=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Lt(this.inner,(t,r)=>{for(let[s,i]of r)e(s,i)})}isEmpty(){return td(this.inner)}size(){return this.innerSize}};var Zm=new ce(q.comparator);function yt(){return Zm}var yd=new ce(q.comparator);function Vr(...n){let e=yd;for(let t of n)e=e.insert(t.key,t);return e}function wd(n){let e=yd;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ht(){return Ur()}function vd(){return Ur()}function Ur(){return new _t(n=>n.toString(),(n,e)=>n.isEqual(e))}var eg=new ce(q.comparator),tg=new be(q.comparator);function Q(...n){let e=tg;for(let t of n)e=e.add(t);return e}var ng=new be(J);function rg(){return ng}function Gu(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:jr(e)?"-0":e}}function bd(n){return{integerValue:""+n}}function sg(n,e){return Om(e)?bd(e):Gu(n,e)}var $n=class{constructor(){this._=void 0}};function ig(n,e,t){return n instanceof zn?function(s,i){let a={fields:{[rd]:{stringValue:nd},[id]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Ki(i)&&(i=Wi(i)),i&&(a.fields[sd]=i),{mapValue:a}}(t,e):n instanceof nn?Ed(n,e):n instanceof rn?Id(n,e):function(s,i){let a=Td(s,i),u=dh(a)+dh(s.Ae);return ya(a)&&ya(s.Ae)?bd(u):Gu(s.serializer,u)}(n,e)}function og(n,e,t){return n instanceof nn?Ed(n,e):n instanceof rn?Id(n,e):t}function Td(n,e){return n instanceof Gn?function(r){return ya(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}var zn=class extends $n{},nn=class extends $n{constructor(e){super(),this.elements=e}};function Ed(n,e){let t=Ad(e);for(let r of n.elements)t.some(s=>st(s,r))||t.push(r);return{arrayValue:{values:t}}}var rn=class extends $n{constructor(e){super(),this.elements=e}};function Id(n,e){let t=Ad(e);for(let r of n.elements)t=t.filter(s=>!st(s,r));return{arrayValue:{values:t}}}var Gn=class extends $n{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function dh(n){return ie(n.integerValue||n.doubleValue)}function Ad(n){return qu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function ag(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof nn&&s instanceof nn||r instanceof rn&&s instanceof rn?Mn(r.elements,s.elements,st):r instanceof Gn&&s instanceof Gn?st(r.Ae,s.Ae):r instanceof zn&&s instanceof zn}(n.transform,e.transform)}var ka=class{constructor(e,t){this.version=e,this.transformResults=t}},et=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ai(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Kn=class{};function Sd(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Wn(n.key,et.none()):new sn(n.key,n.data,et.none());{let t=n.data,r=Ce.empty(),s=new be(Oe.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new it(n.key,r,new Me(s.toArray()),et.none())}}function ug(n,e,t){n instanceof sn?function(s,i,a){let u=s.value.clone(),c=ph(s.fieldTransforms,i,a.transformResults);u.setAll(c),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(n,e,t):n instanceof it?function(s,i,a){if(!ai(s.precondition,i))return void i.convertToUnknownDocument(a.version);let u=ph(s.fieldTransforms,i,a.transformResults),c=i.data;c.setAll(Rd(s)),c.setAll(u),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(n,e,t):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Fr(n,e,t,r){return n instanceof sn?function(i,a,u,c){if(!ai(i.precondition,a))return u;let h=i.value.clone(),f=mh(i.fieldTransforms,c,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(n,e,t,r):n instanceof it?function(i,a,u,c){if(!ai(i.precondition,a))return u;let h=mh(i.fieldTransforms,c,a),f=a.data;return f.setAll(Rd(i)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(g=>g.field))}(n,e,t,r):function(i,a,u){return ai(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(n,e,t)}function cg(n,e){let t=null;for(let r of n.fieldTransforms){let s=e.data.field(r.field),i=Td(r.transform,s||null);i!=null&&(t===null&&(t=Ce.empty()),t.set(r.field,i))}return t||null}function fh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Mn(r,s,(i,a)=>ag(i,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var sn=class extends Kn{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},it=class extends Kn{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}};function Rd(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function ph(n,e,t){let r=new Map;Z(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let s=0;s<t.length;s++){let i=n[s],a=i.transform,u=e.data.field(i.field);r.set(i.field,og(a,u,t[s]))}return r}function mh(n,e,t){let r=new Map;for(let s of n){let i=s.transform,a=t.data.field(s.field);r.set(s.field,ig(i,a,e))}return r}var Wn=class extends Kn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},xa=class extends Kn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ca=class{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){let i=this.mutations[s];i.key.isEqual(e.key)&&ug(i,e,r[s])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Fr(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Fr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=vd();return this.mutations.forEach(s=>{let i=e.get(s.key),a=i.overlayedDocument,u=this.applyToLocalView(a,i.mutatedFields);u=t.has(s.key)?null:u;let c=Sd(a,u);c!==null&&r.set(s.key,c),a.isValidDocument()||a.convertToNoDocument(W.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Q())}isEqual(e){return this.batchId===e.batchId&&Mn(this.mutations,e.mutations,(t,r)=>fh(t,r))&&Mn(this.baseMutations,e.baseMutations,(t,r)=>fh(t,r))}},Oa=class n{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Z(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return eg}(),i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new n(e,t,r,s)}};var Na=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Da=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var fe,Y;function lg(n){switch(n){case C.OK:return $(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return $(15467,{code:n})}}function Pd(n){if(n===void 0)return ft("GRPC error has no .code"),C.UNKNOWN;switch(n){case fe.OK:return C.OK;case fe.CANCELLED:return C.CANCELLED;case fe.UNKNOWN:return C.UNKNOWN;case fe.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case fe.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case fe.INTERNAL:return C.INTERNAL;case fe.UNAVAILABLE:return C.UNAVAILABLE;case fe.UNAUTHENTICATED:return C.UNAUTHENTICATED;case fe.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case fe.NOT_FOUND:return C.NOT_FOUND;case fe.ALREADY_EXISTS:return C.ALREADY_EXISTS;case fe.PERMISSION_DENIED:return C.PERMISSION_DENIED;case fe.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case fe.ABORTED:return C.ABORTED;case fe.OUT_OF_RANGE:return C.OUT_OF_RANGE;case fe.UNIMPLEMENTED:return C.UNIMPLEMENTED;case fe.DATA_LOSS:return C.DATA_LOSS;default:return $(39323,{code:n})}}(Y=fe||(fe={}))[Y.OK=0]="OK",Y[Y.CANCELLED=1]="CANCELLED",Y[Y.UNKNOWN=2]="UNKNOWN",Y[Y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Y[Y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Y[Y.NOT_FOUND=5]="NOT_FOUND",Y[Y.ALREADY_EXISTS=6]="ALREADY_EXISTS",Y[Y.PERMISSION_DENIED=7]="PERMISSION_DENIED",Y[Y.UNAUTHENTICATED=16]="UNAUTHENTICATED",Y[Y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Y[Y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Y[Y.ABORTED=10]="ABORTED",Y[Y.OUT_OF_RANGE=11]="OUT_OF_RANGE",Y[Y.UNIMPLEMENTED=12]="UNIMPLEMENTED",Y[Y.INTERNAL=13]="INTERNAL",Y[Y.UNAVAILABLE=14]="UNAVAILABLE",Y[Y.DATA_LOSS=15]="DATA_LOSS";var hg=null;function dg(){return new TextEncoder}var fg=new ct([4294967295,4294967295],0);function gh(n){let e=dg().encode(n),t=new ea;return t.update(e),new Uint8Array(t.digest())}function _h(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ct([t,r],0),new ct([s,i],0)]}var Va=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Qt(`Invalid padding: ${t}`);if(r<0)throw new Qt(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Qt(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Qt(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=ct.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(ct.fromNumber(r)));return s.compare(fg)===1&&(s=new ct([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;let t=gh(e),[r,s]=_h(t);for(let i=0;i<this.hashCount;i++){let a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,t,r){let s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new n(i,s,t);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.ge===0)return;let t=gh(e),[r,s]=_h(t);for(let i=0;i<this.hashCount;i++){let a=this.ye(r,s,i);this.be(a)}}be(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Qt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var vi=class n{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let s=new Map;return s.set(e,zr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(W.min(),s,new ce(J),yt(),Q())}},zr=class n{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Q(),Q(),Q())}};var Fn=class{constructor(e,t,r,s){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=s}},bi=class{constructor(e,t){this.targetId=e,this.Ce=t}},Ti=class{constructor(e,t,r=Ee.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}},Ei=class{constructor(){this.ve=0,this.Fe=yh(),this.Me=Ee.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Q(),t=Q(),r=Q();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:$(38017,{changeType:i})}}),new zr(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=yh()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Z(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}},La=class{constructor(e){this.Ge=e,this.ze=new Map,this.je=yt(),this.He=ri(),this.Je=ri(),this.Ze=new ce(J)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:$(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){let t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){let i=s.target;if(Pa(i))if(r===0){let a=new q(i.path);this.et(t,a,Ge.newNoDocument(a,W.min()))}else Z(r===1,20013,{expectedCount:r});else{let a=this._t(t);if(a!==r){let u=this.ut(e),c=u?this.ct(u,e,a):1;if(c!==0){this.it(t);let h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,h)}hg?.lt(function(f,g,_,w,A){let R={localCacheCount:f,existenceFilterCount:g.count,databaseId:_.database,projectId:_.projectId},k=g.unchangedNames;return k&&(R.bloomFilter={applied:A===0,hashCount:k?.hashCount??0,bitmapLength:k?.bits?.bitmap?.length??0,padding:k?.bits?.padding??0,mightContain:O=>w?.mightContain(O)??!1}),R}(a,e.Ce,this.Ge.ht(),u,c))}}}}ut(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t,a,u;try{a=gt(r).toUint8Array()}catch(c){if(c instanceof gi)return pt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new Va(a,s,i)}catch(c){return pt(c instanceof Qt?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),s=0;return r.forEach(i=>{let a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(u)||(this.et(t,i,null),s++)}),s}Tt(e){let t=new Map;this.ze.forEach((i,a)=>{let u=this.ot(a);if(u){if(i.current&&Pa(u.target)){let c=new q(u.target.path);this.It(c).has(a)||this.Et(a,c)||this.et(a,c,Ge.newNoDocument(c,e))}i.Be&&(t.set(a,i.ke()),i.Ke())}});let r=Q();this.Je.forEach((i,a)=>{let u=!0;a.forEachWhile(c=>{let h=this.ot(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(i))}),this.je.forEach((i,a)=>a.setReadTime(e));let s=new vi(e,t,this.Ze,this.je,r);return this.je=yt(),this.He=ri(),this.Je=ri(),this.Ze=new ce(J),s}Ye(e,t){if(!this.rt(e))return;let r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let s=this.nt(e);this.Et(e,t)?s.qe(t,1):s.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new Ei,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new be(J),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new be(J),this.He=this.He.insert(e,t)),t}rt(e){let t=this.ot(e)!==null;return t||F("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Ei),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}};function ri(){return new ce(q.comparator)}function yh(){return new ce(q.comparator)}var pg={asc:"ASCENDING",desc:"DESCENDING"},mg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gg={and:"AND",or:"OR"},Ua=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Fa(n,e){return n.useProto3Json||Gi(e)?e:{value:e}}function Ii(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function kd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function _g(n,e){return Ii(n,e.toTimestamp())}function tt(n){return Z(!!n,49232),W.fromTimestamp(function(t){let r=mt(t);return new re(r.seconds,r.nanos)}(n))}function Ku(n,e){return Ma(n,e).canonicalString()}function Ma(n,e){let t=function(s){return new ne(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function xd(n){let e=ne.fromString(n);return Z(Vd(e),10190,{key:e.toString()}),e}function ja(n,e){return Ku(n.databaseId,e.path)}function aa(n,e){let t=xd(e);if(t.get(1)!==n.databaseId.projectId)throw new U(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new U(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new q(Od(t))}function Cd(n,e){return Ku(n.databaseId,e)}function yg(n){let e=xd(n);return e.length===4?ne.emptyPath():Od(e)}function qa(n){return new ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Od(n){return Z(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function wh(n,e,t){return{name:ja(n,e),fields:t.value.mapValue.fields}}function wg(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:$(39313,{state:h})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(h,f){return h.useProto3Json?(Z(f===void 0||typeof f=="string",58123),Ee.fromBase64String(f||"")):(Z(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Ee.fromUint8Array(f||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(h){let f=h.code===void 0?C.UNKNOWN:Pd(h.code);return new U(f,h.message||"")}(a);t=new Ti(r,s,i,u||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let s=aa(n,r.document.name),i=tt(r.document.updateTime),a=r.document.createTime?tt(r.document.createTime):W.min(),u=new Ce({mapValue:{fields:r.document.fields}}),c=Ge.newFoundDocument(s,i,a,u),h=r.targetIds||[],f=r.removedTargetIds||[];t=new Fn(h,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let s=aa(n,r.document),i=r.readTime?tt(r.readTime):W.min(),a=Ge.newNoDocument(s,i),u=r.removedTargetIds||[];t=new Fn([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let s=aa(n,r.document),i=r.removedTargetIds||[];t=new Fn([],i,s,null)}else{if(!("filter"in e))return $(11601,{Vt:e});{e.filter;let r=e.filter;r.targetId;let{count:s=0,unchangedNames:i}=r,a=new Da(s,i),u=r.targetId;t=new bi(u,a)}}return t}function vg(n,e){let t;if(e instanceof sn)t={update:wh(n,e.key,e.value)};else if(e instanceof Wn)t={delete:ja(n,e.key)};else if(e instanceof it)t={update:wh(n,e.key,e.data),updateMask:kg(e.fieldMask)};else{if(!(e instanceof xa))return $(16599,{dt:e.type});t={verify:ja(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,a){let u=a.transform;if(u instanceof zn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof nn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof rn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Gn)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw $(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:_g(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:$(27497)}(n,e.precondition)),t}function bg(n,e){return n&&n.length>0?(Z(e!==void 0,14353),n.map(t=>function(s,i){let a=s.updateTime?tt(s.updateTime):tt(i);return a.isEqual(W.min())&&(a=tt(i)),new ka(a,s.transformResults||[])}(t,e))):[]}function Tg(n,e){return{documents:[Cd(n,e.path)]}}function Eg(n,e){let t={structuredQuery:{}},r=e.path,s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Cd(n,s);let i=function(h){if(h.length!==0)return Dd(je.create(h,"and"))}(e.filters);i&&(t.structuredQuery.where=i);let a=function(h){if(h.length!==0)return h.map(f=>function(_){return{field:Dn(_.field),direction:Sg(_.dir)}}(f))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=Fa(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{ft:t,parent:s}}function Ig(n){let e=yg(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,s=null;if(r>0){Z(r===1,65062);let f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=function(g){let _=Nd(g);return _ instanceof je&&dd(_)?_.getFilters():[_]}(t.where));let a=[];t.orderBy&&(a=function(g){return g.map(_=>function(A){return new en(Vn(A.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(A.direction))}(_))}(t.orderBy));let u=null;t.limit&&(u=function(g){let _;return _=typeof g=="object"?g.value:g,Gi(_)?null:_}(t.limit));let c=null;t.startAt&&(c=function(g){let _=!!g.before,w=g.values||[];return new Zt(w,_)}(t.startAt));let h=null;return t.endAt&&(h=function(g){let _=!g.before,w=g.values||[];return new Zt(w,_)}(t.endAt)),Hm(e,s,a,i,u,"F",c,h)}function Ag(n,e){let t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Nd(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Vn(t.unaryFilter.field);return he.create(r,"==",{doubleValue:NaN});case"IS_NULL":let s=Vn(t.unaryFilter.field);return he.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=Vn(t.unaryFilter.field);return he.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Vn(t.unaryFilter.field);return he.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $(61313);default:return $(60726)}}(n):n.fieldFilter!==void 0?function(t){return he.create(Vn(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $(58110);default:return $(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return je.create(t.compositeFilter.filters.map(r=>Nd(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return $(1026)}}(t.compositeFilter.op))}(n):$(30097,{filter:n})}function Sg(n){return pg[n]}function Rg(n){return mg[n]}function Pg(n){return gg[n]}function Dn(n){return{fieldPath:n.canonicalString()}}function Vn(n){return Oe.fromServerFormat(n.fieldPath)}function Dd(n){return n instanceof he?function(t){if(t.op==="=="){if(ah(t.value))return{unaryFilter:{field:Dn(t.field),op:"IS_NAN"}};if(oh(t.value))return{unaryFilter:{field:Dn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ah(t.value))return{unaryFilter:{field:Dn(t.field),op:"IS_NOT_NAN"}};if(oh(t.value))return{unaryFilter:{field:Dn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dn(t.field),op:Rg(t.op),value:t.value}}}(n):n instanceof je?function(t){let r=t.getFilters().map(s=>Dd(s));return r.length===1?r[0]:{compositeFilter:{op:Pg(t.op),filters:r}}}(n):$(54877,{filter:n})}function kg(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Vd(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function Ld(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}var Gr=class n{constructor(e,t,r,s,i=W.min(),a=W.min(),u=Ee.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Ba=class{constructor(e){this.yt=e}};function Ud(n){let e=Ig({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?wi(e,e.limit,"L"):e}var Ai=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(ie(e.integerValue));else if("doubleValue"in e){let r=ie(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),jr(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=mt(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(gt(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?cd(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):ud(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):$(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};this.Ft(t,55);for(let s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let s=jn,i=r[s].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(ie(i)),this.Ot(s,t),this.Ct(r[s],t)}qt(e,t){let r=e.values||[];this.Ft(t,50);for(let s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),q.fromName(e).path.forEach(r=>{this.Ft(t,60),this.$t(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};Ai.Wt=new Ai;var $a=class{constructor(){this.Sn=new za}addToCollectionParentIndex(e,t){return this.Sn.add(t),N.resolve()}getCollectionParents(e,t){return N.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return N.resolve()}deleteFieldIndex(e,t){return N.resolve()}deleteAllFieldIndexes(e){return N.resolve()}createTargetIndexes(e,t){return N.resolve()}getDocumentsMatchingTarget(e,t){return N.resolve(null)}getIndexType(e,t){return N.resolve(0)}getFieldIndexes(e,t){return N.resolve([])}getNextCollectionGroupToUpdate(e){return N.resolve(null)}getMinOffset(e,t){return N.resolve(Xt.min())}getMinOffsetFromCollectionGroup(e,t){return N.resolve(Xt.min())}updateCollectionGroup(e,t,r){return N.resolve()}updateIndexEntries(e,t){return N.resolve()}},za=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new be(ne.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new be(ne.comparator)).toArray()}};var nv=new Uint8Array(0);var vh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Fd=41943040,Fe=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};Fe.DEFAULT_COLLECTION_PERCENTILE=10,Fe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Fe.DEFAULT=new Fe(Fd,Fe.DEFAULT_COLLECTION_PERCENTILE,Fe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Fe.DISABLED=new Fe(-1,0,0);var Kr=class n{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new n(0)}static ar(){return new n(-1)}};var bh="LruGarbageCollector",xg=1048576;function Th([n,e],[t,r]){let s=J(n,t);return s===0?J(e,r):s}var Ga=class{constructor(e){this.Pr=e,this.buffer=new be(Th),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Th(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Ka=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){F(bh,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>p(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Zn(t)?F(bh,"Ignoring IndexedDB error during garbage collection: ",t):yield Xn(t)}yield this.Ar(3e5)}))}},Wa=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return N.resolve(Lu.ce);let r=new Ga(t);return this.Vr.forEachTarget(e,s=>r.Er(s.sequenceNumber)).next(()=>this.Vr.mr(e,s=>r.Er(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(F("LruGarbageCollector","Garbage collection skipped; disabled"),N.resolve(vh)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(F("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vh):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,s,i,a,u,c,h,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(F("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,a=Date.now(),this.nthSequenceNumber(e,s))).next(g=>(r=g,u=Date.now(),this.removeTargets(e,r,t))).next(g=>(i=g,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(g=>(h=Date.now(),On()<=Ye.DEBUG&&F("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${i} targets in `+(c-u)+`ms
	Removed ${g} documents in `+(h-c)+`ms
Total Duration: ${h-f}ms`),N.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:g})))}};function Cg(n,e){return new Wa(n,e)}var Ha=class{constructor(){this.changes=new _t(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ge.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?N.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Qa=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Ja=class{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Fr(r.mutation,s,Me.empty(),re.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Q()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Q()){let s=Ht();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let a=Vr();return i.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=Ht();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Q()))}populateOverlays(e,t,r){let s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,r,s){let i=yt(),a=Ur(),u=function(){return Ur()}();return t.forEach((c,h)=>{let f=r.get(h.key);s.has(h.key)&&(f===void 0||f.mutation instanceof it)?i=i.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),Fr(f.mutation,h,f.mutation.getFieldMask(),re.now())):a.set(h.key,Me.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((h,f)=>a.set(h,f)),t.forEach((h,f)=>u.set(h,new Qa(f,a.get(h)??null))),u))}recalculateAndSaveOverlays(e,t){let r=Ur(),s=new ce((a,u)=>a-u),i=Q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(c=>{let h=t.get(c);if(h===null)return;let f=r.get(c)||Me.empty();f=u.applyToLocalView(h,f),r.set(c,f);let g=(s.get(u.batchId)||Q()).add(c);s=s.insert(u.batchId,g)})}).next(()=>{let a=[],u=s.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),h=c.key,f=c.value,g=vd();f.forEach(_=>{if(!i.has(_)){let w=Sd(t.get(_),r.get(_));w!==null&&g.set(_,w),i=i.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(e,h,g))}return N.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return Qm(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):zu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{let a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):N.resolve(Ht()),u=Mr,c=i;return a.next(h=>N.forEach(h,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),i.get(f)?N.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(e,h,i)).next(()=>this.computeViews(e,c,h,Q())).next(f=>({batchId:u,changes:wd(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new q(t)).next(r=>{let s=Vr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){let i=t.collectionGroup,a=Vr();return this.indexManager.getCollectionParents(e,i).next(u=>N.forEach(u,c=>{let h=function(g,_){return new tn(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(t,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,h,r,s).next(f=>{f.forEach((g,_)=>{a=a.insert(g,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(a=>{i.forEach((c,h)=>{let f=h.getKey();a.get(f)===null&&(a=a.insert(f,Ge.newInvalidDocument(f)))});let u=Vr();return a.forEach((c,h)=>{let f=i.get(c);f!==void 0&&Fr(f.mutation,h,Me.empty(),re.now()),Yi(t,h)&&(u=u.insert(c,h))}),u})}};var Ya=class{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return N.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:tt(s.createTime)}}(t)),N.resolve()}getNamedQuery(e,t){return N.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,function(s){return{name:s.name,query:Ud(s.bundledQuery),readTime:tt(s.readTime)}}(t)),N.resolve()}};var Xa=class{constructor(){this.overlays=new ce(q.comparator),this.Lr=new Map}getOverlay(e,t){return N.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Ht();return N.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.bt(e,t,i)}),N.resolve()}removeOverlaysForBatchId(e,t,r){let s=this.Lr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Lr.delete(r)),N.resolve()}getOverlaysForCollection(e,t,r){let s=Ht(),i=t.length+1,a=new q(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return N.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new ce((h,f)=>h-f),a=this.overlays.getIterator();for(;a.hasNext();){let h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let f=i.get(h.largestBatchId);f===null&&(f=Ht(),i=i.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let u=Ht(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=s)););return N.resolve(u)}bt(e,t,r){let s=this.overlays.get(r.key);if(s!==null){let a=this.Lr.get(s.largestBatchId).delete(r.key);this.Lr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Na(t,r));let i=this.Lr.get(t);i===void 0&&(i=Q(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}};var Za=class{constructor(){this.sessionToken=Ee.EMPTY_BYTE_STRING}getSessionToken(e){return N.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,N.resolve()}};var Wr=class{constructor(){this.kr=new be(pe.Kr),this.qr=new be(pe.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new pe(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new pe(e,t))}Qr(e,t){e.forEach(r=>this.removeReference(r,t))}Gr(e){let t=new q(new ne([])),r=new pe(t,e),s=new pe(t,e+1),i=[];return this.qr.forEachInRange([r,s],a=>{this.Wr(a),i.push(a.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new q(new ne([])),r=new pe(t,e),s=new pe(t,e+1),i=Q();return this.qr.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){let t=new pe(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},pe=class{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return q.comparator(e.key,t.key)||J(e.Hr,t.Hr)}static Ur(e,t){return J(e.Hr,t.Hr)||q.comparator(e.key,t.key)}};var eu=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new be(pe.Kr)}checkEmpty(e){return N.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Ca(i,t,r,s);this.mutationQueue.push(a);for(let u of s)this.Jr=this.Jr.add(new pe(u.key,i)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return N.resolve(a)}lookupMutationBatch(e,t){return N.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,s=this.Xr(r),i=s<0?0:s;return N.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return N.resolve(this.mutationQueue.length===0?Uu:this.Yn-1)}getAllMutationBatches(e){return N.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new pe(t,0),s=new pe(t,Number.POSITIVE_INFINITY),i=[];return this.Jr.forEachInRange([r,s],a=>{let u=this.Zr(a.Hr);i.push(u)}),N.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new be(J);return t.forEach(s=>{let i=new pe(s,0),a=new pe(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([i,a],u=>{r=r.add(u.Hr)})}),N.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,s=r.length+1,i=r;q.isDocumentKey(i)||(i=i.child(""));let a=new pe(new q(i),0),u=new be(J);return this.Jr.forEachWhile(c=>{let h=c.key.path;return!!r.isPrefixOf(h)&&(h.length===s&&(u=u.add(c.Hr)),!0)},a),N.resolve(this.Yr(u))}Yr(e){let t=[];return e.forEach(r=>{let s=this.Zr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Z(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return N.forEach(t.mutations,s=>{let i=new pe(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new pe(t,0),s=this.Jr.firstAfterOrEqual(r);return N.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,N.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var tu=class{constructor(e){this.ti=e,this.docs=function(){return new ce(q.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return N.resolve(r?r.document.mutableCopy():Ge.newInvalidDocument(t))}getEntries(e,t){let r=yt();return t.forEach(s=>{let i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ge.newInvalidDocument(s))}),N.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=yt(),a=t.path,u=new q(a.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:h,value:{document:f}}=c.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||km(Pm(f),r)<=0||(s.has(f.key)||Yi(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return N.resolve(i)}getAllFromCollectionGroup(e,t,r,s){$(9500)}ni(e,t){return N.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new nu(this)}getSize(e){return N.resolve(this.size)}},nu=class extends Ha{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Mr.addEntry(e,s)):this.Mr.removeEntry(r)}),N.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}};var ru=class{constructor(e){this.persistence=e,this.ri=new _t(t=>Bu(t),$u),this.lastRemoteSnapshotVersion=W.min(),this.highestTargetId=0,this.ii=0,this.si=new Wr,this.targetCount=0,this.oi=Kr._r()}forEachTarget(e,t){return this.ri.forEach((r,s)=>t(s)),N.resolve()}getLastRemoteSnapshotVersion(e){return N.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return N.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),N.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),N.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new Kr(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,N.resolve()}updateTargetData(e,t){return this.lr(t),N.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,N.resolve()}removeTargets(e,t,r){let s=0,i=[];return this.ri.forEach((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.ri.delete(a),i.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)}),N.waitFor(i).next(()=>s)}getTargetCount(e){return N.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return N.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),N.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),N.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),N.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return N.resolve(r)}containsKey(e,t){return N.resolve(this.si.containsKey(t))}};var Si=class{constructor(e,t){this._i={},this.overlays={},this.ai=new Lu(0),this.ui=!1,this.ui=!0,this.ci=new Za,this.referenceDelegate=e(this),this.li=new ru(this),this.indexManager=new $a,this.remoteDocumentCache=function(s){return new tu(s)}(r=>this.referenceDelegate.hi(r)),this.serializer=new Ba(t),this.Pi=new Ya(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Xa,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new eu(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){F("MemoryPersistence","Starting transaction:",e);let s=new su(this.ai.next());return this.referenceDelegate.Ti(),r(s).next(i=>this.referenceDelegate.Ii(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ei(e,t){return N.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}},su=class extends ma{constructor(e){super(),this.currentSequenceNumber=e}},iu=class n{constructor(e){this.persistence=e,this.Ri=new Wr,this.Ai=null}static Vi(e){return new n(e)}get di(){if(this.Ai)return this.Ai;throw $(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),N.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),N.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),N.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(s=>this.di.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.di.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return N.forEach(this.di,r=>{let s=q.fromPath(r);return this.mi(e,s).next(i=>{i||t.removeEntry(s,W.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return N.or([()=>N.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},Ri=class n{constructor(e,t){this.persistence=e,this.fi=new _t(r=>Nm(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Cg(this,t)}static Vi(e,t){return new n(e,t)}Ti(){}Ii(e){return N.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}pr(e){let t=0;return this.mr(e,r=>{t++}).next(()=>t)}mr(e,t){return N.forEach(this.fi,(r,s)=>this.wr(e,r,s).next(i=>i?N.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ni(e,a=>this.wr(e,a,t).next(u=>{u||(r++,i.removeEntry(a,W.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),N.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),N.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),N.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),N.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ii(e.data.value)),t}wr(e,t,r){return N.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let s=this.fi.get(t);return N.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var ou=class n{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=s}static Es(e,t){let r=Q(),s=Q();for(let i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new n(e,t.fromCache,r,s)}};var au=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var uu=class{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return Kl()?8:Cm(Gl())>0?6:4}()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){let i={result:null};return this.gs(e,t).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.ps(e,t,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;let a=new au;return this.ys(e,t,a).next(u=>{if(i.result=u,this.As)return this.ws(e,t,a,u.size)})}).next(()=>i.result)}ws(e,t,r,s){return r.documentReadCount<this.Vs?(On()<=Ye.DEBUG&&F("QueryEngine","SDK will not create cache indexes for query:",Nn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),N.resolve()):(On()<=Ye.DEBUG&&F("QueryEngine","Query:",Nn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ds*s?(On()<=Ye.DEBUG&&F("QueryEngine","The SDK decides to create cache indexes for query:",Nn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ze(t))):N.resolve())}gs(e,t){if(hh(t))return N.resolve(null);let r=Ze(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=wi(t,null,"F"),r=Ze(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{let a=Q(...i);return this.fs.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(c=>{let h=this.bs(t,u);return this.Ss(t,h,a,c.readTime)?this.gs(e,wi(t,null,"F")):this.Ds(e,h,t,c)}))})))}ps(e,t,r,s){return hh(t)||s.isEqual(W.min())?N.resolve(null):this.fs.getDocuments(e,r).next(i=>{let a=this.bs(t,i);return this.Ss(t,a,r,s)?N.resolve(null):(On()<=Ye.DEBUG&&F("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Nn(t)),this.Ds(e,a,t,Rm(s,Mr)).next(u=>u))})}bs(e,t){let r=new be(_d(e));return t.forEach((s,i)=>{Yi(e,i)&&(r=r.add(i))}),r}Ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ys(e,t,r){return On()<=Ye.DEBUG&&F("QueryEngine","Using full collection scan to execute query:",Nn(t)),this.fs.getDocumentsMatchingQuery(e,t,Xt.min(),r)}Ds(e,t,r,s){return this.fs.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(a=>{i=i.insert(a.key,a)}),i))}};var Wu="LocalStore",Og=3e8,cu=class{constructor(e,t,r,s){this.persistence=e,this.Cs=t,this.serializer=s,this.vs=new ce(J),this.Fs=new _t(i=>Bu(i),$u),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ja(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}};function Ng(n,e,t,r){return new cu(n,e,t,r)}function Md(n,e){return p(this,null,function*(){let t=K(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Os(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{let a=[],u=[],c=Q();for(let h of s){a.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}for(let h of i){u.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(r,c).next(h=>({Ns:h,removedBatchIds:a,addedBatchIds:u}))})})})}function Dg(n,e){let t=K(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let s=e.batch.keys(),i=t.xs.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){let g=h.batch,_=g.keys(),w=N.resolve();return _.forEach(A=>{w=w.next(()=>f.getEntry(c,A)).next(R=>{let k=h.docVersions.get(A);Z(k!==null,48541),R.version.compareTo(k)<0&&(g.applyToRemoteDocument(R,h),R.isValidDocument()&&(R.setReadTime(h.commitVersion),f.addEntry(R)))})}),w.next(()=>u.mutationQueue.removeMutationBatch(c,g))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let c=Q();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function jd(n){let e=K(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function Vg(n,e){let t=K(n),r=e.snapshotVersion,s=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let a=t.xs.newChangeBuffer({trackRemovals:!0});s=t.vs;let u=[];e.targetChanges.forEach((f,g)=>{let _=s.get(g);if(!_)return;u.push(t.li.removeMatchingKeys(i,f.removedDocuments,g).next(()=>t.li.addMatchingKeys(i,f.addedDocuments,g)));let w=_.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(g)!==null?w=w.withResumeToken(Ee.EMPTY_BYTE_STRING,W.min()).withLastLimboFreeSnapshotVersion(W.min()):f.resumeToken.approximateByteSize()>0&&(w=w.withResumeToken(f.resumeToken,r)),s=s.insert(g,w),function(R,k,O){return R.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-R.snapshotVersion.toMicroseconds()>=Og?!0:O.addedDocuments.size+O.modifiedDocuments.size+O.removedDocuments.size>0}(_,w,f)&&u.push(t.li.updateTargetData(i,w))});let c=yt(),h=Q();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))}),u.push(Lg(i,a,e.documentUpdates).next(f=>{c=f.Bs,h=f.Ls})),!r.isEqual(W.min())){let f=t.li.getLastRemoteSnapshotVersion(i).next(g=>t.li.setTargetsMetadata(i,i.currentSequenceNumber,r));u.push(f)}return N.waitFor(u).next(()=>a.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,c,h)).next(()=>c)}).then(i=>(t.vs=s,i))}function Lg(n,e,t){let r=Q(),s=Q();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let a=yt();return t.forEach((u,c)=>{let h=i.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(u)),c.isNoDocument()&&c.version.isEqual(W.min())?(e.removeEntry(u,c.readTime),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),a=a.insert(u,c)):F(Wu,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{Bs:a,Ls:s}})}function Ug(n,e){let t=K(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Uu),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Fg(n,e){let t=K(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.li.getTargetData(r,e).next(i=>i?(s=i,N.resolve(s)):t.li.allocateTargetId(r).next(a=>(s=new Gr(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,s).next(()=>s))))}).then(r=>{let s=t.vs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r})}function lu(n,e,t){return p(this,null,function*(){let r=K(n),s=r.vs.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Zn(a))throw a;F(Wu,`Failed to update sequence numbers for target ${e}: ${a}`)}r.vs=r.vs.remove(e),r.Fs.delete(s.target)})}function Eh(n,e,t){let r=K(n),s=W.min(),i=Q();return r.persistence.runTransaction("Execute query","readwrite",a=>function(c,h,f){let g=K(c),_=g.Fs.get(f);return _!==void 0?N.resolve(g.vs.get(_)):g.li.getTargetData(h,f)}(r,a,Ze(e)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(a,u.targetId).next(c=>{i=c})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,t?s:W.min(),t?i:Q())).next(u=>(Mg(r,Ym(e),u),{documents:u,ks:i})))}function Mg(n,e,t){let r=n.Ms.get(e)||W.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Ms.set(e,r)}var Pi=class{constructor(){this.activeTargetIds=rg()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var hu=class{constructor(){this.vo=new Pi,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Pi,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var du=class{Mo(e){}shutdown(){}};var Ih="ConnectivityMonitor",ki=class{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){F(Ih,"Network connectivity changed: AVAILABLE");for(let e of this.Lo)e(0)}Bo(){F(Ih,"Network connectivity changed: UNAVAILABLE");for(let e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var si=null;function fu(){return si===null?si=function(){return 268435456+Math.round(2147483648*Math.random())}():si++,"0x"+si.toString(16)}var ua="RestConnection",jg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"},pu=class{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${s}`,this.$o=this.databaseId.database===_i?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(e,t,r,s,i){let a=fu(),u=this.Qo(e,t.toUriEncodedString());F(ua,`Sending RPC '${e}' ${a}:`,u,r);let c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(c,s,i);let{host:h}=new URL(u),f=Or(h);return this.zo(e,u,c,r,f).then(g=>(F(ua,`Received RPC '${e}' ${a}: `,g),g),g=>{throw pt(ua,`RPC '${e}' ${a} failed with error: `,g,"url: ",u,"request:",r),g})}jo(e,t,r,s,i,a){return this.Wo(e,t,r,s,i)}Go(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Jn}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}Qo(e,t){let r=jg[e],s=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}};var mu=class{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}};var Se="WebChannelConnection",Dr=(n,e,t)=>{n.listen(e,r=>{try{t(r)}catch(s){setTimeout(()=>{throw s},0)}})},xi=class n extends pu{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!n.c_){let e=sa();Dr(e,ra.STAT_EVENT,t=>{t.stat===ti.PROXY?F(Se,"STAT_EVENT: detected buffering proxy"):t.stat===ti.NOPROXY&&F(Se,"STAT_EVENT: detected no buffering proxy")}),n.c_=!0}}zo(e,t,r,s,i){let a=fu();return new Promise((u,c)=>{let h=new ta;h.setWithCredentials(!0),h.listenOnce(na.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Nr.NO_ERROR:let g=h.getResponseJson();F(Se,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(g)),u(g);break;case Nr.TIMEOUT:F(Se,`RPC '${e}' ${a} timed out`),c(new U(C.DEADLINE_EXCEEDED,"Request time out"));break;case Nr.HTTP_ERROR:let _=h.getStatus();if(F(Se,`RPC '${e}' ${a} failed with status:`,_,"response text:",h.getResponseText()),_>0){let w=h.getResponseJson();Array.isArray(w)&&(w=w[0]);let A=w?.error;if(A&&A.status&&A.message){let R=function(O){let M=O.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(M)>=0?M:C.UNKNOWN}(A.status);c(new U(R,A.message))}else c(new U(C.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new U(C.UNAVAILABLE,"Connection failed."));break;default:$(9055,{l_:e,streamId:a,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{F(Se,`RPC '${e}' ${a} completed.`)}});let f=JSON.stringify(s);F(Se,`RPC '${e}' ${a} sending request:`,s),h.send(t,"POST",f,r,15)})}T_(e,t,r){let s=fu(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let h=i.join("");F(Se,`Creating RPC '${e}' stream ${s}: ${h}`,u);let f=a.createWebChannel(h,u);this.I_(f);let g=!1,_=!1,w=new mu({Ho:A=>{_?F(Se,`Not sending because RPC '${e}' stream ${s} is closed:`,A):(g||(F(Se,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),F(Se,`RPC '${e}' stream ${s} sending:`,A),f.send(A))},Jo:()=>f.close()});return Dr(f,Cn.EventType.OPEN,()=>{_||(F(Se,`RPC '${e}' stream ${s} transport opened.`),w.i_())}),Dr(f,Cn.EventType.CLOSE,()=>{_||(_=!0,F(Se,`RPC '${e}' stream ${s} transport closed`),w.o_(),this.E_(f))}),Dr(f,Cn.EventType.ERROR,A=>{_||(_=!0,pt(Se,`RPC '${e}' stream ${s} transport errored. Name:`,A.name,"Message:",A.message),w.o_(new U(C.UNAVAILABLE,"The operation could not be completed")))}),Dr(f,Cn.EventType.MESSAGE,A=>{if(!_){let R=A.data[0];Z(!!R,16349);let k=R,O=k?.error||k[0]?.error;if(O){F(Se,`RPC '${e}' stream ${s} received error:`,O);let M=O.status,V=function(X){let T=fe[X];if(T!==void 0)return Pd(T)}(M),D=O.message;M==="NOT_FOUND"&&D.includes("database")&&D.includes("does not exist")&&D.includes(this.databaseId.database)&&pt(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),V===void 0&&(V=C.INTERNAL,D="Unknown error status: "+M+" with message "+O.message),_=!0,w.o_(new U(V,D)),f.close()}else F(Se,`RPC '${e}' stream ${s} received:`,R),w.__(R)}}),n.u_(),setTimeout(()=>{w.s_()},0),w}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return ia()}};function qg(n){return new xi(n)}function ca(){return typeof document<"u"?document:null}function Xr(n){return new Ua(n,!0)}xi.c_=!1;var Ci=class{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=s,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&F("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}};var Ah="PersistentStream",Oi=class{constructor(e,t,r,s,i,a,u,c){this.Ci=e,this.b_=r,this.S_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Ci(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return p(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}k_(){return p(this,null,function*(){if(this.O_())return this.close(0)})}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return p(this,null,function*(){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(ft(t.toString()),ft("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.t_(t)})}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{let s=new U(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.H_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(()=>p(this,null,function*(){this.state=0,this.start()}))}z_(e){return F(Ah,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(F(Ah,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},gu=class extends Oi{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=wg(this.serializer,e),r=function(i){if(!("targetChange"in i))return W.min();let a=i.targetChange;return a.targetIds&&a.targetIds.length?W.min():a.readTime?tt(a.readTime):W.min()}(e);return this.listener.J_(t,r)}Z_(e){let t={};t.database=qa(this.serializer),t.addTarget=function(i,a){let u,c=a.target;if(u=Pa(c)?{documents:Tg(i,c)}:{query:Eg(i,c).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=kd(i,a.resumeToken);let h=Fa(i,a.expectedCount);h!==null&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo(W.min())>0){u.readTime=Ii(i,a.snapshotVersion.toTimestamp());let h=Fa(i,a.expectedCount);h!==null&&(u.expectedCount=h)}return u}(this.serializer,e);let r=Ag(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){let t={};t.database=qa(this.serializer),t.removeTarget=e,this.K_(t)}},_u=class extends Oi{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return Z(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Z(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Z(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let t=bg(e.writeResults,e.commitTime),r=tt(e.commitTime);return this.listener.na(r,t)}ra(){let e={};e.database=qa(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>vg(this.serializer,r))};this.K_(t)}};var yu=class{},wu=class extends yu{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new U(C.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Wo(e,Ma(t,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new U(C.UNKNOWN,i.toString())})}jo(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.jo(e,Ma(t,r),s,a,u,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new U(C.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}};function Bg(n,e,t,r){return new wu(n,e,t,r)}var vu=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ft(t),this.aa=!1):F("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var on="RemoteStore",bu=class{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(a=>{r.enqueueAndForget(()=>p(this,null,function*(){ln(this)&&(F(on,"Restarting streams for network reachability change."),yield function(c){return p(this,null,function*(){let h=K(c);h.Ea.add(4),yield Zr(h),h.Va.set("Unknown"),h.Ea.delete(4),yield Xi(h)})}(this))}))}),this.Va=new vu(r,s)}};function Xi(n){return p(this,null,function*(){if(ln(n))for(let e of n.Ra)yield e(!0)})}function Zr(n){return p(this,null,function*(){for(let e of n.Ra)yield e(!1)})}function qd(n,e){let t=K(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Yu(t)?Ju(t):er(t).O_()&&Qu(t,e))}function Hu(n,e){let t=K(n),r=er(t);t.Ia.delete(e),r.O_()&&Bd(t,e),t.Ia.size===0&&(r.O_()?r.L_():ln(t)&&t.Va.set("Unknown"))}function Qu(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(W.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}er(n).Z_(e)}function Bd(n,e){n.da.$e(e),er(n).X_(e)}function Ju(n){n.da=new La({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),er(n).start(),n.Va.ua()}function Yu(n){return ln(n)&&!er(n).x_()&&n.Ia.size>0}function ln(n){return K(n).Ea.size===0}function $d(n){n.da=void 0}function $g(n){return p(this,null,function*(){n.Va.set("Online")})}function zg(n){return p(this,null,function*(){n.Ia.forEach((e,t)=>{Qu(n,e)})})}function Gg(n,e){return p(this,null,function*(){$d(n),Yu(n)?(n.Va.ha(e),Ju(n)):n.Va.set("Unknown")})}function Kg(n,e,t){return p(this,null,function*(){if(n.Va.set("Online"),e instanceof Ti&&e.state===2&&e.cause)try{yield function(s,i){return p(this,null,function*(){let a=i.cause;for(let u of i.targetIds)s.Ia.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.da.removeTarget(u))})}(n,e)}catch(r){F(on,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ni(n,r)}else if(e instanceof Fn?n.da.Xe(e):e instanceof bi?n.da.st(e):n.da.tt(e),!t.isEqual(W.min()))try{let r=yield jd(n.localStore);t.compareTo(r)>=0&&(yield function(i,a){let u=i.da.Tt(a);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){let f=i.Ia.get(h);f&&i.Ia.set(h,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,h)=>{let f=i.Ia.get(c);if(!f)return;i.Ia.set(c,f.withResumeToken(Ee.EMPTY_BYTE_STRING,f.snapshotVersion)),Bd(i,c);let g=new Gr(f.target,c,h,f.sequenceNumber);Qu(i,g)}),i.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(r){F(on,"Failed to raise snapshot:",r),yield Ni(n,r)}})}function Ni(n,e,t){return p(this,null,function*(){if(!Zn(e))throw e;n.Ea.add(1),yield Zr(n),n.Va.set("Offline"),t||(t=()=>jd(n.localStore)),n.asyncQueue.enqueueRetryable(()=>p(null,null,function*(){F(on,"Retrying IndexedDB access"),yield t(),n.Ea.delete(1),yield Xi(n)}))})}function zd(n,e){return e().catch(t=>Ni(n,t,e))}function Zi(n){return p(this,null,function*(){let e=K(n),t=Nt(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Uu;for(;Wg(e);)try{let s=yield Ug(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,Hg(e,s)}catch(s){yield Ni(e,s)}Gd(e)&&Kd(e)})}function Wg(n){return ln(n)&&n.Ta.length<10}function Hg(n,e){n.Ta.push(e);let t=Nt(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function Gd(n){return ln(n)&&!Nt(n).x_()&&n.Ta.length>0}function Kd(n){Nt(n).start()}function Qg(n){return p(this,null,function*(){Nt(n).ra()})}function Jg(n){return p(this,null,function*(){let e=Nt(n);for(let t of n.Ta)e.ea(t.mutations)})}function Yg(n,e,t){return p(this,null,function*(){let r=n.Ta.shift(),s=Oa.from(r,e,t);yield zd(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield Zi(n)})}function Xg(n,e){return p(this,null,function*(){e&&Nt(n).Y_&&(yield function(r,s){return p(this,null,function*(){if(function(a){return lg(a)&&a!==C.ABORTED}(s.code)){let i=r.Ta.shift();Nt(r).B_(),yield zd(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),yield Zi(r)}})}(n,e)),Gd(n)&&Kd(n)})}function Sh(n,e){return p(this,null,function*(){let t=K(n);t.asyncQueue.verifyOperationInProgress(),F(on,"RemoteStore received new credentials");let r=ln(t);t.Ea.add(3),yield Zr(t),r&&t.Va.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),yield Xi(t)})}function Zg(n,e){return p(this,null,function*(){let t=K(n);e?(t.Ea.delete(2),yield Xi(t)):e||(t.Ea.add(2),yield Zr(t),t.Va.set("Unknown"))})}function er(n){return n.ma||(n.ma=function(t,r,s){let i=K(t);return i.sa(),new gu(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Zo:$g.bind(null,n),Yo:zg.bind(null,n),t_:Gg.bind(null,n),J_:Kg.bind(null,n)}),n.Ra.push(e=>p(null,null,function*(){e?(n.ma.B_(),Yu(n)?Ju(n):n.Va.set("Unknown")):(yield n.ma.stop(),$d(n))}))),n.ma}function Nt(n){return n.fa||(n.fa=function(t,r,s){let i=K(t);return i.sa(),new _u(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:Qg.bind(null,n),t_:Xg.bind(null,n),ta:Jg.bind(null,n),na:Yg.bind(null,n)}),n.Ra.push(e=>p(null,null,function*(){e?(n.fa.B_(),yield Zi(n)):(yield n.fa.stop(),n.Ta.length>0&&(F(on,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}var Tu=class n{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new ze,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){let a=Date.now()+r,u=new n(e,t,a,s,i);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new U(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Xu(n,e){if(ft("AsyncQueue",`${e}: ${n}`),Zn(n))return new U(C.UNAVAILABLE,`${e}: ${n}`);throw n}var Hr=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||q.comparator(t.key,r.key):(t,r)=>q.comparator(t.key,r.key),this.keyedMap=Vr(),this.sortedSet=new ce(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Di=class{constructor(){this.ga=new ce(q.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):$(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}},an=class n{constructor(e,t,r,s,i,a,u,c,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,s,i){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new n(e,t,Hr.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ji(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}};var Eu=class{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}},Iu=class{constructor(){this.queries=Rh(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){let s=K(t),i=s.queries;s.queries=Rh(),i.forEach((a,u)=>{for(let c of u.ba)c.onError(r)})})(this,new U(C.ABORTED,"Firestore shutting down"))}};function Rh(){return new _t(n=>gd(n),Ji)}function Wd(n,e){return p(this,null,function*(){let t=K(n),r=3,s=e.query,i=t.queries.get(s);i?!i.Sa()&&e.Da()&&(r=2):(i=new Eu,r=e.Da()?0:1);try{switch(r){case 0:i.wa=yield t.onListen(s,!0);break;case 1:i.wa=yield t.onListen(s,!1);break;case 2:yield t.onFirstRemoteStoreListen(s)}}catch(a){let u=Xu(a,`Initialization of query '${Nn(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,i),i.ba.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&Zu(t)})}function Hd(n,e){return p(this,null,function*(){let t=K(n),r=e.query,s=3,i=t.queries.get(r);if(i){let a=i.ba.indexOf(e);a>=0&&(i.ba.splice(a,1),i.ba.length===0?s=e.Da()?0:1:!i.Sa()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function e_(n,e){let t=K(n),r=!1;for(let s of e){let i=s.query,a=t.queries.get(i);if(a){for(let u of a.ba)u.Fa(s)&&(r=!0);a.wa=s}}r&&Zu(t)}function t_(n,e,t){let r=K(n),s=r.queries.get(e);if(s)for(let i of s.ba)i.onError(t);r.queries.delete(e)}function Zu(n){n.Ca.forEach(e=>{e.next()})}var Au,Ph;(Ph=Au||(Au={})).Ma="default",Ph.Cache="cache";var Vi=class{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let r=[];for(let s of e.docChanges)s.type!==3&&r.push(s);e=new an(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;let r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=an.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Au.Cache}};var Li=class{constructor(e){this.key=e}},Ui=class{constructor(e){this.key=e}},Su=class{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Q(),this.mutatedKeys=Q(),this.eu=_d(e),this.tu=new Hr(this.eu)}get nu(){return this.Za}ru(e,t){let r=t?t.iu:new Di,s=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,a=s,u=!1,c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,h=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((f,g)=>{let _=s.get(f),w=Yi(this.query,g)?g:null,A=!!_&&this.mutatedKeys.has(_.key),R=!!w&&(w.hasLocalMutations||this.mutatedKeys.has(w.key)&&w.hasCommittedMutations),k=!1;_&&w?_.data.isEqual(w.data)?A!==R&&(r.track({type:3,doc:w}),k=!0):this.su(_,w)||(r.track({type:2,doc:w}),k=!0,(c&&this.eu(w,c)>0||h&&this.eu(w,h)<0)&&(u=!0)):!_&&w?(r.track({type:0,doc:w}),k=!0):_&&!w&&(r.track({type:1,doc:_}),k=!0,(c||h)&&(u=!0)),k&&(w?(a=a.add(w),i=R?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:a,iu:r,Ss:u,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let a=e.iu.ya();a.sort((f,g)=>function(w,A){let R=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $(20277,{Vt:k})}};return R(w)-R(A)}(f.type,g.type)||this.eu(f.doc,g.doc)),this.ou(r),s=s??!1;let u=t&&!s?this._u():[],c=this.Ya.size===0&&this.current&&!s?1:0,h=c!==this.Xa;return this.Xa=c,a.length!==0||h?{snapshot:new an(this.query,e.tu,i,a,e.mutatedKeys,c===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Di,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Za=this.Za.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Za=this.Za.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=Q(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))});let t=[];return e.forEach(r=>{this.Ya.has(r)||t.push(new Ui(r))}),this.Ya.forEach(r=>{e.has(r)||t.push(new Li(r))}),t}cu(e){this.Za=e.ks,this.Ya=Q();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return an.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}},ec="SyncEngine",Ru=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Pu=class{constructor(e){this.key=e,this.hu=!1}},ku=class{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new _t(u=>gd(u),Ji),this.Iu=new Map,this.Eu=new Set,this.Ru=new ce(q.comparator),this.Au=new Map,this.Vu=new Wr,this.du={},this.mu=new Map,this.fu=Kr.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function n_(n,e,t=!0){return p(this,null,function*(){let r=ef(n),s,i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=yield Qd(r,e,t,!0),s})}function r_(n,e){return p(this,null,function*(){let t=ef(n);yield Qd(t,e,!0,!1)})}function Qd(n,e,t,r){return p(this,null,function*(){let s=yield Fg(n.localStore,Ze(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t),u;return r&&(u=yield s_(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&qd(n.remoteStore,s),u})}function s_(n,e,t,r,s){return p(this,null,function*(){n.pu=(g,_,w)=>function(R,k,O,M){return p(this,null,function*(){let V=k.view.ru(O);V.Ss&&(V=yield Eh(R.localStore,k.query,!1).then(({documents:T})=>k.view.ru(T,V)));let D=M&&M.targetChanges.get(k.targetId),z=M&&M.targetMismatches.get(k.targetId)!=null,X=k.view.applyChanges(V,R.isPrimaryClient,D,z);return xh(R,k.targetId,X.au),X.snapshot})}(n,g,_,w);let i=yield Eh(n.localStore,e,!0),a=new Su(e,i.ks),u=a.ru(i.documents),c=zr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),h=a.applyChanges(u,n.isPrimaryClient,c);xh(n,t,h.au);let f=new Ru(e,t,a);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot})}function i_(n,e,t){return p(this,null,function*(){let r=K(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(a=>!Ji(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||(yield lu(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Hu(r.remoteStore,s.targetId),xu(r,s.targetId)}).catch(Xn))):(xu(r,s.targetId),yield lu(r.localStore,s.targetId,!0))})}function o_(n,e){return p(this,null,function*(){let t=K(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Hu(t.remoteStore,r.targetId))})}function a_(n,e,t){return p(this,null,function*(){let r=p_(n);try{let s=yield function(a,u){let c=K(a),h=re.now(),f=u.reduce((w,A)=>w.add(A.key),Q()),g,_;return c.persistence.runTransaction("Locally write mutations","readwrite",w=>{let A=yt(),R=Q();return c.xs.getEntries(w,f).next(k=>{A=k,A.forEach((O,M)=>{M.isValidDocument()||(R=R.add(O))})}).next(()=>c.localDocuments.getOverlayedDocuments(w,A)).next(k=>{g=k;let O=[];for(let M of u){let V=cg(M,g.get(M.key).overlayedDocument);V!=null&&O.push(new it(M.key,V,ld(V.value.mapValue),et.exists(!0)))}return c.mutationQueue.addMutationBatch(w,h,O,u)}).next(k=>{_=k;let O=k.applyToLocalDocumentSet(g,R);return c.documentOverlayCache.saveOverlays(w,k.batchId,O)})}).then(()=>({batchId:_.batchId,changes:wd(g)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,u,c){let h=a.du[a.currentUser.toKey()];h||(h=new ce(J)),h=h.insert(u,c),a.du[a.currentUser.toKey()]=h}(r,s.batchId,t),yield es(r,s.changes),yield Zi(r.remoteStore)}catch(s){let i=Xu(s,"Failed to persist write");t.reject(i)}})}function Jd(n,e){return p(this,null,function*(){let t=K(n);try{let r=yield Vg(t.localStore,e);e.targetChanges.forEach((s,i)=>{let a=t.Au.get(i);a&&(Z(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Z(a.hu,14607):s.removedDocuments.size>0&&(Z(a.hu,42227),a.hu=!1))}),yield es(t,r,e)}catch(r){yield Xn(r)}})}function kh(n,e,t){let r=K(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let s=[];r.Tu.forEach((i,a)=>{let u=a.view.va(e);u.snapshot&&s.push(u.snapshot)}),function(a,u){let c=K(a);c.onlineState=u;let h=!1;c.queries.forEach((f,g)=>{for(let _ of g.ba)_.va(u)&&(h=!0)}),h&&Zu(c)}(r.eventManager,e),s.length&&r.Pu.J_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function u_(n,e,t){return p(this,null,function*(){let r=K(n);r.sharedClientState.updateQueryState(e,"rejected",t);let s=r.Au.get(e),i=s&&s.key;if(i){let a=new ce(q.comparator);a=a.insert(i,Ge.newNoDocument(i,W.min()));let u=Q().add(i),c=new vi(W.min(),new Map,new ce(J),a,u);yield Jd(r,c),r.Ru=r.Ru.remove(i),r.Au.delete(e),tc(r)}else yield lu(r.localStore,e,!1).then(()=>xu(r,e,t)).catch(Xn)})}function c_(n,e){return p(this,null,function*(){let t=K(n),r=e.batch.batchId;try{let s=yield Dg(t.localStore,e);Xd(t,r,null),Yd(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield es(t,s)}catch(s){yield Xn(s)}})}function l_(n,e,t){return p(this,null,function*(){let r=K(n);try{let s=yield function(a,u){let c=K(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(g=>(Z(g!==null,37113),f=g.keys(),c.mutationQueue.removeMutationBatch(h,g))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(r.localStore,e);Xd(r,e,t),Yd(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield es(r,s)}catch(s){yield Xn(s)}})}function Yd(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Xd(n,e,t){let r=K(n),s=r.du[r.currentUser.toKey()];if(s){let i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.du[r.currentUser.toKey()]=s}}function xu(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach(r=>{n.Vu.containsKey(r)||Zd(n,r)})}function Zd(n,e){n.Eu.delete(e.path.canonicalString());let t=n.Ru.get(e);t!==null&&(Hu(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),tc(n))}function xh(n,e,t){for(let r of t)r instanceof Li?(n.Vu.addReference(r.key,e),h_(n,r)):r instanceof Ui?(F(ec,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||Zd(n,r.key)):$(19791,{wu:r})}function h_(n,e){let t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(F(ec,"New document in limbo: "+t),n.Eu.add(r),tc(n))}function tc(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){let e=n.Eu.values().next().value;n.Eu.delete(e);let t=new q(ne.fromString(e)),r=n.fu.next();n.Au.set(r,new Pu(t)),n.Ru=n.Ru.insert(t,r),qd(n.remoteStore,new Gr(Ze(Hi(t.path)),r,"TargetPurposeLimboResolution",Lu.ce))}}function es(n,e,t){return p(this,null,function*(){let r=K(n),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((u,c)=>{a.push(r.pu(c,e,t).then(h=>{if((h||t)&&r.isPrimaryClient){let f=h?!h.fromCache:t?.targetChanges.get(c.targetId)?.current;r.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(h){s.push(h);let f=ou.Es(c.targetId,h);i.push(f)}}))}),yield Promise.all(a),r.Pu.J_(s),yield function(c,h){return p(this,null,function*(){let f=K(c);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>N.forEach(h,_=>N.forEach(_.Ts,w=>f.persistence.referenceDelegate.addReference(g,_.targetId,w)).next(()=>N.forEach(_.Is,w=>f.persistence.referenceDelegate.removeReference(g,_.targetId,w)))))}catch(g){if(!Zn(g))throw g;F(Wu,"Failed to update sequence numbers: "+g)}for(let g of h){let _=g.targetId;if(!g.fromCache){let w=f.vs.get(_),A=w.snapshotVersion,R=w.withLastLimboFreeSnapshotVersion(A);f.vs=f.vs.insert(_,R)}}})}(r.localStore,i))})}function d_(n,e){return p(this,null,function*(){let t=K(n);if(!t.currentUser.isEqual(e)){F(ec,"User change. New user:",e.toKey());let r=yield Md(t.localStore,e);t.currentUser=e,function(i,a){i.mu.forEach(u=>{u.forEach(c=>{c.reject(new U(C.CANCELLED,a))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield es(t,r.Ns)}})}function f_(n,e){let t=K(n),r=t.Au.get(e);if(r&&r.hu)return Q().add(r.key);{let s=Q(),i=t.Iu.get(e);if(!i)return s;for(let a of i){let u=t.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function ef(n){let e=K(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Jd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=f_.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=u_.bind(null,e),e.Pu.J_=e_.bind(null,e.eventManager),e.Pu.yu=t_.bind(null,e.eventManager),e}function p_(n){let e=K(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=c_.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=l_.bind(null,e),e}var nc=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){this.serializer=Xr(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)})}Fu(t,r){return null}Mu(t,r){return null}vu(t){return Ng(this.persistence,new uu,t.initialUser,this.serializer)}Cu(t){return new Si(iu.Vi,this.serializer)}Du(t){return new hu}terminate(){return p(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Fi=class extends nc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Z(this.persistence.referenceDelegate instanceof Ri,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new Ka(r,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes!==void 0?Fe.withCacheSize(this.cacheSizeBytes):Fe.DEFAULT;return new Si(r=>Ri.Vi(r,t),this.serializer)}};var tf=(()=>{class n{initialize(t,r){return p(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>kh(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=d_.bind(null,this.syncEngine),yield Zg(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Iu}()}createDatastore(t){let r=Xr(t.databaseInfo.databaseId),s=qg(t.databaseInfo);return Bg(t.authCredentials,t.appCheckCredentials,s,r)}createRemoteStore(t){return function(s,i,a,u,c){return new bu(s,i,a,u,c)}(this.localStore,this.datastore,t.asyncQueue,r=>kh(this.syncEngine,r,0),function(){return ki.v()?new ki:new du}())}createSyncEngine(t,r){return function(i,a,u,c,h,f,g){let _=new ku(i,a,u,c,h,f);return g&&(_.gu=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return p(this,null,function*(){yield function(r){return p(this,null,function*(){let s=K(r);F(on,"RemoteStore shutting down."),s.Ea.add(5),yield Zr(s),s.Aa.shutdown(),s.Va.set("Unknown")})}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return n.provider={build:()=>new n},n})();var Mi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ft("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Dt="FirestoreClient",Cu=class{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=s,this.user=ve.UNAUTHENTICATED,this.clientId=Yt.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,a=>p(this,null,function*(){F(Dt,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(F(Dt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ze;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Xu(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function la(n,e){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),F(Dt,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(s=>p(null,null,function*(){r.isEqual(s)||(yield Md(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Ch(n,e){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield m_(n);F(Dt,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Sh(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Sh(e.remoteStore,s)),n._onlineComponents=e})}function m_(n){return p(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){F(Dt,"Using user provided OfflineComponentProvider");try{yield la(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(s){return s.name==="FirebaseError"?s.code===C.FAILED_PRECONDITION||s.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;pt("Error using user provided cache. Falling back to memory cache: "+t),yield la(n,new nc)}}else F(Dt,"Using default OfflineComponentProvider"),yield la(n,new Fi(void 0));return n._offlineComponents})}function nf(n){return p(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(F(Dt,"Using user provided OnlineComponentProvider"),yield Ch(n,n._uninitializedComponentsProvider._online)):(F(Dt,"Using default OnlineComponentProvider"),yield Ch(n,new tf))),n._onlineComponents})}function g_(n){return nf(n).then(e=>e.syncEngine)}function rf(n){return p(this,null,function*(){let e=yield nf(n),t=e.eventManager;return t.onListen=n_.bind(null,e.syncEngine),t.onUnlisten=i_.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=r_.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=o_.bind(null,e.syncEngine),t})}function sf(n,e,t={}){let r=new ze;return n.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return function(i,a,u,c,h){let f=new Mi({next:_=>{f.Nu(),a.enqueueAndForget(()=>Hd(i,g));let w=_.docs.has(u);!w&&_.fromCache?h.reject(new U(C.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&_.fromCache&&c&&c.source==="server"?h.reject(new U(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),g=new Vi(Hi(u.path),f,{includeMetadataChanges:!0,Ka:!0});return Wd(i,g)}(yield rf(n),n.asyncQueue,e,t,r)})),r.promise}function of(n,e,t={}){let r=new ze;return n.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return function(i,a,u,c,h){let f=new Mi({next:_=>{f.Nu(),a.enqueueAndForget(()=>Hd(i,g)),_.fromCache&&c.source==="server"?h.reject(new U(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),g=new Vi(u,f,{includeMetadataChanges:!0,Ka:!0});return Wd(i,g)}(yield rf(n),n.asyncQueue,e,t,r)})),r.promise}function af(n,e){let t=new ze;return n.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return a_(yield g_(n),e,t)})),t.promise}function uf(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var __="ComponentProvider",Oh=new Map;function y_(n,e,t,r,s){return new ga(n,e,t,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,uf(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,r)}var cf="firestore.googleapis.com",Nh=!0,ji=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new U(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=cf,this.ssl=Nh}else this.host=e.host,this.ssl=e.ssl??Nh;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Fd;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<xg)throw new U(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Mh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=uf(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new U(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new U(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new U(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Hn=class{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ji({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new U(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new U(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ji(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new ci;switch(r.type){case"firstParty":return new fa(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new U(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return p(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=Oh.get(t);r&&(F(__,"Removing Datastore"),Oh.delete(t),r.terminate())}(this),Promise.resolve()}};function lf(n,e,t,r={}){n=Ke(n,Hn);let s=Or(e),i=n._getSettings(),a=xn(ue({},i),{emulatorOptions:n._getEmulatorOptions()}),u=`${e}:${t}`;s&&(zs(`https://${u}`),Ks("Firestore",!0)),i.host!==cf&&i.host!==u&&pt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let c=xn(ue({},i),{host:u,ssl:s,emulatorOptions:r});if(!Zo(c,a)&&(n._setSettings(c),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=ve.MOCK_USER;else{h=Gs(r.mockUserToken,n._app?.options.projectId);let g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new U(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new ve(g)}n._authCredentials=new ha(new ui(h,f))}}var Vt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ge=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ht(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Yn(t,n._jsonSchema))return new n(e,r||null,new q(ne.fromString(t.referencePath)))}};ge._jsonSchemaVersion="firestore/documentReference/1.0",ge._jsonSchema={type:de("string",ge._jsonSchemaVersion),referencePath:de("string")};var ht=class n extends Vt{constructor(e,t,r){super(e,t,Hi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ge(this.firestore,null,new q(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function tr(n,e,...t){if(n=Ve(n),Fh("collection","path",e),n instanceof Hn){let r=ne.fromString(e,...t);return Zl(r),new ht(n,null,r)}{if(!(n instanceof ge||n instanceof ht))throw new U(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ne.fromString(e,...t));return Zl(r),new ht(n.firestore,null,r)}}function hn(n,e,...t){if(n=Ve(n),arguments.length===1&&(e=Yt.newId()),Fh("doc","path",e),n instanceof Hn){let r=ne.fromString(e,...t);return Xl(r),new ge(n,null,new q(r))}{if(!(n instanceof ge||n instanceof ht))throw new U(C.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ne.fromString(e,...t));return Xl(r),new ge(n.firestore,n instanceof ht?n.converter:null,new q(r))}}var Dh="AsyncQueue",qi=class{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ci(this,"async_queue_retry"),this._c=()=>{let r=ca();r&&F(Dh,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;let t=ca();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=ca();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new ze;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}lc(){return p(this,null,function*(){if(this.Yu.length!==0){try{yield this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Zn(e))throw e;F(Dh,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,ft("INTERNAL UNHANDLED ERROR: ",Vh(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let s=Tu.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&$(47125,{Pc:Vh(this.nc)})}verifyOperationInProgress(){}Tc(){return p(this,null,function*(){let e;do e=this.ac,yield e;while(e!==this.ac)})}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function Vh(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}var ot=class extends Hn{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new qi,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return p(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new qi(e),this._firestoreClient=void 0,yield e}})}};function rc(n,e){let t=typeof n=="object"?n:Zs(),r=typeof n=="string"?n:e||_i,s=Js(t,"firestore").getImmediate({identifier:r});if(!s._initialized){let i=$s("firestore");i&&lf(s,...i)}return s}function ts(n){if(n._terminated)throw new U(C.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||w_(n),n._firestoreClient}function w_(n){let e=n._freezeSettings(),t=y_(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Cu(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(s){let i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}}(n._componentsProvider))}var nt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ee.fromBase64String(e))}catch(t){throw new U(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ee.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Yn(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};nt._jsonSchemaVersion="firestore/bytes/1.0",nt._jsonSchema={type:de("string",nt._jsonSchemaVersion),bytes:de("string")};var un=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new U(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Oe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Qn=class{constructor(e){this._methodName=e}};var dt=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new U(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new U(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(Yn(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};dt._jsonSchemaVersion="firestore/geoPoint/1.0",dt._jsonSchema={type:de("string",dt._jsonSchemaVersion),latitude:de("number"),longitude:de("number")};var rt=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Yn(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new U(C.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};rt._jsonSchemaVersion="firestore/vectorValue/1.0",rt._jsonSchema={type:de("string",rt._jsonSchemaVersion),vectorValues:de("object")};var v_=/^__.*__$/,Ou=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new it(e,this.data,this.fieldMask,t,this.fieldTransforms):new sn(e,this.data,t,this.fieldTransforms)}},Bi=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new it(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function hf(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $(40011,{dataSource:n})}}var Nu=class n{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(ue(ue({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return zi(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(hf(this.dataSource)&&v_.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},Du=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Xr(e)}createContext(e,t,r,s=!1){return new Nu({dataSource:e,methodName:t,targetDoc:r,path:Oe.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function eo(n){let e=n._freezeSettings(),t=Xr(n._databaseId);return new Du(n._databaseId,!!e.ignoreUndefinedProperties,t)}function df(n,e,t,r,s,i={}){let a=n.createContext(i.merge||i.mergeFields?2:0,e,t,s);sc("Data must be an object, but it was:",a,r);let u=gf(r,a),c,h;if(i.merge)c=new Me(a.fieldMask),h=a.fieldTransforms;else if(i.mergeFields){let f=[];for(let g of i.mergeFields){let _=cn(e,g,t);if(!a.contains(_))throw new U(C.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);yf(f,_)||f.push(_)}c=new Me(f),h=a.fieldTransforms.filter(g=>c.covers(g.field))}else c=null,h=a.fieldTransforms;return new Ou(new Ce(u),c,h)}var $i=class n extends Qn{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function ff(n,e,t,r){let s=n.createContext(1,e,t);sc("Data must be an object, but it was:",s,r);let i=[],a=Ce.empty();Lt(r,(c,h)=>{let f=ic(e,c,t);h=Ve(h);let g=s.childContextForFieldPath(f);if(h instanceof $i)i.push(f);else{let _=ns(h,g);_!=null&&(i.push(f),a.set(f,_))}});let u=new Me(i);return new Bi(a,u,s.fieldTransforms)}function pf(n,e,t,r,s,i){let a=n.createContext(1,e,t),u=[cn(e,r,t)],c=[s];if(i.length%2!=0)throw new U(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<i.length;_+=2)u.push(cn(e,i[_])),c.push(i[_+1]);let h=[],f=Ce.empty();for(let _=u.length-1;_>=0;--_)if(!yf(h,u[_])){let w=u[_],A=c[_];A=Ve(A);let R=a.childContextForFieldPath(w);if(A instanceof $i)h.push(w);else{let k=ns(A,R);k!=null&&(h.push(w),f.set(w,k))}}let g=new Me(h);return new Bi(f,g,a.fieldTransforms)}function mf(n,e,t,r=!1){return ns(t,n.createContext(r?4:3,e))}function ns(n,e){if(_f(n=Ve(n)))return sc("Unsupported field value:",e,n),gf(n,e);if(n instanceof Qn)return function(r,s){if(!hf(s.dataSource))throw s.createError(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${r._methodName}() is not currently supported inside arrays`);let i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return function(r,s){let i=[],a=0;for(let u of r){let c=ns(u,s.childContextForArray(a));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),a++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Ve(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return sg(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let i=re.fromDate(r);return{timestampValue:Ii(s.serializer,i)}}if(r instanceof re){let i=new re(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ii(s.serializer,i)}}if(r instanceof dt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof nt)return{bytesValue:kd(s.serializer,r._byteString)};if(r instanceof ge){let i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Ku(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof rt)return function(a,u){let c=a instanceof rt?a.toArray():a;return{mapValue:{fields:{[Fu]:{stringValue:Mu},[jn]:{arrayValue:{values:c.map(f=>{if(typeof f!="number")throw u.createError("VectorValues must only contain numeric values.");return Gu(u.serializer,f)})}}}}}}(r,s);if(Ld(r))return r._toProto(s.serializer);throw s.createError(`Unsupported field value: ${Yr(r)}`)}(n,e)}function gf(n,e){let t={};return td(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Lt(n,(r,s)=>{let i=ns(s,e.childContextForField(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function _f(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof re||n instanceof dt||n instanceof nt||n instanceof ge||n instanceof Qn||n instanceof rt||Ld(n))}function sc(n,e,t){if(!_f(t)||!jh(t)){let r=Yr(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function cn(n,e,t){if((e=Ve(e))instanceof un)return e._internalPath;if(typeof e=="string")return ic(n,e);throw zi("Field path arguments must be of type string or ",n,!1,void 0,t)}var b_=new RegExp("[~\\*/\\[\\]]");function ic(n,e,t){if(e.search(b_)>=0)throw zi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new un(...e.split("."))._internalPath}catch{throw zi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function zi(n,e,t,r,s){let i=r&&!r.isEmpty(),a=s!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(i||a)&&(c+=" (found",i&&(c+=` in field ${r}`),a&&(c+=` in document ${s}`),c+=")"),new U(C.INVALID_ARGUMENT,u+n+c)}function yf(n,e){return n.some(t=>t.isEqual(e))}var Qr=class{convertValue(e,t="none"){switch(Ot(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ie(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(gt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Lt(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){let t=e.fields?.[jn].arrayValue?.values?.map(r=>ie(r.doubleValue));return new rt(t)}convertGeoPoint(e){return new dt(ie(e.latitude),ie(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Wi(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(qr(e));default:return null}}convertTimestamp(e){let t=mt(e);return new re(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ne.fromString(e);Z(Vd(r),9688,{name:e});let s=new Br(r.get(1),r.get(3)),i=new q(r.popFirst(5));return s.isEqual(t)||ft(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}};var Jr=class extends Qr{constructor(e){super(),this.firestore=e}convertBytes(e){return new nt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ge(this.firestore,null,t)}};var wf="@firebase/firestore",vf="4.11.0";var to=class{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ge(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new oc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(cn("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},oc=class extends to{data(){return super.data()}};function A_(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new U(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var rs=class{},ac=class extends rs{};function cc(n,e,...t){let r=[];e instanceof rs&&r.push(e),r=r.concat(t),function(i){let a=i.filter(c=>c instanceof uc).length,u=i.filter(c=>c instanceof no).length;if(a>1||a>0&&u>0)throw new U(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let s of r)n=s._apply(n);return n}var no=class n extends ac{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return If(e._query,t),new Vt(e.firestore,e.converter,Qi(e._query,t))}_parse(e){let t=eo(e.firestore);return function(i,a,u,c,h,f,g){let _;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new U(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Tf(g,f);let A=[];for(let R of g)A.push(bf(c,i,R));_={arrayValue:{values:A}}}else _=bf(c,i,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Tf(g,f),_=mf(u,a,g,f==="in"||f==="not-in");return he.create(h,f,_)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function Ef(n,e,t){let r=e,s=cn("where",n);return no._create(s,r,t)}var uc=class n extends rs{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:je.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let a=s,u=i.getFlattenedFilters();for(let c of u)If(a,c),a=Qi(a,c)}(e._query,t),new Vt(e.firestore,e.converter,Qi(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};function bf(n,e,t){if(typeof(t=Ve(t))=="string"){if(t==="")throw new U(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!zu(e)&&t.indexOf("/")!==-1)throw new U(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ne.fromString(t));if(!q.isDocumentKey(r))throw new U(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ju(n,new q(r))}if(t instanceof ge)return ju(n,t._key);throw new U(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yr(t)}.`)}function Tf(n,e){if(!Array.isArray(n)||n.length===0)throw new U(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function If(n,e){let t=function(s,i){for(let a of s)for(let u of a.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new U(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new U(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function S_(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var dn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},fn=class n extends to{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new nr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(cn("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new U(C.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};fn._jsonSchemaVersion="firestore/documentSnapshot/1.0",fn._jsonSchema={type:de("string",fn._jsonSchemaVersion),bundleSource:de("string","DocumentSnapshot"),bundleName:de("string"),bundle:de("string")};var nr=class extends fn{data(e={}){return super.data(e)}},rr=class n{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new dn(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new nr(this._firestore,this._userDataWriter,r.key,r,new dn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new U(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(u=>{let c=new nr(s._firestore,s._userDataWriter,u.doc.key,u.doc,new dn(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>i||u.type!==3).map(u=>{let c=new nr(s._firestore,s._userDataWriter,u.doc.key,u.doc,new dn(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter),h=-1,f=-1;return u.type!==0&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:R_(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new U(C.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Yt.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function R_(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $(61501,{type:n})}}rr._jsonSchemaVersion="firestore/querySnapshot/1.0",rr._jsonSchema={type:de("string",rr._jsonSchemaVersion),bundleSource:de("string","QuerySnapshot"),bundleName:de("string"),bundle:de("string")};function Af(n){n=Ke(n,ge);let e=Ke(n.firestore,ot),t=ts(e);return sf(t,n._key).then(r=>P_(e,n,r))}function ro(n){n=Ke(n,Vt);let e=Ke(n.firestore,ot),t=ts(e),r=new Jr(e);return A_(n._query),of(t,n._query).then(s=>new rr(e,r,n,s))}function Sf(n,e,t,...r){n=Ke(n,ge);let s=Ke(n.firestore,ot),i=eo(s),a;return a=typeof(e=Ve(e))=="string"||e instanceof un?pf(i,"updateDoc",n._key,e,t,r):ff(i,"updateDoc",n._key,e),lc(s,[a.toMutation(n._key,et.exists(!0))])}function Rf(n){return lc(Ke(n.firestore,ot),[new Wn(n._key,et.none())])}function Pf(n,e){let t=Ke(n.firestore,ot),r=hn(n),s=S_(n.converter,e),i=eo(n.firestore);return lc(t,[df(i,"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,et.exists(!1))]).then(()=>r)}function lc(n,e){let t=ts(n);return af(t,e)}function P_(n,e,t){let r=t.docs.get(e._key),s=new Jr(n);return new fn(n,s,e._key,r,new dn(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){Lh(Xs),Qs(new Hs("firestore",(r,{instanceIdentifier:s,options:i})=>{let a=r.getProvider("app").getImmediate(),u=new ot(new li(r.getProvider("auth-internal")),new di(a,r.getProvider("app-check-internal")),od(a,s),a);return i=ue({useFetchStreams:t},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),Ct(wf,vf,e),Ct(wf,vf,"esm2020")})();var k_="firebase",x_="12.9.0";Ct(k_,x_,"app");var Df="firebasestorage.googleapis.com",C_="storageBucket",O_=2*60*1e3,N_=10*60*1e3;var at=class n extends Ws{constructor(e,t,r=0){super(hc(e),`Firebase Storage: ${t} (${hc(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return hc(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},vt=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(vt||{});function hc(n){return"storage/"+n}function D_(){let n="An unknown error occurred, please check the error payload for server response.";return new at(vt.UNKNOWN,n)}function V_(){return new at(vt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function L_(){return new at(vt.CANCELED,"User canceled the upload/download.")}function U_(n){return new at(vt.INVALID_URL,"Invalid URL '"+n+"'.")}function F_(n){return new at(vt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function kf(n){return new at(vt.INVALID_ARGUMENT,n)}function Vf(){return new at(vt.APP_DELETED,"The Firebase app was deleted.")}function M_(n){return new at(vt.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}var wt=class n{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=n.makeFromUrl(e,t)}catch{return new n(e,"")}if(r.path==="")return r;throw F_(e)}static makeFromUrl(e,t){let r=null,s="([A-Za-z0-9.\\-_]+)";function i(D){D.path.charAt(D.path.length-1)==="/"&&(D.path_=D.path_.slice(0,-1))}let a="(/(.*))?$",u=new RegExp("^gs://"+s+a,"i"),c={bucket:1,path:3};function h(D){D.path_=decodeURIComponent(D.path)}let f="v[A-Za-z0-9_]+",g=t.replace(/[.]/g,"\\."),_="(/([^?#]*).*)?$",w=new RegExp(`^https?://${g}/${f}/b/${s}/o${_}`,"i"),A={bucket:1,path:3},R=t===Df?"(?:storage.googleapis.com|storage.cloud.google.com)":t,k="([^?#]*)",O=new RegExp(`^https?://${R}/${s}/${k}`,"i"),V=[{regex:u,indices:c,postModify:i},{regex:w,indices:A,postModify:h},{regex:O,indices:{bucket:1,path:2},postModify:h}];for(let D=0;D<V.length;D++){let z=V[D],X=z.regex.exec(e);if(X){let T=X[z.indices.bucket],y=X[z.indices.path];y||(y=""),r=new n(T,y),z.postModify(r);break}}if(r==null)throw U_(e);return r}},dc=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function j_(n,e,t){let r=1,s=null,i=null,a=!1,u=0;function c(){return u===2}let h=!1;function f(...k){h||(h=!0,e.apply(null,k))}function g(k){s=setTimeout(()=>{s=null,n(w,c())},k)}function _(){i&&clearTimeout(i)}function w(k,...O){if(h){_();return}if(k){_(),f.call(null,k,...O);return}if(c()||a){_(),f.call(null,k,...O);return}r<64&&(r*=2);let V;u===1?(u=2,V=0):V=(r+Math.random())*1e3,g(V)}let A=!1;function R(k){A||(A=!0,_(),!h&&(s!==null?(k||(u=2),clearTimeout(s),g(0)):k||(u=1)))}return g(0),i=setTimeout(()=>{a=!0,R(!0)},t),R}function q_(n){n(!1)}function B_(n){return n!==void 0}function xf(n,e,t,r){if(r<e)throw kf(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw kf(`Invalid value for '${n}'. Expected ${t} or less.`)}function $_(n){let e=encodeURIComponent,t="?";for(let r in n)if(n.hasOwnProperty(r)){let s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var fc=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(fc||{});function z_(n,e){let t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}var pc=class{constructor(e,t,r,s,i,a,u,c,h,f,g,_=!0,w=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=a,this.callback_=u,this.errorCallback_=c,this.timeout_=h,this.progressCallback_=f,this.connectionFactory_=g,this.retry=_,this.isUsingEmulator=w,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((A,R)=>{this.resolve_=A,this.reject_=R,this.start_()})}start_(){let e=(r,s)=>{if(s){r(!1,new sr(!1,null,!0));return}let i=this.connectionFactory_();this.pendingConnection_=i;let a=u=>{let c=u.loaded,h=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,h)};this.progressCallback_!==null&&i.addUploadProgressListener(a),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(a),this.pendingConnection_=null;let u=i.getErrorCode()===fc.NO_ERROR,c=i.getStatus();if(!u||z_(c,this.additionalRetryCodes_)&&this.retry){let f=i.getErrorCode()===fc.ABORT;r(!1,new sr(!1,null,f));return}let h=this.successCodes_.indexOf(c)!==-1;r(!0,new sr(h,i))})},t=(r,s)=>{let i=this.resolve_,a=this.reject_,u=s.connection;if(s.wasSuccessCode)try{let c=this.callback_(u,u.getResponse());B_(c)?i(c):i()}catch(c){a(c)}else if(u!==null){let c=D_();c.serverResponse=u.getErrorText(),this.errorCallback_?a(this.errorCallback_(u,c)):a(c)}else if(s.canceled){let c=this.appDelete_?Vf():L_();a(c)}else{let c=V_();a(c)}};this.canceled_?t(!1,new sr(!1,null,!0)):this.backoffId_=j_(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&q_(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},sr=class{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}};function G_(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function K_(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function W_(n,e){e&&(n["X-Firebase-GMPID"]=e)}function H_(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function Q_(n,e,t,r,s,i,a=!0,u=!1){let c=$_(n.urlParams),h=n.url+c,f=Object.assign({},n.headers);return W_(f,e),G_(f,t),K_(f,i),H_(f,r),new pc(h,n.method,f,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,a,u)}function J_(n){if(n.length===0)return null;let e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function Y_(n){let e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}var _b=256*1024;var mc=class n{constructor(e,t){this._service=e,t instanceof wt?this._location=t:this._location=wt.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new n(e,t)}get root(){let e=new wt(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Y_(this._location.path)}get storage(){return this._service}get parent(){let e=J_(this._location.path);if(e===null)return null;let t=new wt(this._location.bucket,e);return new n(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw M_(e)}};function Cf(n,e){let t=e?.[C_];return t==null?null:wt.makeFromBucketSpec(t,n)}function X_(n,e,t,r={}){n.host=`${e}:${t}`;let s=Or(e);s&&(zs(`https://${n.host}/b`),Ks("Storage",!0)),n._isUsingEmulator=!0,n._protocol=s?"https":"http";let{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:Gs(i,n.app.options.projectId))}var gc=class{constructor(e,t,r,s,i,a=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=a,this._bucket=null,this._host=Df,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=O_,this._maxUploadRetryTime=N_,this._requests=new Set,s!=null?this._bucket=wt.makeFromBucketSpec(s,this._host):this._bucket=Cf(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=wt.makeFromBucketSpec(this._url,e):this._bucket=Cf(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){xf("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){xf("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return p(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return p(this,null,function*(){if(Ys(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new mc(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new dc(Vf());{let a=Q_(e,this._appId,r,s,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}makeRequestWithTokens(e,t){return p(this,null,function*(){let[r,s]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()})}},Of="@firebase/storage",Nf="0.14.0";var Lf="storage";function Uf(n=Zs(),e){n=Ve(n);let r=Js(n,Lf).getImmediate({identifier:e}),s=$s("storage");return s&&Z_(r,...s),r}function Z_(n,e,t,r={}){X_(n,e,t,r)}function ey(n,{instanceIdentifier:e}){let t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new gc(t,r,s,e,Xs)}function ty(){Qs(new Hs(Lf,ey,"PUBLIC").setMultipleInstances(!0)),Ct(Of,Nf,""),Ct(Of,Nf,"esm2020")}ty();var ss={production:!1,firebase:{apiKey:"AIzaSyDRRkm-8rAzL_CphPIe_iuk6VqBbIimICU",authDomain:"game-portfolio-e922f.firebaseapp.com",projectId:"game-portfolio-e922f",storageBucket:"game-portfolio-e922f.firebasestorage.app",messagingSenderId:"654613936705",appId:"1:654613936705:web:a0215cd64670f09c1724c0"},supabase:{url:"https://bgqxmvxpxacitjckgqvn.supabase.co",anonKey:"sb_publishable_Cx4CDeEVduENCUAv1IU0Pg_cmekPz9Z"}};var ny=ss.firebase,Ff=Hl(ny),Ut=rc(Ff),Rb=Uf(Ff);var Mf=class n{collectionName="projects";getAll(){return De(ro(tr(Ut,this.collectionName))).pipe(Ue(e=>e.docs.map(t=>ue({id:t.id},t.data()))))}getById(e){return De(Af(hn(Ut,this.collectionName,e))).pipe(Ue(t=>t.exists()?ue({id:t.id},t.data()):void 0))}getByCategory(e){return De(ro(cc(tr(Ut,this.collectionName),Ef("category","array-contains",e)))).pipe(Ue(t=>t.docs.map(r=>ue({id:r.id},r.data()))))}getGroupedByCategory(){return this.getAll().pipe(Ue(e=>{let t=new Map;return e.forEach(r=>{(Array.isArray(r.category)?r.category:[r.category]).forEach(i=>{t.has(i)||t.set(i,[]),t.get(i).push(r)})}),t}))}create(e){return De(Pf(tr(Ut,this.collectionName),xn(ue({},e),{createdAt:re.now(),updatedAt:re.now()}))).pipe(Ue(t=>t.id))}update(e,t){return De(Sf(hn(Ut,this.collectionName,e),xn(ue({},t),{updatedAt:re.now()})))}delete(e){return De(Rf(hn(Ut,this.collectionName,e)))}search(e){return De(ro(cc(tr(Ut,this.collectionName),...e))).pipe(Ue(t=>t.docs.map(r=>ue({id:r.id},r.data()))))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Bs({token:n,factory:n.\u0275fac,providedIn:"root"})};var jf=n=>n?(...e)=>n(...e):(...e)=>fetch(...e);var ir=class extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}},is=class extends ir{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}},or=class extends ir{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}},ar=class extends ir{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}},so=function(n){return n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2",n}(so||{});var os=class{constructor(e,{headers:t={},customFetch:r,region:s=so.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=jf(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return $l(this,arguments,void 0,function*(t,r={}){var s;let i,a;try{let{headers:u,method:c,body:h,signal:f,timeout:g}=r,_={},{region:w}=r;w||(w=this.region);let A=new URL(`${this.url}/${t}`);w&&w!=="any"&&(_["x-region"]=w,A.searchParams.set("forceFunctionRegion",w));let R;h&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)?typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(_["Content-Type"]="application/octet-stream",R=h):typeof h=="string"?(_["Content-Type"]="text/plain",R=h):typeof FormData<"u"&&h instanceof FormData?R=h:(_["Content-Type"]="application/json",R=JSON.stringify(h)):h&&typeof h!="string"&&!(typeof Blob<"u"&&h instanceof Blob)&&!(h instanceof ArrayBuffer)&&!(typeof FormData<"u"&&h instanceof FormData)?R=JSON.stringify(h):R=h;let k=f;g&&(a=new AbortController,i=setTimeout(()=>a.abort(),g),f?(k=a.signal,f.addEventListener("abort",()=>a.abort())):k=a.signal);let O=yield this.fetch(A.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},_),this.headers),u),body:R,signal:k}).catch(z=>{throw new is(z)}),M=O.headers.get("x-relay-error");if(M&&M==="true")throw new or(O);if(!O.ok)throw new ar(O);let V=((s=O.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),D;return V==="application/json"?D=yield O.json():V==="application/octet-stream"||V==="application/pdf"?D=yield O.blob():V==="text/event-stream"?D=O:V==="multipart/form-data"?D=yield O.formData():D=yield O.text(),{data:D,error:null,response:O}}catch(u){return{data:null,error:u,response:u instanceof ar||u instanceof or?u.context:void 0}}finally{i&&clearTimeout(i)}})}};var $f=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},sy=class{constructor(n){var e,t,r;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(e=n.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=n.signal,this.isMaybeSingle=(t=n.isMaybeSingle)!==null&&t!==void 0?t:!1,this.urlLengthLimit=(r=n.urlLengthLimit)!==null&&r!==void 0?r:8e3,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,e){return this.headers=new Headers(this.headers),this.headers.set(n,e),this}then(n,e){var t=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");let r=this.fetch,s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(i=>p(this,null,function*(){let a=null,u=null,c=null,h=i.status,f=i.statusText;if(i.ok){var g,_;if(t.method!=="HEAD"){var w;let O=yield i.text();O===""||(t.headers.get("Accept")==="text/csv"||t.headers.get("Accept")&&(!((w=t.headers.get("Accept"))===null||w===void 0)&&w.includes("application/vnd.pgrst.plan+text"))?u=O:u=JSON.parse(O))}let R=(g=t.headers.get("Prefer"))===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),k=(_=i.headers.get("content-range"))===null||_===void 0?void 0:_.split("/");R&&k&&k.length>1&&(c=parseInt(k[1])),t.isMaybeSingle&&t.method==="GET"&&Array.isArray(u)&&(u.length>1?(a={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,c=null,h=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{var A;let R=yield i.text();try{a=JSON.parse(R),Array.isArray(a)&&i.status===404&&(u=[],a=null,h=200,f="OK")}catch{i.status===404&&R===""?(h=204,f="No Content"):a={message:R}}if(a&&t.isMaybeSingle&&(!(a==null||(A=a.details)===null||A===void 0)&&A.includes("0 rows"))&&(a=null,h=200,f="OK"),a&&t.shouldThrowOnError)throw new $f(a)}return{error:a,data:u,count:c,status:h,statusText:f}}));return this.shouldThrowOnError||(s=s.catch(i=>{var a;let u="",c="",h="",f=i?.cause;if(f){var g,_,w,A;let O=(g=f?.message)!==null&&g!==void 0?g:"",M=(_=f?.code)!==null&&_!==void 0?_:"";u=`${(w=i?.name)!==null&&w!==void 0?w:"FetchError"}: ${i?.message}`,u+=`

Caused by: ${(A=f?.name)!==null&&A!==void 0?A:"Error"}: ${O}`,M&&(u+=` (${M})`),f?.stack&&(u+=`
${f.stack}`)}else{var R;u=(R=i?.stack)!==null&&R!==void 0?R:""}let k=this.url.toString().length;return i?.name==="AbortError"||i?.code==="ABORT_ERR"?(h="",c="Request was aborted (timeout or manual cancellation)",k>this.urlLengthLimit&&(c+=`. Note: Your request URL is ${k} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):(f?.name==="HeadersOverflowError"||f?.code==="UND_ERR_HEADERS_OVERFLOW")&&(h="",c="HTTP headers exceeded server limits (typically 16KB)",k>this.urlLengthLimit&&(c+=`. Your request URL is ${k} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(a=i?.name)!==null&&a!==void 0?a:"FetchError"}: ${i?.message}`,details:u,hint:c,code:h},data:null,count:null,status:0,statusText:""}})),s.then(n,e)}returns(){return this}overrideTypes(){return this}},iy=class extends sy{select(n){let e=!1,t=(n??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",t),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:e=!0,nullsFirst:t,foreignTable:r,referencedTable:s=r}={}){let i=s?`${s}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${n}.${e?"asc":"desc"}${t===void 0?"":t?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:e,referencedTable:t=e}={}){let r=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${n}`),this}range(n,e,{foreignTable:t,referencedTable:r=t}={}){let s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${n}`),this.url.searchParams.set(i,`${e-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:e=!1,settings:t=!1,buffers:r=!1,wal:s=!1,format:i="text"}={}){var a;let u=[n?"analyze":null,e?"verbose":null,t?"settings":null,r?"buffers":null,s?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${c}"; options=${u};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}},qf=new RegExp("[,()]"),ur=class extends iy{eq(n,e){return this.url.searchParams.append(n,`eq.${e}`),this}neq(n,e){return this.url.searchParams.append(n,`neq.${e}`),this}gt(n,e){return this.url.searchParams.append(n,`gt.${e}`),this}gte(n,e){return this.url.searchParams.append(n,`gte.${e}`),this}lt(n,e){return this.url.searchParams.append(n,`lt.${e}`),this}lte(n,e){return this.url.searchParams.append(n,`lte.${e}`),this}like(n,e){return this.url.searchParams.append(n,`like.${e}`),this}likeAllOf(n,e){return this.url.searchParams.append(n,`like(all).{${e.join(",")}}`),this}likeAnyOf(n,e){return this.url.searchParams.append(n,`like(any).{${e.join(",")}}`),this}ilike(n,e){return this.url.searchParams.append(n,`ilike.${e}`),this}ilikeAllOf(n,e){return this.url.searchParams.append(n,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(n,e){return this.url.searchParams.append(n,`ilike(any).{${e.join(",")}}`),this}regexMatch(n,e){return this.url.searchParams.append(n,`match.${e}`),this}regexIMatch(n,e){return this.url.searchParams.append(n,`imatch.${e}`),this}is(n,e){return this.url.searchParams.append(n,`is.${e}`),this}isDistinct(n,e){return this.url.searchParams.append(n,`isdistinct.${e}`),this}in(n,e){let t=Array.from(new Set(e)).map(r=>typeof r=="string"&&qf.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(n,`in.(${t})`),this}notIn(n,e){let t=Array.from(new Set(e)).map(r=>typeof r=="string"&&qf.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(n,`not.in.(${t})`),this}contains(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cs.{${e.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(e)}`),this}containedBy(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cd.{${e.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(e)}`),this}rangeGt(n,e){return this.url.searchParams.append(n,`sr.${e}`),this}rangeGte(n,e){return this.url.searchParams.append(n,`nxl.${e}`),this}rangeLt(n,e){return this.url.searchParams.append(n,`sl.${e}`),this}rangeLte(n,e){return this.url.searchParams.append(n,`nxr.${e}`),this}rangeAdjacent(n,e){return this.url.searchParams.append(n,`adj.${e}`),this}overlaps(n,e){return typeof e=="string"?this.url.searchParams.append(n,`ov.${e}`):this.url.searchParams.append(n,`ov.{${e.join(",")}}`),this}textSearch(n,e,{config:t,type:r}={}){let s="";r==="plain"?s="pl":r==="phrase"?s="ph":r==="websearch"&&(s="w");let i=t===void 0?"":`(${t})`;return this.url.searchParams.append(n,`${s}fts${i}.${e}`),this}match(n){return Object.entries(n).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(n,e,t){return this.url.searchParams.append(n,`not.${e}.${t}`),this}or(n,{foreignTable:e,referencedTable:t=e}={}){let r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${n})`),this}filter(n,e,t){return this.url.searchParams.append(n,`${e}.${t}`),this}},oy=class{constructor(n,{headers:e={},schema:t,fetch:r,urlLengthLimit:s=8e3}){this.url=n,this.headers=new Headers(e),this.schema=t,this.fetch=r,this.urlLengthLimit=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(n,e){let{head:t=!1,count:r}=e??{},s=t?"HEAD":"GET",i=!1,a=(n??"*").split("").map(h=>/\s/.test(h)&&!i?"":(h==='"'&&(i=!i),h)).join(""),{url:u,headers:c}=this.cloneRequestState();return u.searchParams.set("select",a),r&&c.append("Prefer",`count=${r}`),new ur({method:s,url:u,headers:c,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(n,{count:e,defaultToNull:t=!0}={}){var r;let s="POST",{url:i,headers:a}=this.cloneRequestState();if(e&&a.append("Prefer",`count=${e}`),t||a.append("Prefer","missing=default"),Array.isArray(n)){let u=n.reduce((c,h)=>c.concat(Object.keys(h)),[]);if(u.length>0){let c=[...new Set(u)].map(h=>`"${h}"`);i.searchParams.set("columns",c.join(","))}}return new ur({method:s,url:i,headers:a,schema:this.schema,body:n,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(n,{onConflict:e,ignoreDuplicates:t=!1,count:r,defaultToNull:s=!0}={}){var i;let a="POST",{url:u,headers:c}=this.cloneRequestState();if(c.append("Prefer",`resolution=${t?"ignore":"merge"}-duplicates`),e!==void 0&&u.searchParams.set("on_conflict",e),r&&c.append("Prefer",`count=${r}`),s||c.append("Prefer","missing=default"),Array.isArray(n)){let h=n.reduce((f,g)=>f.concat(Object.keys(g)),[]);if(h.length>0){let f=[...new Set(h)].map(g=>`"${g}"`);u.searchParams.set("columns",f.join(","))}}return new ur({method:a,url:u,headers:c,schema:this.schema,body:n,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}update(n,{count:e}={}){var t;let r="PATCH",{url:s,headers:i}=this.cloneRequestState();return e&&i.append("Prefer",`count=${e}`),new ur({method:r,url:s,headers:i,schema:this.schema,body:n,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:n}={}){var e;let t="DELETE",{url:r,headers:s}=this.cloneRequestState();return n&&s.append("Prefer",`count=${n}`),new ur({method:t,url:r,headers:s,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function as(n){"@babel/helpers - typeof";return as=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},as(n)}function ay(n,e){if(as(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(as(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function uy(n){var e=ay(n,"string");return as(e)=="symbol"?e:e+""}function cy(n,e,t){return(e=uy(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Bf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function io(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Bf(Object(t),!0).forEach(function(r){cy(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Bf(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var zf=class Gf{constructor(e,{headers:t={},schema:r,fetch:s,timeout:i,urlLengthLimit:a=8e3}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.urlLengthLimit=a;let u=s??globalThis.fetch;i!==void 0&&i>0?this.fetch=(c,h)=>{let f=new AbortController,g=setTimeout(()=>f.abort(),i),_=h?.signal;if(_){if(_.aborted)return clearTimeout(g),u(c,h);let w=()=>{clearTimeout(g),f.abort()};return _.addEventListener("abort",w,{once:!0}),u(c,io(io({},h),{},{signal:f.signal})).finally(()=>{clearTimeout(g),_.removeEventListener("abort",w)})}return u(c,io(io({},h),{},{signal:f.signal})).finally(()=>clearTimeout(g))}:this.fetch=u}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new oy(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new Gf(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,t={},{head:r=!1,get:s=!1,count:i}={}){var a;let u,c=new URL(`${this.url}/rpc/${e}`),h,f=w=>w!==null&&typeof w=="object"&&(!Array.isArray(w)||w.some(f)),g=r&&Object.values(t).some(f);g?(u="POST",h=t):r||s?(u=r?"HEAD":"GET",Object.entries(t).filter(([w,A])=>A!==void 0).map(([w,A])=>[w,Array.isArray(A)?`{${A.join(",")}}`:`${A}`]).forEach(([w,A])=>{c.searchParams.append(w,A)})):(u="POST",h=t);let _=new Headers(this.headers);return g?_.set("Prefer",i?`count=${i},return=minimal`:"return=minimal"):i&&_.set("Prefer",`count=${i}`),new ur({method:u,url:c,headers:_,schema:this.schemaName,body:h,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch,urlLengthLimit:this.urlLengthLimit})}};var _c=class{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};let t=globalThis.process;if(t){let r=t.versions;if(r&&r.node){let s=r.node,i=parseInt(s.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){let r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{let e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}},yc=_c;var Kf="2.95.3";var Wf=`realtime-js/${Kf}`,Hf="1.0.0",wc="2.0.0",vc=wc;var us=1e4,Qf=1e3,Jf=100,Ft=function(n){return n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed",n}(Ft||{}),_e=function(n){return n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving",n}(_e||{}),qe=function(n){return n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token",n}(qe||{}),bc=function(n){return n.websocket="websocket",n}(bc||{}),pn=function(n){return n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed",n}(pn||{});var oo=class{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,r;let s=(r=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var t,r;let s=(r=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&r!==void 0?r:{},a=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,a)}_encodeUserBroadcastPush(e,t,r){var s,i;let a=e.topic,u=(s=e.ref)!==null&&s!==void 0?s:"",c=(i=e.join_ref)!==null&&i!==void 0?i:"",h=e.payload.event,f=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},g=Object.keys(f).length===0?"":JSON.stringify(f);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`ref length ${u.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`topic length ${a.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`userEvent length ${h.length} exceeds maximum of 255`);if(g.length>255)throw new Error(`metadata length ${g.length} exceeds maximum of 255`);let _=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+u.length+a.length+h.length+g.length,w=new ArrayBuffer(this.HEADER_LENGTH+_),A=new DataView(w),R=0;A.setUint8(R++,this.KINDS.userBroadcastPush),A.setUint8(R++,c.length),A.setUint8(R++,u.length),A.setUint8(R++,a.length),A.setUint8(R++,h.length),A.setUint8(R++,g.length),A.setUint8(R++,t),Array.from(c,O=>A.setUint8(R++,O.charCodeAt(0))),Array.from(u,O=>A.setUint8(R++,O.charCodeAt(0))),Array.from(a,O=>A.setUint8(R++,O.charCodeAt(0))),Array.from(h,O=>A.setUint8(R++,O.charCodeAt(0))),Array.from(g,O=>A.setUint8(R++,O.charCodeAt(0)));var k=new Uint8Array(w.byteLength+r.byteLength);return k.set(new Uint8Array(w),0),k.set(new Uint8Array(r),w.byteLength),k.buffer}decode(e,t){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return t(r)}if(typeof e=="string"){let r=JSON.parse(e),[s,i,a,u,c]=r;return t({join_ref:s,ref:i,topic:a,event:u,payload:c})}return t({})}_binaryDecode(e){let t=new DataView(e),r=t.getUint8(0),s=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,s)}}_decodeUserBroadcast(e,t,r){let s=t.getUint8(1),i=t.getUint8(2),a=t.getUint8(3),u=t.getUint8(4),c=this.HEADER_LENGTH+4,h=r.decode(e.slice(c,c+s));c=c+s;let f=r.decode(e.slice(c,c+i));c=c+i;let g=r.decode(e.slice(c,c+a));c=c+a;let _=e.slice(c,e.byteLength),w=u===this.JSON_ENCODING?JSON.parse(r.decode(_)):_,A={type:this.BROADCAST_EVENT,event:f,payload:w};return a>0&&(A.meta=JSON.parse(g)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST_EVENT,payload:A}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e?.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([r])=>t.includes(r)))}};var cr=class{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var se=function(n){return n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange",n}(se||{}),Ec=(n,e,t={})=>{var r;let s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,a)=>(i[a]=ly(a,n,e,s),i),{}):{}},ly=(n,e,t,r)=>{let s=e.find(u=>u.name===n),i=s?.type,a=t[n];return i&&!r.includes(i)?Yf(i,a):Tc(a)},Yf=(n,e)=>{if(n.charAt(0)==="_"){let t=n.slice(1,n.length);return py(e,t)}switch(n){case se.bool:return hy(e);case se.float4:case se.float8:case se.int2:case se.int4:case se.int8:case se.numeric:case se.oid:return dy(e);case se.json:case se.jsonb:return fy(e);case se.timestamp:return my(e);case se.abstime:case se.date:case se.daterange:case se.int4range:case se.int8range:case se.money:case se.reltime:case se.text:case se.time:case se.timestamptz:case se.timetz:case se.tsrange:case se.tstzrange:return Tc(e);default:return Tc(e)}},Tc=n=>n,hy=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},dy=n=>{if(typeof n=="string"){let e=parseFloat(n);if(!Number.isNaN(e))return e}return n},fy=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},py=(n,e)=>{if(typeof n!="string")return n;let t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i,a=n.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(u=>Yf(e,u))}return n},my=n=>typeof n=="string"?n.replace(" ","T"):n,ao=n=>{let e=new URL(n);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};var lr=class{constructor(e,t,r={},s=us){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}};var cs=class n{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{let{onJoin:i,onLeave:a,onSync:u}=this.caller;this.joinRef=this.channel._joinRef(),this.state=n.syncState(this.state,s,i,a),this.pendingDiffs.forEach(c=>{this.state=n.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],u()}),this.channel._on(r.diff,{},s=>{let{onJoin:i,onLeave:a,onSync:u}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=n.syncDiff(this.state,s,i,a),u())}),this.onJoin((s,i,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:a})}),this.onLeave((s,i,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){let i=this.cloneDeep(e),a=this.transformState(t),u={},c={};return this.map(i,(h,f)=>{a[h]||(c[h]=f)}),this.map(a,(h,f)=>{let g=i[h];if(g){let _=f.map(k=>k.presence_ref),w=g.map(k=>k.presence_ref),A=f.filter(k=>w.indexOf(k.presence_ref)<0),R=g.filter(k=>_.indexOf(k.presence_ref)<0);A.length>0&&(u[h]=A),R.length>0&&(c[h]=R)}else u[h]=f}),this.syncDiff(i,{joins:u,leaves:c},r,s)}static syncDiff(e,t,r,s){let{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(u,c)=>{var h;let f=(h=e[u])!==null&&h!==void 0?h:[];if(e[u]=this.cloneDeep(c),f.length>0){let g=e[u].map(w=>w.presence_ref),_=f.filter(w=>g.indexOf(w.presence_ref)<0);e[u].unshift(..._)}r(u,f,c)}),this.map(a,(u,c)=>{let h=e[u];if(!h)return;let f=c.map(g=>g.presence_ref);h=h.filter(g=>f.indexOf(g.presence_ref)<0),e[u]=h,s(u,h,c),h.length===0&&delete e[u]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{let s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var ls=function(n){return n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system",n}(ls||{}),bt=function(n){return n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR",n}(bt||{});var hs=class n{constructor(e,t={config:{}},r){var s,i;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=_e.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new lr(this,qe.join,this.params,this.timeout),this.rejoinTimer=new cr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=_e.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=_e.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=_e.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=_e.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=_e.errored,this.rejoinTimer.scheduleTimeout())}),this._on(qe.reply,{},(a,u)=>{this._trigger(this._replyEventName(u),a)}),this.presence=new cs(this),this.broadcastEndpointURL=ao(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==_e.closed){let{config:{broadcast:a,presence:u,private:c}}=this.params,h=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(w=>w.filter))!==null&&s!==void 0?s:[],f=!!this.bindings[ls.PRESENCE]&&this.bindings[ls.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,g={},_={broadcast:a,presence:Object.assign(Object.assign({},u),{enabled:f}),postgres_changes:h,private:c};this.socket.accessTokenValue&&(g.access_token=this.socket.accessTokenValue),this._onError(w=>e?.(bt.CHANNEL_ERROR,w)),this._onClose(()=>e?.(bt.CLOSED)),this.updateJoinPayload(Object.assign({config:_},g)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",A=>p(this,[A],function*({postgres_changes:w}){var R;if(this.socket._isManualToken()||this.socket.setAuth(),w===void 0){e?.(bt.SUBSCRIBED);return}else{let k=this.bindings.postgres_changes,O=(R=k?.length)!==null&&R!==void 0?R:0,M=[];for(let V=0;V<O;V++){let D=k[V],{filter:{event:z,schema:X,table:T,filter:y}}=D,b=w&&w[V];if(b&&b.event===z&&n.isFilterValueEqual(b.schema,X)&&n.isFilterValueEqual(b.table,T)&&n.isFilterValueEqual(b.filter,y))M.push(Object.assign(Object.assign({},D),{id:b.id}));else{this.unsubscribe(),this.state=_e.errored,e?.(bt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=M,e&&e(bt.SUBSCRIBED);return}})).receive("error",w=>{this.state=_e.errored,e?.(bt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(w).join(", ")||"error")))}).receive("timeout",()=>{e?.(bt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(r){return p(this,arguments,function*(e,t={}){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(){return p(this,arguments,function*(e={}){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this.state===_e.joined&&e===ls.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>p(this,null,function*(){return yield this.subscribe()}))),this._on(e,t,r)}httpSend(s,i){return p(this,arguments,function*(e,t,r={}){var a;if(t==null)return Promise.reject("Payload is required for httpSend()");let u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);let c={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},h=yield this._fetchWithTimeout(this.broadcastEndpointURL,c,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);if(h.status===202)return{success:!0};let f=h.statusText;try{let g=yield h.json();f=g.error||g.message||f}catch{}return Promise.reject(new Error(f))})}send(r){return p(this,arguments,function*(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:a,payload:u}=e,c={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(c.Authorization=`Bearer ${this.socket.accessTokenValue}`);let h={method:"POST",headers:c,body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:u,private:this.private}]})};try{let f=yield this._fetchWithTimeout(this.broadcastEndpointURL,h,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return yield(i=f.body)===null||i===void 0?void 0:i.cancel(),f.ok?"ok":"error"}catch(f){return f.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var u,c,h;let f=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((h=(c=(u=this.params)===null||u===void 0?void 0:u.config)===null||c===void 0?void 0:c.broadcast)===null||h===void 0)&&h.ack)&&a("ok"),f.receive("ok",()=>a("ok")),f.receive("error",()=>a("error")),f.receive("timeout",()=>a("timed out"))})})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=_e.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(qe.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new lr(this,qe.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=_e.closed,this.bindings={}}_fetchWithTimeout(e,t,r){return p(this,null,function*(){let s=new AbortController,i=setTimeout(()=>s.abort(),r),a=yield this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),a})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new lr(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Jf){let t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;let a=e.toLocaleLowerCase(),{close:u,error:c,leave:h,join:f}=qe;if(r&&[u,c,h,f].indexOf(a)>=0&&r!==this._joinRef())return;let _=this._onMessage(a,t,r);if(t&&!_)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(w=>{var A,R,k;return((A=w.filter)===null||A===void 0?void 0:A.event)==="*"||((k=(R=w.filter)===null||R===void 0?void 0:R.event)===null||k===void 0?void 0:k.toLocaleLowerCase())===a}).map(w=>w.callback(_,r)):(i=this.bindings[a])===null||i===void 0||i.filter(w=>{var A,R,k,O,M,V;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in w){let D=w.id,z=(A=w.filter)===null||A===void 0?void 0:A.event;return D&&((R=t.ids)===null||R===void 0?void 0:R.includes(D))&&(z==="*"||z?.toLocaleLowerCase()===((k=t.data)===null||k===void 0?void 0:k.type.toLocaleLowerCase()))}else{let D=(M=(O=w?.filter)===null||O===void 0?void 0:O.event)===null||M===void 0?void 0:M.toLocaleLowerCase();return D==="*"||D===((V=t?.event)===null||V===void 0?void 0:V.toLocaleLowerCase())}else return w.type.toLocaleLowerCase()===a}).map(w=>{if(typeof _=="object"&&"ids"in _){let A=_.data,{schema:R,table:k,commit_timestamp:O,type:M,errors:V}=A;_=Object.assign(Object.assign({},{schema:R,table:k,commit_timestamp:O,eventType:M,new:{},old:{},errors:V}),this._getPayloadRecords(A))}w.callback(_,r)})}_isClosed(){return this.state===_e.closed}_isJoined(){return this.state===_e.joined}_isJoining(){return this.state===_e.joining}_isLeaving(){return this.state===_e.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){let s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){let r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&n.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let r in e)if(e[r]!==t[r])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(qe.close,{},e)}_onError(e){this._on(qe.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=_e.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ec(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ec(e.columns,e.old_record)),t}};var Ic=()=>{},uo={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},_y=[1e3,2e3,5e3,1e4],yy=1e4,wy=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,ds=class{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=us,this.transport=null,this.heartbeatIntervalMs=uo.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ic,this.ref=0,this.reconnectTimer=null,this.vsn=vc,this.logger=Ic,this.conn=null,this.sendBuffer=[],this.serializer=new oo,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((r=t?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${bc.websocket}`,this.httpEndpoint=ao(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=yc.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");let t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}removeChannel(e){return p(this,null,function*(){let t=yield e.unsubscribe();return t==="ok"&&this._remove(e),this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return p(this,null,function*(){let e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ft.connecting:return pn.Connecting;case Ft.open:return pn.Open;case Ft.closing:return pn.Closing;default:return pn.Closed}}isConnected(){return this.connectionState()===pn.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){let r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{let i=new hs(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){let{topic:t,event:r,payload:s,ref:i}=e,a=()=>{this.encode(e,u=>{var c;(c=this.conn)===null||c===void 0||c.send(u)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?a():this.sendBuffer.push(a)}setAuth(e=null){return p(this,null,function*(){this._authPromise=this._performAuth(e);try{yield this._authPromise}finally{this._authPromise=null}})}_isManualToken(){return this._manuallySetToken}sendHeartbeat(){return p(this,null,function*(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Qf,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},uo.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")})}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply"&&t.ref&&t.ref===this.pendingHeartbeatRef){let h=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error",h)}catch(f){this.log("error","error in heartbeat callback",f)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}let{topic:r,event:s,payload:i,ref:a}=t,u=a?`(${a})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${s} ${u}`.trim(),i),this.channels.filter(h=>h._isMember(r)).forEach(h=>h._trigger(s,i,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Ft.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Ft.open||this.conn.readyState===Ft.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this._terminateWorker()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(t){this.log("error","error in heartbeat callback",t)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(qe.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;let r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{let r=new Blob([wy],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}_performAuth(e=null){return p(this,null,function*(){let t,r=!1;if(e)t=e,r=!0;else if(this.accessToken)try{t=yield this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),t=this.accessTokenValue}else t=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{let i={access_token:t,version:Wf};t&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(qe.access_token,{access_token:t})}))})}_waitForAuthIfNeeded(){return p(this,null,function*(){this._authPromise&&(yield this._authPromise)})}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new cr(()=>p(this,null,function*(){setTimeout(()=>p(this,null,function*(){yield this._waitForAuthIfNeeded(),this.isConnected()||this.connect()}),uo.RECONNECT_DELAY)}),this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,i,a,u,c,h,f,g,_,w;switch(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:us,this.heartbeatIntervalMs=(s=e?.heartbeatIntervalMs)!==null&&s!==void 0?s:uo.HEARTBEAT_INTERVAL,this.worker=(i=e?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(a=e?.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(u=e?.heartbeatCallback)!==null&&u!==void 0?u:Ic,this.vsn=(c=e?.vsn)!==null&&c!==void 0?c:vc,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:A=>_y[A-1]||yy,this.vsn){case Hf:this.encode=(f=e?.encode)!==null&&f!==void 0?f:(A,R)=>R(JSON.stringify(A)),this.decode=(g=e?.decode)!==null&&g!==void 0?g:(A,R)=>R(JSON.parse(A));break;case wc:this.encode=(_=e?.encode)!==null&&_!==void 0?_:this.serializer.encode.bind(this.serializer),this.decode=(w=e?.decode)!==null&&w!==void 0?w:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}};var fs=class extends Error{constructor(n,e){super(n),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function vy(n,e,t){let r=new URL(e,n);if(t)for(let[s,i]of Object.entries(t))i!==void 0&&r.searchParams.set(s,i);return r.toString()}function by(n){return p(this,null,function*(){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?yield n.getHeaders():{}})}function Ty(n){let e=n.fetchImpl??globalThis.fetch;return{request(c){return p(this,arguments,function*({method:r,path:s,query:i,body:a,headers:u}){let h=vy(n.baseUrl,s,i),f=yield by(n.auth),g=yield e(h,{method:r,headers:ue(ue(ue({},a?{"Content-Type":"application/json"}:{}),f),u),body:a?JSON.stringify(a):void 0}),_=yield g.text(),w=(g.headers.get("content-type")||"").includes("application/json"),A=w&&_?JSON.parse(_):_;if(!g.ok){let R=w?A:void 0,k=R?.error;throw new fs(k?.message??`Request failed with status ${g.status}`,{status:g.status,icebergType:k?.type,icebergCode:k?.code,details:R})}return{status:g.status,headers:g.headers,data:A}})}}}function co(n){return n.join("")}var Ey=class{constructor(n,e=""){this.client=n,this.prefix=e}listNamespaces(n){return p(this,null,function*(){let e=n?{parent:co(n.namespace)}:void 0;return(yield this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(r=>({namespace:r}))})}createNamespace(n,e){return p(this,null,function*(){let t={namespace:n.namespace,properties:e?.properties};return(yield this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data})}dropNamespace(n){return p(this,null,function*(){yield this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${co(n.namespace)}`})})}loadNamespaceMetadata(n){return p(this,null,function*(){return{properties:(yield this.client.request({method:"GET",path:`${this.prefix}/namespaces/${co(n.namespace)}`})).data.properties}})}namespaceExists(n){return p(this,null,function*(){try{return yield this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${co(n.namespace)}`}),!0}catch(e){if(e instanceof fs&&e.status===404)return!1;throw e}})}createNamespaceIfNotExists(n,e){return p(this,null,function*(){try{return yield this.createNamespace(n,e)}catch(t){if(t instanceof fs&&t.status===409)return;throw t}})}};function hr(n){return n.join("")}var Iy=class{constructor(n,e="",t){this.client=n,this.prefix=e,this.accessDelegation=t}listTables(n){return p(this,null,function*(){return(yield this.client.request({method:"GET",path:`${this.prefix}/namespaces/${hr(n.namespace)}/tables`})).data.identifiers})}createTable(n,e){return p(this,null,function*(){let t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(yield this.client.request({method:"POST",path:`${this.prefix}/namespaces/${hr(n.namespace)}/tables`,body:e,headers:t})).data.metadata})}updateTable(n,e){return p(this,null,function*(){let t=yield this.client.request({method:"POST",path:`${this.prefix}/namespaces/${hr(n.namespace)}/tables/${n.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}})}dropTable(n,e){return p(this,null,function*(){yield this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${hr(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(e?.purge??!1)}})})}loadTable(n){return p(this,null,function*(){let e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(yield this.client.request({method:"GET",path:`${this.prefix}/namespaces/${hr(n.namespace)}/tables/${n.name}`,headers:e})).data.metadata})}tableExists(n){return p(this,null,function*(){let e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return yield this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${hr(n.namespace)}/tables/${n.name}`,headers:e}),!0}catch(t){if(t instanceof fs&&t.status===404)return!1;throw t}})}createTableIfNotExists(n,e){return p(this,null,function*(){try{return yield this.createTable(n,e)}catch(t){if(t instanceof fs&&t.status===409)return yield this.loadTable({namespace:n.namespace,name:e.name});throw t}})}},Xf=class{constructor(n){let e="v1";n.catalogName&&(e+=`/${n.catalogName}`);let t=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=Ty({baseUrl:t,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new Ey(this.client,e),this.tableOps=new Iy(this.client,e,this.accessDelegation)}listNamespaces(n){return p(this,null,function*(){return this.namespaceOps.listNamespaces(n)})}createNamespace(n,e){return p(this,null,function*(){return this.namespaceOps.createNamespace(n,e)})}dropNamespace(n){return p(this,null,function*(){yield this.namespaceOps.dropNamespace(n)})}loadNamespaceMetadata(n){return p(this,null,function*(){return this.namespaceOps.loadNamespaceMetadata(n)})}listTables(n){return p(this,null,function*(){return this.tableOps.listTables(n)})}createTable(n,e){return p(this,null,function*(){return this.tableOps.createTable(n,e)})}updateTable(n,e){return p(this,null,function*(){return this.tableOps.updateTable(n,e)})}dropTable(n,e){return p(this,null,function*(){yield this.tableOps.dropTable(n,e)})}loadTable(n){return p(this,null,function*(){return this.tableOps.loadTable(n)})}namespaceExists(n){return p(this,null,function*(){return this.namespaceOps.namespaceExists(n)})}tableExists(n){return p(this,null,function*(){return this.tableOps.tableExists(n)})}createNamespaceIfNotExists(n,e){return p(this,null,function*(){return this.namespaceOps.createNamespaceIfNotExists(n,e)})}createTableIfNotExists(n,e){return p(this,null,function*(){return this.tableOps.createTableIfNotExists(n,e)})}};var ho=class extends Error{constructor(n,e="storage",t,r){super(n),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=t,this.statusCode=r}};function fo(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var lo=class extends ho{constructor(n,e,t,r="storage"){super(n,r,e,t),this.name=r==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},np=class extends ho{constructor(n,e,t="storage"){super(n,t),this.name=t==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};var Ay=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),Sy=n=>{if(typeof n!="object"||n===null)return!1;let e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Ac=n=>{if(Array.isArray(n))return n.map(t=>Ac(t));if(typeof n=="function"||n!==Object(n))return n;let e={};return Object.entries(n).forEach(([t,r])=>{let s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Ac(r)}),e},Ry=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function ms(n){"@babel/helpers - typeof";return ms=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ms(n)}function Py(n,e){if(ms(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(ms(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function ky(n){var e=Py(n,"string");return ms(e)=="symbol"?e:e+""}function xy(n,e,t){return(e=ky(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Zf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function G(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Zf(Object(t),!0).forEach(function(r){xy(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Zf(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var ep=n=>{var e;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(e=n.error)===null||e===void 0?void 0:e.message)||JSON.stringify(n)},Cy=(n,e,t,r)=>p(null,null,function*(){if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!t?.noResolveJson){let s=n,i=s.status||500;if(typeof s.json=="function")s.json().then(a=>{let u=a?.statusCode||a?.code||i+"";e(new lo(ep(a),i,u,r))}).catch(()=>{if(r==="vectors"){let a=i+"";e(new lo(s.statusText||`HTTP ${i} error`,i,a,r))}else{let a=i+"";e(new lo(s.statusText||`HTTP ${i} error`,i,a,r))}});else{let a=i+"";e(new lo(s.statusText||`HTTP ${i} error`,i,a,r))}}else e(new np(ep(n),n,r))}),Oy=(n,e,t,r)=>{let s={method:n,headers:e?.headers||{}};return n==="GET"||n==="HEAD"||!r?G(G({},s),t):(Sy(r)?(s.headers=G({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(r)):s.body=r,e?.duplex&&(s.duplex=e.duplex),G(G({},s),t))};function ps(n,e,t,r,s,i,a){return p(this,null,function*(){return new Promise((u,c)=>{n(t,Oy(e,r,s,i)).then(h=>{if(!h.ok)throw h;if(r?.noResolveJson)return h;if(a==="vectors"){let f=h.headers.get("content-type");if(h.headers.get("content-length")==="0"||h.status===204)return{};if(!f||!f.includes("application/json"))return{}}return h.json()}).then(h=>u(h)).catch(h=>Cy(h,c,r,a))})})}function rp(n="storage"){return{get:(e,t,r,s)=>p(null,null,function*(){return ps(e,"GET",t,r,s,void 0,n)}),post:(e,t,r,s,i)=>p(null,null,function*(){return ps(e,"POST",t,s,i,r,n)}),put:(e,t,r,s,i)=>p(null,null,function*(){return ps(e,"PUT",t,s,i,r,n)}),head:(e,t,r,s)=>p(null,null,function*(){return ps(e,"HEAD",t,G(G({},r),{},{noResolveJson:!0}),s,void 0,n)}),remove:(e,t,r,s,i)=>p(null,null,function*(){return ps(e,"DELETE",t,s,i,r,n)})}}var Ny=rp("storage"),{get:gs,post:We,put:Sc,head:Dy,remove:Rc}=Ny,Le=rp("vectors"),dr=class{constructor(n,e={},t,r="storage"){this.shouldThrowOnError=!1,this.url=n,this.headers=e,this.fetch=Ay(t),this.namespace=r}throwOnError(){return this.shouldThrowOnError=!0,this}handleOperation(n){return p(this,null,function*(){var e=this;try{return{data:yield n(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(fo(t))return{data:null,error:t};throw t}})}},Vy=class{constructor(n,e){this.downloadFn=n,this.shouldThrowOnError=e}then(n,e){return this.execute().then(n,e)}execute(){return p(this,null,function*(){var n=this;try{return{data:(yield n.downloadFn()).body,error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(fo(e))return{data:null,error:e};throw e}})}},sp;sp=Symbol.toStringTag;var Ly=class{constructor(n,e){this.downloadFn=n,this.shouldThrowOnError=e,this[sp]="BlobDownloadBuilder",this.promise=null}asStream(){return new Vy(this.downloadFn,this.shouldThrowOnError)}then(n,e){return this.getPromise().then(n,e)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return p(this,null,function*(){var n=this;try{return{data:yield(yield n.downloadFn()).blob(),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(fo(e))return{data:null,error:e};throw e}})}},Uy={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},tp={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},Fy=class extends dr{constructor(n,e={},t,r){super(n,e,r,"storage"),this.bucketId=t}uploadOrUpdate(n,e,t,r){return p(this,null,function*(){var s=this;return s.handleOperation(()=>p(this,null,function*(){let i,a=G(G({},tp),r),u=G(G({},s.headers),n==="POST"&&{"x-upsert":String(a.upsert)}),c=a.metadata;typeof Blob<"u"&&t instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",s.encodeMetadata(c)),i.append("",t)):typeof FormData<"u"&&t instanceof FormData?(i=t,i.has("cacheControl")||i.append("cacheControl",a.cacheControl),c&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(c))):(i=t,u["cache-control"]=`max-age=${a.cacheControl}`,u["content-type"]=a.contentType,c&&(u["x-metadata"]=s.toBase64(s.encodeMetadata(c))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!a.duplex&&(a.duplex="half")),r?.headers&&(u=G(G({},u),r.headers));let h=s._removeEmptyFolders(e),f=s._getFinalPath(h),g=yield(n=="PUT"?Sc:We)(s.fetch,`${s.url}/object/${f}`,i,G({headers:u},a?.duplex?{duplex:a.duplex}:{}));return{path:h,id:g.Id,fullPath:g.Key}}))})}upload(n,e,t){return p(this,null,function*(){return this.uploadOrUpdate("POST",n,e,t)})}uploadToSignedUrl(n,e,t,r){return p(this,null,function*(){var s=this;let i=s._removeEmptyFolders(n),a=s._getFinalPath(i),u=new URL(s.url+`/object/upload/sign/${a}`);return u.searchParams.set("token",e),s.handleOperation(()=>p(this,null,function*(){let c,h=G({upsert:tp.upsert},r),f=G(G({},s.headers),{"x-upsert":String(h.upsert)});return typeof Blob<"u"&&t instanceof Blob?(c=new FormData,c.append("cacheControl",h.cacheControl),c.append("",t)):typeof FormData<"u"&&t instanceof FormData?(c=t,c.append("cacheControl",h.cacheControl)):(c=t,f["cache-control"]=`max-age=${h.cacheControl}`,f["content-type"]=h.contentType),{path:i,fullPath:(yield Sc(s.fetch,u.toString(),c,{headers:f})).Key}}))})}createSignedUploadUrl(n,e){return p(this,null,function*(){var t=this;return t.handleOperation(()=>p(this,null,function*(){let r=t._getFinalPath(n),s=G({},t.headers);e?.upsert&&(s["x-upsert"]="true");let i=yield We(t.fetch,`${t.url}/object/upload/sign/${r}`,{},{headers:s}),a=new URL(t.url+i.url),u=a.searchParams.get("token");if(!u)throw new ho("No token returned by API");return{signedUrl:a.toString(),path:n,token:u}}))})}update(n,e,t){return p(this,null,function*(){return this.uploadOrUpdate("PUT",n,e,t)})}move(n,e,t){return p(this,null,function*(){var r=this;return r.handleOperation(()=>p(this,null,function*(){return yield We(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:n,destinationKey:e,destinationBucket:t?.destinationBucket},{headers:r.headers})}))})}copy(n,e,t){return p(this,null,function*(){var r=this;return r.handleOperation(()=>p(this,null,function*(){return{path:(yield We(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:n,destinationKey:e,destinationBucket:t?.destinationBucket},{headers:r.headers})).Key}}))})}createSignedUrl(n,e,t){return p(this,null,function*(){var r=this;return r.handleOperation(()=>p(this,null,function*(){let s=r._getFinalPath(n),i=yield We(r.fetch,`${r.url}/object/sign/${s}`,G({expiresIn:e},t?.transform?{transform:t.transform}:{}),{headers:r.headers}),a=t?.download?`&download=${t.download===!0?"":t.download}`:"";return{signedUrl:encodeURI(`${r.url}${i.signedURL}${a}`)}}))})}createSignedUrls(n,e,t){return p(this,null,function*(){var r=this;return r.handleOperation(()=>p(this,null,function*(){let s=yield We(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:e,paths:n},{headers:r.headers}),i=t?.download?`&download=${t.download===!0?"":t.download}`:"";return s.map(a=>G(G({},a),{},{signedUrl:a.signedURL?encodeURI(`${r.url}${a.signedURL}${i}`):null}))}))})}download(n,e,t){let r=typeof e?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(e?.transform||{}),i=s?`?${s}`:"",a=this._getFinalPath(n),u=()=>gs(this.fetch,`${this.url}/${r}/${a}${i}`,{headers:this.headers,noResolveJson:!0},t);return new Ly(u,this.shouldThrowOnError)}info(n){return p(this,null,function*(){var e=this;let t=e._getFinalPath(n);return e.handleOperation(()=>p(this,null,function*(){return Ac(yield gs(e.fetch,`${e.url}/object/info/${t}`,{headers:e.headers}))}))})}exists(n){return p(this,null,function*(){var e=this;let t=e._getFinalPath(n);try{return yield Dy(e.fetch,`${e.url}/object/${t}`,{headers:e.headers}),{data:!0,error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(fo(r)&&r instanceof np){let s=r.originalError;if([400,404].includes(s?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(n,e){let t=this._getFinalPath(n),r=[],s=e?.download?`download=${e.download===!0?"":e.download}`:"";s!==""&&r.push(s);let i=typeof e?.transform<"u"?"render/image":"object",a=this.transformOptsToQueryString(e?.transform||{});a!==""&&r.push(a);let u=r.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${t}${u}`)}}}remove(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return yield Rc(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:n},{headers:e.headers})}))})}list(n,e,t){return p(this,null,function*(){var r=this;return r.handleOperation(()=>p(this,null,function*(){let s=G(G(G({},Uy),e),{},{prefix:n||""});return yield We(r.fetch,`${r.url}/object/list/${r.bucketId}`,s,{headers:r.headers},t)}))})}listV2(n,e){return p(this,null,function*(){var t=this;return t.handleOperation(()=>p(this,null,function*(){let r=G({},n);return yield We(t.fetch,`${t.url}/object/list-v2/${t.bucketId}`,r,{headers:t.headers},e)}))})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){let e=[];return n.width&&e.push(`width=${n.width}`),n.height&&e.push(`height=${n.height}`),n.resize&&e.push(`resize=${n.resize}`),n.format&&e.push(`format=${n.format}`),n.quality&&e.push(`quality=${n.quality}`),e.join("&")}},My="2.95.3",_s={"X-Client-Info":`storage-js/${My}`},jy=class extends dr{constructor(n,e={},t,r){let s=new URL(n);r?.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase."));let i=s.href.replace(/\/$/,""),a=G(G({},_s),e);super(i,a,t,"storage")}listBuckets(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){let t=e.listBucketOptionsToQueryString(n);return yield gs(e.fetch,`${e.url}/bucket${t}`,{headers:e.headers})}))})}getBucket(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return yield gs(e.fetch,`${e.url}/bucket/${n}`,{headers:e.headers})}))})}createBucket(t){return p(this,arguments,function*(n,e={public:!1}){var r=this;return r.handleOperation(()=>p(this,null,function*(){return yield We(r.fetch,`${r.url}/bucket`,{id:n,name:n,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers})}))})}updateBucket(n,e){return p(this,null,function*(){var t=this;return t.handleOperation(()=>p(this,null,function*(){return yield Sc(t.fetch,`${t.url}/bucket/${n}`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers})}))})}emptyBucket(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return yield We(e.fetch,`${e.url}/bucket/${n}/empty`,{},{headers:e.headers})}))})}deleteBucket(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return yield Rc(e.fetch,`${e.url}/bucket/${n}`,{},{headers:e.headers})}))})}listBucketOptionsToQueryString(n){let e={};return n&&("limit"in n&&(e.limit=String(n.limit)),"offset"in n&&(e.offset=String(n.offset)),n.search&&(e.search=n.search),n.sortColumn&&(e.sortColumn=n.sortColumn),n.sortOrder&&(e.sortOrder=n.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},qy=class extends dr{constructor(n,e={},t){let r=n.replace(/\/$/,""),s=G(G({},_s),e);super(r,s,t,"storage")}createBucket(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return yield We(e.fetch,`${e.url}/bucket`,{name:n},{headers:e.headers})}))})}listBuckets(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){let t=new URLSearchParams;n?.limit!==void 0&&t.set("limit",n.limit.toString()),n?.offset!==void 0&&t.set("offset",n.offset.toString()),n?.sortColumn&&t.set("sortColumn",n.sortColumn),n?.sortOrder&&t.set("sortOrder",n.sortOrder),n?.search&&t.set("search",n.search);let r=t.toString(),s=r?`${e.url}/bucket?${r}`:`${e.url}/bucket`;return yield gs(e.fetch,s,{headers:e.headers})}))})}deleteBucket(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return yield Rc(e.fetch,`${e.url}/bucket/${n}`,{},{headers:e.headers})}))})}from(n){var e=this;if(!Ry(n))throw new ho("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");let t=new Xf({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:()=>p(this,null,function*(){return e.headers})},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(t,{get(s,i){let a=s[i];return typeof a!="function"?a:(...u)=>p(null,null,function*(){try{return{data:yield a.apply(s,u),error:null}}catch(c){if(r)throw c;return{data:null,error:c}}})}})}},By=class extends dr{constructor(n,e={},t){let r=n.replace(/\/$/,""),s=G(G({},_s),{},{"Content-Type":"application/json"},e);super(r,s,t,"vectors")}createIndex(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return(yield Le.post(e.fetch,`${e.url}/CreateIndex`,n,{headers:e.headers}))||{}}))})}getIndex(n,e){return p(this,null,function*(){var t=this;return t.handleOperation(()=>p(this,null,function*(){return yield Le.post(t.fetch,`${t.url}/GetIndex`,{vectorBucketName:n,indexName:e},{headers:t.headers})}))})}listIndexes(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return yield Le.post(e.fetch,`${e.url}/ListIndexes`,n,{headers:e.headers})}))})}deleteIndex(n,e){return p(this,null,function*(){var t=this;return t.handleOperation(()=>p(this,null,function*(){return(yield Le.post(t.fetch,`${t.url}/DeleteIndex`,{vectorBucketName:n,indexName:e},{headers:t.headers}))||{}}))})}},$y=class extends dr{constructor(n,e={},t){let r=n.replace(/\/$/,""),s=G(G({},_s),{},{"Content-Type":"application/json"},e);super(r,s,t,"vectors")}putVectors(n){return p(this,null,function*(){var e=this;if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(()=>p(this,null,function*(){return(yield Le.post(e.fetch,`${e.url}/PutVectors`,n,{headers:e.headers}))||{}}))})}getVectors(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return yield Le.post(e.fetch,`${e.url}/GetVectors`,n,{headers:e.headers})}))})}listVectors(n){return p(this,null,function*(){var e=this;if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return e.handleOperation(()=>p(this,null,function*(){return yield Le.post(e.fetch,`${e.url}/ListVectors`,n,{headers:e.headers})}))})}queryVectors(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return yield Le.post(e.fetch,`${e.url}/QueryVectors`,n,{headers:e.headers})}))})}deleteVectors(n){return p(this,null,function*(){var e=this;if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(()=>p(this,null,function*(){return(yield Le.post(e.fetch,`${e.url}/DeleteVectors`,n,{headers:e.headers}))||{}}))})}},zy=class extends dr{constructor(n,e={},t){let r=n.replace(/\/$/,""),s=G(G({},_s),{},{"Content-Type":"application/json"},e);super(r,s,t,"vectors")}createBucket(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return(yield Le.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:e.headers}))||{}}))})}getBucket(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return yield Le.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:n},{headers:e.headers})}))})}listBuckets(){return p(this,arguments,function*(n={}){var e=this;return e.handleOperation(()=>p(this,null,function*(){return yield Le.post(e.fetch,`${e.url}/ListVectorBuckets`,n,{headers:e.headers})}))})}deleteBucket(n){return p(this,null,function*(){var e=this;return e.handleOperation(()=>p(this,null,function*(){return(yield Le.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:e.headers}))||{}}))})}},Gy=class n extends zy{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Ky(this.url,this.headers,e,this.fetch)}createBucket(e){return p(this,null,function*(){var t=()=>ke(n.prototype,this,"createBucket"),r=this;return t().call(r,e)})}getBucket(e){return p(this,null,function*(){var t=()=>ke(n.prototype,this,"getBucket"),r=this;return t().call(r,e)})}listBuckets(){return p(this,arguments,function*(e={}){var t=()=>ke(n.prototype,this,"listBuckets"),r=this;return t().call(r,e)})}deleteBucket(e){return p(this,null,function*(){var t=()=>ke(n.prototype,this,"deleteBucket"),r=this;return t().call(r,e)})}},Ky=class n extends By{constructor(e,t,r,s){super(e,t,s),this.vectorBucketName=r}createIndex(e){return p(this,null,function*(){var t=()=>ke(n.prototype,this,"createIndex"),r=this;return t().call(r,G(G({},e),{},{vectorBucketName:r.vectorBucketName}))})}listIndexes(){return p(this,arguments,function*(e={}){var t=()=>ke(n.prototype,this,"listIndexes"),r=this;return t().call(r,G(G({},e),{},{vectorBucketName:r.vectorBucketName}))})}getIndex(e){return p(this,null,function*(){var t=()=>ke(n.prototype,this,"getIndex"),r=this;return t().call(r,r.vectorBucketName,e)})}deleteIndex(e){return p(this,null,function*(){var t=()=>ke(n.prototype,this,"deleteIndex"),r=this;return t().call(r,r.vectorBucketName,e)})}index(e){return new Wy(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},Wy=class n extends $y{constructor(e,t,r,s,i){super(e,t,i),this.vectorBucketName=r,this.indexName=s}putVectors(e){return p(this,null,function*(){var t=()=>ke(n.prototype,this,"putVectors"),r=this;return t().call(r,G(G({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))})}getVectors(e){return p(this,null,function*(){var t=()=>ke(n.prototype,this,"getVectors"),r=this;return t().call(r,G(G({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))})}listVectors(){return p(this,arguments,function*(e={}){var t=()=>ke(n.prototype,this,"listVectors"),r=this;return t().call(r,G(G({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))})}queryVectors(e){return p(this,null,function*(){var t=()=>ke(n.prototype,this,"queryVectors"),r=this;return t().call(r,G(G({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))})}deleteVectors(e){return p(this,null,function*(){var t=()=>ke(n.prototype,this,"deleteVectors"),r=this;return t().call(r,G(G({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))})}},ip=class extends jy{constructor(n,e={},t,r){super(n,e,t,r)}from(n){return new Fy(this.url,this.headers,n,this.fetch)}get vectors(){return new Gy(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new qy(this.url+"/iceberg",this.headers,this.fetch)}};var po="2.95.3";var mn=30*1e3,mo=3,go=mo*mn,op="http://localhost:9999",ap="supabase.auth.token";var up={"X-Client-Info":`gotrue-js/${po}`};var ys="X-Supabase-Api-Version",Pc={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},cp=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,lp=10*60*1e3;var Mt=class extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}};function j(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}var _o=class extends Mt{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}};function hp(n){return j(n)&&n.name==="AuthApiError"}var Be=class extends Mt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}},He=class extends Mt{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}},Ie=class extends He{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function wo(n){return j(n)&&n.name==="AuthSessionMissingError"}var Tt=class extends He{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},gn=class extends He{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}},_n=class extends He{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function dp(n){return j(n)&&n.name==="AuthImplicitGrantRedirectError"}var ws=class extends He{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},yo=class extends He{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}};var fr=class extends He{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}};function vo(n){return j(n)&&n.name==="AuthRetryableFetchError"}var vs=class extends He{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}};var yn=class extends He{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}};var bo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),fp=` 	
\r=`.split(""),Hy=(()=>{let n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<fp.length;e+=1)n[fp[e].charCodeAt(0)]=-2;for(let e=0;e<bo.length;e+=1)n[bo[e].charCodeAt(0)]=e;return n})();function pp(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){let r=e.queue>>e.queuedBits-6&63;t(bo[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){let r=e.queue>>e.queuedBits-6&63;t(bo[r]),e.queuedBits-=6}}function mp(n,e,t){let r=Hy[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function kc(n){let e=[],t=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=a=>{Yy(a,r,t)};for(let a=0;a<n.length;a+=1)mp(n.charCodeAt(a),s,i);return e.join("")}function Qy(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Jy(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){let s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Qy(r,e)}}function Yy(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function jt(n){let e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)mp(n.charCodeAt(s),t,r);return new Uint8Array(e)}function gp(n){let e=[];return Jy(n,t=>e.push(t)),new Uint8Array(e)}function Et(n){let e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};return n.forEach(s=>pp(s,t,r)),pp(null,t,r),e.join("")}function _p(n){return Math.round(Date.now()/1e3)+n}function yp(){return Symbol("auth-callback")}var ye=()=>typeof window<"u"&&typeof document<"u",wn={tested:!1,writable:!1},To=()=>{if(!ye())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(wn.tested)return wn.writable;let n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),wn.tested=!0,wn.writable=!0}catch{wn.tested=!0,wn.writable=!1}return wn.writable};function wp(n){let e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}var Eo=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),vp=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",vn=(n,e,t)=>p(null,null,function*(){yield n.setItem(e,JSON.stringify(t))}),qt=(n,e)=>p(null,null,function*(){let t=yield n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}}),Te=(n,e)=>p(null,null,function*(){yield n.removeItem(e)}),bs=class n{constructor(){this.promise=new n.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}};bs.promiseConstructor=Promise;function Ts(n){let e=n.split(".");if(e.length!==3)throw new yn("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!cp.test(e[r]))throw new yn("JWT not in base64url format");return{header:JSON.parse(kc(e[0])),payload:JSON.parse(kc(e[1])),signature:jt(e[2]),raw:{header:e[0],payload:e[1]}}}function bp(n){return p(this,null,function*(){return yield new Promise(e=>{setTimeout(()=>e(null),n)})})}function Tp(n,e){return new Promise((r,s)=>{p(null,null,function*(){for(let i=0;i<1/0;i++)try{let a=yield n(i);if(!e(i,null,a)){r(a);return}}catch(a){if(!e(i,a)){s(a);return}}})})}function Xy(n){return("0"+n.toString(16)).substr(-2)}function Zy(){let e=new Uint32Array(56);if(typeof crypto>"u"){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length,s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,Xy).join("")}function ew(n){return p(this,null,function*(){let t=new TextEncoder().encode(n),r=yield crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")})}function tw(n){return p(this,null,function*(){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;let t=yield ew(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}function bn(n,e,t=!1){return p(this,null,function*(){let r=Zy(),s=r;t&&(s+="/PASSWORD_RECOVERY"),yield vn(n,`${e}-code-verifier`,s);let i=yield tw(r);return[i,r===i?"plain":"s256"]})}var nw=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Ep(n){let e=n.headers.get(ys);if(!e||!e.match(nw))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Ip(n){if(!n)throw new Error("Missing exp claim");let e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Ap(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var rw=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Tn(n){if(!rw.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Io(){let n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){let r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Sp(n,e){return new Proxy(n,{get:(t,r,s)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){let i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,r,s)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,r,s)}})}function xc(n){return JSON.parse(JSON.stringify(n))}var En=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),sw=[502,503,504];function Rp(n){return p(this,null,function*(){var e;if(!vp(n))throw new fr(En(n),0);if(sw.includes(n.status))throw new fr(En(n),n.status);let t;try{t=yield n.json()}catch(i){throw new Be(En(i),i)}let r,s=Ep(n);if(s&&s.getTime()>=Pc["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new vs(En(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Ie}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new vs(En(t),n.status,t.weak_password.reasons);throw new _o(En(t),n.status||500,r)})}var iw=(n,e,t,r)=>{let s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function B(n,e,t,r){return p(this,null,function*(){var s;let i=Object.assign({},r?.headers);i[ys]||(i[ys]=Pc["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);let a=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(a.redirect_to=r.redirectTo);let u=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=yield ow(n,e,t+u,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(c):{data:Object.assign({},c),error:null}})}function ow(n,e,t,r,s,i){return p(this,null,function*(){let a=iw(e,r,s,i),u;try{u=yield n(t,Object.assign({},a))}catch(c){throw console.error(c),new fr(En(c),0)}if(u.ok||(yield Rp(u)),r?.noResolveJson)return u;try{return yield u.json()}catch(c){yield Rp(c)}})}function $e(n){var e;let t=null;aw(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=_p(n.expires_in)));let r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Cc(n){let e=$e(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function ut(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Pp(n){return{data:n,error:null}}function kp(n){let{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,a=Wt(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),u={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},a);return{data:{properties:u,user:c},error:null}}function Oc(n){return n}function aw(n){return n.access_token&&n.refresh_token&&n.expires_in}var Ao=["global","local","others"];var pr=class{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Eo(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}signOut(r){return p(this,arguments,function*(e,t=Ao[0]){if(Ao.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ao.join(", ")}`);try{return yield B(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(j(s))return{data:null,error:s};throw s}})}inviteUserByEmail(r){return p(this,arguments,function*(e,t={}){try{return yield B(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ut})}catch(s){if(j(s))return{data:{user:null},error:s};throw s}})}generateLink(e){return p(this,null,function*(){try{let{options:t}=e,r=Wt(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),yield B(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:kp,redirectTo:t?.redirectTo})}catch(t){if(j(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return p(this,null,function*(){try{return yield B(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ut})}catch(t){if(j(t))return{data:{user:null},error:t};throw t}})}listUsers(e){return p(this,null,function*(){var t,r,s,i,a,u,c;try{let h={nextPage:null,lastPage:0,total:0},f=yield B(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Oc});if(f.error)throw f.error;let g=yield f.json(),_=(a=f.headers.get("x-total-count"))!==null&&a!==void 0?a:0,w=(c=(u=f.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&c!==void 0?c:[];return w.length>0&&(w.forEach(A=>{let R=parseInt(A.split(";")[0].split("=")[1].substring(0,1)),k=JSON.parse(A.split(";")[1].split("=")[1]);h[`${k}Page`]=R}),h.total=parseInt(_)),{data:Object.assign(Object.assign({},g),h),error:null}}catch(h){if(j(h))return{data:{users:[]},error:h};throw h}})}getUserById(e){return p(this,null,function*(){Tn(e);try{return yield B(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ut})}catch(t){if(j(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return p(this,null,function*(){Tn(e);try{return yield B(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ut})}catch(r){if(j(r))return{data:{user:null},error:r};throw r}})}deleteUser(e,t=!1){return p(this,null,function*(){Tn(e);try{return yield B(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ut})}catch(r){if(j(r))return{data:{user:null},error:r};throw r}})}_listFactors(e){return p(this,null,function*(){Tn(e.userId);try{let{data:t,error:r}=yield B(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(j(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return p(this,null,function*(){Tn(e.userId),Tn(e.id);try{return{data:yield B(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(j(t))return{data:null,error:t};throw t}})}_listOAuthClients(e){return p(this,null,function*(){var t,r,s,i,a,u,c;try{let h={nextPage:null,lastPage:0,total:0},f=yield B(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Oc});if(f.error)throw f.error;let g=yield f.json(),_=(a=f.headers.get("x-total-count"))!==null&&a!==void 0?a:0,w=(c=(u=f.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&c!==void 0?c:[];return w.length>0&&(w.forEach(A=>{let R=parseInt(A.split(";")[0].split("=")[1].substring(0,1)),k=JSON.parse(A.split(";")[1].split("=")[1]);h[`${k}Page`]=R}),h.total=parseInt(_)),{data:Object.assign(Object.assign({},g),h),error:null}}catch(h){if(j(h))return{data:{clients:[]},error:h};throw h}})}_createOAuthClient(e){return p(this,null,function*(){try{return yield B(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(j(t))return{data:null,error:t};throw t}})}_getOAuthClient(e){return p(this,null,function*(){try{return yield B(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(j(t))return{data:null,error:t};throw t}})}_updateOAuthClient(e,t){return p(this,null,function*(){try{return yield B(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(j(r))return{data:null,error:r};throw r}})}_deleteOAuthClient(e){return p(this,null,function*(){try{return yield B(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(j(t))return{data:null,error:t};throw t}})}_regenerateOAuthClientSecret(e){return p(this,null,function*(){try{return yield B(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(j(t))return{data:null,error:t};throw t}})}};function Nc(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}var In={debug:!!(globalThis&&To()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},Es=class extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}},So=class extends Es{};function Dc(n,e,t){return p(this,null,function*(){In.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);let r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),In.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},s=>p(null,null,function*(){if(s){In.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return yield t()}finally{In.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw In.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new So(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(In.debug)try{let i=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield t()}})))})}function xp(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Vc(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function Cp(n){return parseInt(n,16)}function Op(n){let e=new TextEncoder().encode(n);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function Np(n){var e;let{chainId:t,domain:r,expirationTime:s,issuedAt:i=new Date,nonce:a,notBefore:u,requestId:c,resources:h,scheme:f,uri:g,version:_}=n;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!g)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(_!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${_}`);if(!((e=n.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}let w=Vc(n.address),A=f?`${f}://${r}`:r,R=n.statement?`${n.statement}
`:"",k=`${A} wants you to sign in with your Ethereum account:
${w}

${R}`,O=`URI: ${g}
Version: ${_}
Chain ID: ${t}${a?`
Nonce: ${a}`:""}
Issued At: ${i.toISOString()}`;if(s&&(O+=`
Expiration Time: ${s.toISOString()}`),u&&(O+=`
Not Before: ${u.toISOString()}`),c&&(O+=`
Request ID: ${c}`),h){let M=`
Resources:`;for(let V of h){if(!V||typeof V!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${V}`);M+=`
- ${V}`}O+=M}return`${k}
${O}`}var oe=class extends Error{constructor({message:e,code:t,cause:r,name:s}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=s??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}},An=class extends oe{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}};function Dp({error:n,options:e}){var t,r,s;let{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new oe({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new oe({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new oe({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new oe({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new oe({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new oe({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return i.pubKeyCredParams.filter(u=>u.type==="public-key").length===0?new oe({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new oe({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){let a=window.location.hostname;if(Lc(a)){if(i.rp.id!==a)return new oe({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new oe({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new oe({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new oe({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new oe({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function Vp({error:n,options:e}){let{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new oe({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new oe({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){let r=window.location.hostname;if(Lc(r)){if(t.rpId!==r)return new oe({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new oe({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new oe({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new oe({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}var Uc=class{createNewAbortSignal(){if(this.controller){let t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}let e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){let e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}},uw=new Uc;function Up(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);let{challenge:e,user:t,excludeCredentials:r}=n,s=Wt(n,["challenge","user","excludeCredentials"]),i=jt(e).buffer,a=Object.assign(Object.assign({},t),{id:jt(t.id).buffer}),u=Object.assign(Object.assign({},s),{challenge:i,user:a});if(r&&r.length>0){u.excludeCredentials=new Array(r.length);for(let c=0;c<r.length;c++){let h=r[c];u.excludeCredentials[c]=Object.assign(Object.assign({},h),{id:jt(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return u}function Fp(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);let{challenge:e,allowCredentials:t}=n,r=Wt(n,["challenge","allowCredentials"]),s=jt(e).buffer,i=Object.assign(Object.assign({},r),{challenge:s});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let a=0;a<t.length;a++){let u=t[a];i.allowCredentials[a]=Object.assign(Object.assign({},u),{id:jt(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return i}function Mp(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();let t=n;return{id:n.id,rawId:n.id,response:{attestationObject:Et(new Uint8Array(n.response.attestationObject)),clientDataJSON:Et(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function jp(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();let t=n,r=n.getClientExtensionResults(),s=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:Et(new Uint8Array(s.authenticatorData)),clientDataJSON:Et(new Uint8Array(s.clientDataJSON)),signature:Et(new Uint8Array(s.signature)),userHandle:s.userHandle?Et(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Lc(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function Lp(){var n,e;return!!(ye()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}function cw(n){return p(this,null,function*(){try{let e=yield navigator.credentials.create(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new An("Browser returned unexpected credential type",e)}:{data:null,error:new An("Empty credential response",e)}}catch(e){return{data:null,error:Dp({error:e,options:n})}}})}function lw(n){return p(this,null,function*(){try{let e=yield navigator.credentials.get(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new An("Browser returned unexpected credential type",e)}:{data:null,error:new An("Empty credential response",e)}}catch(e){return{data:null,error:Vp({error:e,options:n})}}})}var hw={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},dw={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Ro(...n){let e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),t=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),r={};for(let s of n)if(s)for(let i in s){let a=s[i];if(a!==void 0)if(Array.isArray(a))r[i]=a;else if(t(a))r[i]=a;else if(e(a)){let u=r[i];e(u)?r[i]=Ro(u,a):r[i]=Ro(a)}else r[i]=a}return r}function fw(n,e){return Ro(hw,n,e||{})}function pw(n,e){return Ro(dw,n,e||{})}var Po=class{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}_enroll(e){return p(this,null,function*(){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))})}_challenge(a,u){return p(this,arguments,function*({factorId:e,webauthn:t,friendlyName:r,signal:s},i){var c;try{let{data:h,error:f}=yield this.client.mfa.challenge({factorId:e,webauthn:t});if(!h)return{data:null,error:f};let g=s??uw.createNewAbortSignal();if(h.webauthn.type==="create"){let{user:_}=h.webauthn.credential_options.publicKey;if(!_.name){let w=r;if(w)_.name=`${_.id}:${w}`;else{let R=(yield this.client.getUser()).data.user,k=((c=R?.user_metadata)===null||c===void 0?void 0:c.name)||R?.email||R?.id||"User";_.name=`${_.id}:${k}`}}_.displayName||(_.displayName=_.name)}switch(h.webauthn.type){case"create":{let _=fw(h.webauthn.credential_options.publicKey,i?.create),{data:w,error:A}=yield cw({publicKey:_,signal:g});return w?{data:{factorId:e,challengeId:h.id,webauthn:{type:h.webauthn.type,credential_response:w}},error:null}:{data:null,error:A}}case"request":{let _=pw(h.webauthn.credential_options.publicKey,i?.request),{data:w,error:A}=yield lw(Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:_,signal:g}));return w?{data:{factorId:e,challengeId:h.id,webauthn:{type:h.webauthn.type,credential_response:w}},error:null}:{data:null,error:A}}}}catch(h){return j(h)?{data:null,error:h}:{data:null,error:new Be("Unexpected error in challenge",h)}}})}_verify(s){return p(this,arguments,function*({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})})}_authenticate(a,u){return p(this,arguments,function*({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!t)return{data:null,error:new Mt("rpId is required for WebAuthn authentication")};try{if(!Lp())return{data:null,error:new Be("Browser does not support WebAuthn",null)};let{data:c,error:h}=yield this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:s},{request:i});if(!c)return{data:null,error:h};let{webauthn:f}=c;return this._verify({factorId:e,challengeId:c.challengeId,webauthn:{type:f.type,rpId:t,rpOrigins:r,credential_response:f.credential_response}})}catch(c){return j(c)?{data:null,error:c}:{data:null,error:new Be("Unexpected error in authenticate",c)}}})}_register(a,u){return p(this,arguments,function*({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!t)return{data:null,error:new Mt("rpId is required for WebAuthn registration")};try{if(!Lp())return{data:null,error:new Be("Browser does not support WebAuthn",null)};let{data:c,error:h}=yield this._enroll({friendlyName:e});if(!c)return yield this.client.mfa.listFactors().then(_=>{var w;return(w=_.data)===null||w===void 0?void 0:w.all.find(A=>A.factor_type==="webauthn"&&A.friendly_name===e&&A.status!=="unverified")}).then(_=>_?this.client.mfa.unenroll({factorId:_?.id}):void 0),{data:null,error:h};let{data:f,error:g}=yield this._challenge({factorId:c.id,friendlyName:c.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:s},{create:i});return f?this._verify({factorId:c.id,challengeId:f.challengeId,webauthn:{rpId:t,rpOrigins:r,type:f.webauthn.type,credential_response:f.webauthn.credential_response}}):{data:null,error:g}}catch(c){return j(c)?{data:null,error:c}:{data:null,error:new Be("Unexpected error in register",c)}}})}};xp();var mw={url:op,storageKey:ap,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:up,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};function qp(n,e,t){return p(this,null,function*(){return yield t()})}var mr={},gw=(()=>{class n{get jwks(){var t,r;return(r=(t=mr[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){mr[this.storageKey]=Object.assign(Object.assign({},mr[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=mr[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){mr[this.storageKey]=Object.assign(Object.assign({},mr[this.storageKey]),{cachedAt:t})}constructor(t){var r,s,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;let a=Object.assign(Object.assign({},mw),t);if(this.storageKey=a.storageKey,this.instanceID=(r=n.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,n.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.instanceID>0&&ye()){let u=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(u),this.logDebugMessages&&console.trace(u)}if(this.persistSession=a.persistSession,this.autoRefreshToken=a.autoRefreshToken,this.admin=new pr({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=Eo(a.fetch),this.lock=a.lock||qp,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,this.throwOnError=a.throwOnError,this.lockAcquireTimeout=a.lockAcquireTimeout,a.lock?this.lock=a.lock:this.persistSession&&ye()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=Dc:this.lock=qp,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Po(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:To()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Nc(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=Nc(this.memoryStorage)),ye()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(u){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",u)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",u=>p(this,null,function*(){this._debug("received broadcast notification from other tab or client",u);try{yield this._notifyAllSubscribers(u.data.event,u.data.session,!1)}catch(c){this._debug("#broadcastChannel","error",c)}}))}this.initialize().catch(u=>{this._debug("#initialize()","error",u)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${po}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}initialize(){return p(this,null,function*(){return this.initializePromise?yield this.initializePromise:(this.initializePromise=p(this,null,function*(){return yield this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){return yield this._initialize()}))}),yield this.initializePromise)})}_initialize(){return p(this,null,function*(){var t;try{let r={},s="none";if(ye()&&(r=wp(window.location.href),this._isImplicitGrantCallback(r)?s="implicit":(yield this._isPKCECallback(r))&&(s="pkce")),ye()&&this.detectSessionInUrl&&s!=="none"){let{data:i,error:a}=yield this._getSessionFromURL(r,s);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),dp(a)){let h=(t=a.details)===null||t===void 0?void 0:t.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:a}}return{error:a}}let{session:u,redirectType:c}=i;return this._debug("#_initialize()","detected session in URL",u,"redirect type",c),yield this._saveSession(u),setTimeout(()=>p(this,null,function*(){c==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",u):yield this._notifyAllSubscribers("SIGNED_IN",u)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(r){return j(r)?this._returnResult({error:r}):this._returnResult({error:new Be("Unexpected error during initialization",r)})}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(t){return p(this,null,function*(){var r,s,i;try{let a=yield B(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(r=t?.options)===null||r===void 0?void 0:r.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=t?.options)===null||i===void 0?void 0:i.captchaToken}},xform:$e}),{data:u,error:c}=a;if(c||!u)return this._returnResult({data:{user:null,session:null},error:c});let h=u.session,f=u.user;return u.session&&(yield this._saveSession(u.session),yield this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:f,session:h},error:null})}catch(a){if(j(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}signUp(t){return p(this,null,function*(){var r,s,i;try{let a;if("email"in t){let{email:g,password:_,options:w}=t,A=null,R=null;this.flowType==="pkce"&&([A,R]=yield bn(this.storage,this.storageKey)),a=yield B(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:w?.emailRedirectTo,body:{email:g,password:_,data:(r=w?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:w?.captchaToken},code_challenge:A,code_challenge_method:R},xform:$e})}else if("phone"in t){let{phone:g,password:_,options:w}=t;a=yield B(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:g,password:_,data:(s=w?.data)!==null&&s!==void 0?s:{},channel:(i=w?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:w?.captchaToken}},xform:$e})}else throw new gn("You must provide either an email or phone number and a password");let{data:u,error:c}=a;if(c||!u)return yield Te(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:c});let h=u.session,f=u.user;return u.session&&(yield this._saveSession(u.session),yield this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:f,session:h},error:null})}catch(a){if(yield Te(this.storage,`${this.storageKey}-code-verifier`),j(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}signInWithPassword(t){return p(this,null,function*(){try{let r;if("email"in t){let{email:a,password:u,options:c}=t;r=yield B(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:u,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:Cc})}else if("phone"in t){let{phone:a,password:u,options:c}=t;r=yield B(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:u,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:Cc})}else throw new gn("You must provide either an email or phone number and a password");let{data:s,error:i}=r;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!s||!s.session||!s.user){let a=new Tt;return this._returnResult({data:{user:null,session:null},error:a})}return s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(r){if(j(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}signInWithOAuth(t){return p(this,null,function*(){var r,s,i,a;return yield this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(s=t.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=t.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(a=t.options)===null||a===void 0?void 0:a.skipBrowserRedirect})})}exchangeCodeForSession(t){return p(this,null,function*(){return yield this.initializePromise,this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){return this._exchangeCodeForSession(t)}))})}signInWithWeb3(t){return p(this,null,function*(){let{chain:r}=t;switch(r){case"ethereum":return yield this.signInWithEthereum(t);case"solana":return yield this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}})}signInWithEthereum(t){return p(this,null,function*(){var r,s,i,a,u,c,h,f,g,_,w;let A,R;if("message"in t)A=t.message,R=t.signature;else{let{chain:k,wallet:O,statement:M,options:V}=t,D;if(ye())if(typeof O=="object")D=O;else{let I=window;if("ethereum"in I&&typeof I.ethereum=="object"&&"request"in I.ethereum&&typeof I.ethereum.request=="function")D=I.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof O!="object"||!V?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");D=O}let z=new URL((r=V?.url)!==null&&r!==void 0?r:window.location.href),X=yield D.request({method:"eth_requestAccounts"}).then(I=>I).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!X||X.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let T=Vc(X[0]),y=(s=V?.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!y){let I=yield D.request({method:"eth_chainId"});y=Cp(I)}let b={domain:z.host,address:T,statement:M,uri:z.href,version:"1",chainId:y,nonce:(i=V?.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(u=(a=V?.signInWithEthereum)===null||a===void 0?void 0:a.issuedAt)!==null&&u!==void 0?u:new Date,expirationTime:(c=V?.signInWithEthereum)===null||c===void 0?void 0:c.expirationTime,notBefore:(h=V?.signInWithEthereum)===null||h===void 0?void 0:h.notBefore,requestId:(f=V?.signInWithEthereum)===null||f===void 0?void 0:f.requestId,resources:(g=V?.signInWithEthereum)===null||g===void 0?void 0:g.resources};A=Np(b),R=yield D.request({method:"personal_sign",params:[Op(A),T]})}try{let{data:k,error:O}=yield B(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:A,signature:R},!((_=t.options)===null||_===void 0)&&_.captchaToken?{gotrue_meta_security:{captcha_token:(w=t.options)===null||w===void 0?void 0:w.captchaToken}}:null),xform:$e});if(O)throw O;if(!k||!k.session||!k.user){let M=new Tt;return this._returnResult({data:{user:null,session:null},error:M})}return k.session&&(yield this._saveSession(k.session),yield this._notifyAllSubscribers("SIGNED_IN",k.session)),this._returnResult({data:Object.assign({},k),error:O})}catch(k){if(j(k))return this._returnResult({data:{user:null,session:null},error:k});throw k}})}signInWithSolana(t){return p(this,null,function*(){var r,s,i,a,u,c,h,f,g,_,w,A;let R,k;if("message"in t)R=t.message,k=t.signature;else{let{chain:O,wallet:M,statement:V,options:D}=t,z;if(ye())if(typeof M=="object")z=M;else{let T=window;if("solana"in T&&typeof T.solana=="object"&&("signIn"in T.solana&&typeof T.solana.signIn=="function"||"signMessage"in T.solana&&typeof T.solana.signMessage=="function"))z=T.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof M!="object"||!D?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=M}let X=new URL((r=D?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in z&&z.signIn){let T=yield z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},D?.signInWithSolana),{version:"1",domain:X.host,uri:X.href}),V?{statement:V}:null)),y;if(Array.isArray(T)&&T[0]&&typeof T[0]=="object")y=T[0];else if(T&&typeof T=="object"&&"signedMessage"in T&&"signature"in T)y=T;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in y&&"signature"in y&&(typeof y.signedMessage=="string"||y.signedMessage instanceof Uint8Array)&&y.signature instanceof Uint8Array)R=typeof y.signedMessage=="string"?y.signedMessage:new TextDecoder().decode(y.signedMessage),k=y.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in z)||typeof z.signMessage!="function"||!("publicKey"in z)||typeof z!="object"||!z.publicKey||!("toBase58"in z.publicKey)||typeof z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");R=[`${X.host} wants you to sign in with your Solana account:`,z.publicKey.toBase58(),...V?["",V,""]:[""],"Version: 1",`URI: ${X.href}`,`Issued At: ${(i=(s=D?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((a=D?.signInWithSolana)===null||a===void 0)&&a.notBefore?[`Not Before: ${D.signInWithSolana.notBefore}`]:[],...!((u=D?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${D.signInWithSolana.expirationTime}`]:[],...!((c=D?.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${D.signInWithSolana.chainId}`]:[],...!((h=D?.signInWithSolana)===null||h===void 0)&&h.nonce?[`Nonce: ${D.signInWithSolana.nonce}`]:[],...!((f=D?.signInWithSolana)===null||f===void 0)&&f.requestId?[`Request ID: ${D.signInWithSolana.requestId}`]:[],...!((_=(g=D?.signInWithSolana)===null||g===void 0?void 0:g.resources)===null||_===void 0)&&_.length?["Resources",...D.signInWithSolana.resources.map(y=>`- ${y}`)]:[]].join(`
`);let T=yield z.signMessage(new TextEncoder().encode(R),"utf8");if(!T||!(T instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");k=T}}try{let{data:O,error:M}=yield B(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:R,signature:Et(k)},!((w=t.options)===null||w===void 0)&&w.captchaToken?{gotrue_meta_security:{captcha_token:(A=t.options)===null||A===void 0?void 0:A.captchaToken}}:null),xform:$e});if(M)throw M;if(!O||!O.session||!O.user){let V=new Tt;return this._returnResult({data:{user:null,session:null},error:V})}return O.session&&(yield this._saveSession(O.session),yield this._notifyAllSubscribers("SIGNED_IN",O.session)),this._returnResult({data:Object.assign({},O),error:M})}catch(O){if(j(O))return this._returnResult({data:{user:null,session:null},error:O});throw O}})}_exchangeCodeForSession(t){return p(this,null,function*(){let r=yield qt(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(r??"").split("/");try{if(!s&&this.flowType==="pkce")throw new yo;let{data:a,error:u}=yield B(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:s},xform:$e});if(yield Te(this.storage,`${this.storageKey}-code-verifier`),u)throw u;if(!a||!a.session||!a.user){let c=new Tt;return this._returnResult({data:{user:null,session:null,redirectType:null},error:c})}return a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign(Object.assign({},a),{redirectType:i??null}),error:u})}catch(a){if(yield Te(this.storage,`${this.storageKey}-code-verifier`),j(a))return this._returnResult({data:{user:null,session:null,redirectType:null},error:a});throw a}})}signInWithIdToken(t){return p(this,null,function*(){try{let{options:r,provider:s,token:i,access_token:a,nonce:u}=t,c=yield B(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:a,nonce:u,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:$e}),{data:h,error:f}=c;if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!h||!h.session||!h.user){let g=new Tt;return this._returnResult({data:{user:null,session:null},error:g})}return h.session&&(yield this._saveSession(h.session),yield this._notifyAllSubscribers("SIGNED_IN",h.session)),this._returnResult({data:h,error:f})}catch(r){if(j(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}signInWithOtp(t){return p(this,null,function*(){var r,s,i,a,u;try{if("email"in t){let{email:c,options:h}=t,f=null,g=null;this.flowType==="pkce"&&([f,g]=yield bn(this.storage,this.storageKey));let{error:_}=yield B(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(r=h?.data)!==null&&r!==void 0?r:{},create_user:(s=h?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:f,code_challenge_method:g},redirectTo:h?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:_})}if("phone"in t){let{phone:c,options:h}=t,{data:f,error:g}=yield B(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(i=h?.data)!==null&&i!==void 0?i:{},create_user:(a=h?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},channel:(u=h?.channel)!==null&&u!==void 0?u:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:f?.message_id},error:g})}throw new gn("You must provide either an email or phone number.")}catch(c){if(yield Te(this.storage,`${this.storageKey}-code-verifier`),j(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}})}verifyOtp(t){return p(this,null,function*(){var r,s;try{let i,a;"options"in t&&(i=(r=t.options)===null||r===void 0?void 0:r.redirectTo,a=(s=t.options)===null||s===void 0?void 0:s.captchaToken);let{data:u,error:c}=yield B(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:a}}),redirectTo:i,xform:$e});if(c)throw c;if(!u)throw new Error("An error occurred on token verification.");let h=u.session,f=u.user;return h?.access_token&&(yield this._saveSession(h),yield this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),this._returnResult({data:{user:f,session:h},error:null})}catch(i){if(j(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}signInWithSSO(t){return p(this,null,function*(){var r,s,i,a,u;try{let c=null,h=null;this.flowType==="pkce"&&([c,h]=yield bn(this.storage,this.storageKey));let f=yield B(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(s=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=t?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:c,code_challenge_method:h}),headers:this.headers,xform:Pp});return!((a=f.data)===null||a===void 0)&&a.url&&ye()&&!(!((u=t.options)===null||u===void 0)&&u.skipBrowserRedirect)&&window.location.assign(f.data.url),this._returnResult(f)}catch(c){if(yield Te(this.storage,`${this.storageKey}-code-verifier`),j(c))return this._returnResult({data:null,error:c});throw c}})}reauthenticate(){return p(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return p(this,null,function*(){try{return yield this._useSession(t=>p(this,null,function*(){let{data:{session:r},error:s}=t;if(s)throw s;if(!r)throw new Ie;let{error:i}=yield B(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:i})}))}catch(t){if(j(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}})}resend(t){return p(this,null,function*(){try{let r=`${this.url}/resend`;if("email"in t){let{email:s,type:i,options:a}=t,{error:u}=yield B(this.fetch,"POST",r,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},redirectTo:a?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:u})}else if("phone"in t){let{phone:s,type:i,options:a}=t,{data:u,error:c}=yield B(this.fetch,"POST",r,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:a?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:u?.message_id},error:c})}throw new gn("You must provide either an email or phone number and a type")}catch(r){if(j(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}getSession(){return p(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){return this._useSession(r=>p(this,null,function*(){return r}))}))})}_acquireLock(t,r){return p(this,null,function*(){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){let s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=p(this,null,function*(){return yield s,yield r()});return this.pendingInLock.push(p(this,null,function*(){try{yield i}catch{}})),i}return yield this.lock(`lock:${this.storageKey}`,t,()=>p(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let s=r();for(this.pendingInLock.push(p(this,null,function*(){try{yield s}catch{}})),yield s;this.pendingInLock.length;){let i=[...this.pendingInLock];yield Promise.all(i),this.pendingInLock.splice(0,i.length)}return yield s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(t){return p(this,null,function*(){this._debug("#_useSession","begin");try{let r=yield this.__loadSession();return yield t(r)}finally{this._debug("#_useSession","end")}})}__loadSession(){return p(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null,r=yield qt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!t)return{data:{session:null},error:null};let s=t.expires_at?t.expires_at*1e3-Date.now()<go:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",t.expires_at),!s){if(this.userStorage){let u=yield qt(this.userStorage,this.storageKey+"-user");u?.user?t.user=u.user:t.user=Io()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){let u={value:this.suppressGetSessionWarning};t.user=Sp(t.user,u),u.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}let{data:i,error:a}=yield this._callRefreshToken(t.refresh_token);return a?this._returnResult({data:{session:null},error:a}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}})}getUser(t){return p(this,null,function*(){if(t)return yield this._getUser(t);yield this.initializePromise;let r=yield this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){return yield this._getUser()}));return r.data.user&&(this.suppressGetSessionWarning=!0),r})}_getUser(t){return p(this,null,function*(){try{return t?yield B(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:ut}):yield this._useSession(r=>p(this,null,function*(){var s,i,a;let{data:u,error:c}=r;if(c)throw c;return!(!((s=u.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ie}:yield B(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(i=u.session)===null||i===void 0?void 0:i.access_token)!==null&&a!==void 0?a:void 0,xform:ut})}))}catch(r){if(j(r))return wo(r)&&(yield this._removeSession(),yield Te(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}})}updateUser(s){return p(this,arguments,function*(t,r={}){return yield this.initializePromise,yield this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){return yield this._updateUser(t,r)}))})}_updateUser(s){return p(this,arguments,function*(t,r={}){try{return yield this._useSession(i=>p(this,null,function*(){let{data:a,error:u}=i;if(u)throw u;if(!a.session)throw new Ie;let c=a.session,h=null,f=null;this.flowType==="pkce"&&t.email!=null&&([h,f]=yield bn(this.storage,this.storageKey));let{data:g,error:_}=yield B(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:h,code_challenge_method:f}),jwt:c.access_token,xform:ut});if(_)throw _;return c.user=g.user,yield this._saveSession(c),yield this._notifyAllSubscribers("USER_UPDATED",c),this._returnResult({data:{user:c.user},error:null})}))}catch(i){if(yield Te(this.storage,`${this.storageKey}-code-verifier`),j(i))return this._returnResult({data:{user:null},error:i});throw i}})}setSession(t){return p(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){return yield this._setSession(t)}))})}_setSession(t){return p(this,null,function*(){try{if(!t.access_token||!t.refresh_token)throw new Ie;let r=Date.now()/1e3,s=r,i=!0,a=null,{payload:u}=Ts(t.access_token);if(u.exp&&(s=u.exp,i=s<=r),i){let{data:c,error:h}=yield this._callRefreshToken(t.refresh_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!c)return{data:{user:null,session:null},error:null};a=c}else{let{data:c,error:h}=yield this._getUser(t.access_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});a={access_token:t.access_token,refresh_token:t.refresh_token,user:c.user,token_type:"bearer",expires_in:s-r,expires_at:s},yield this._saveSession(a),yield this._notifyAllSubscribers("SIGNED_IN",a)}return this._returnResult({data:{user:a.user,session:a},error:null})}catch(r){if(j(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}})}refreshSession(t){return p(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){return yield this._refreshSession(t)}))})}_refreshSession(t){return p(this,null,function*(){try{return yield this._useSession(r=>p(this,null,function*(){var s;if(!t){let{data:u,error:c}=r;if(c)throw c;t=(s=u.session)!==null&&s!==void 0?s:void 0}if(!t?.refresh_token)throw new Ie;let{data:i,error:a}=yield this._callRefreshToken(t.refresh_token);return a?this._returnResult({data:{user:null,session:null},error:a}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})}))}catch(r){if(j(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}_getSessionFromURL(t,r){return p(this,null,function*(){try{if(!ye())throw new _n("No browser detected.");if(t.error||t.error_description||t.error_code)throw new _n(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new ws("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new _n("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new ws("No code detected.");let{data:V,error:D}=yield this._exchangeCodeForSession(t.code);if(D)throw D;let z=new URL(window.location.href);return z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",z.toString()),{data:{session:V.session,redirectType:null},error:null}}let{provider_token:s,provider_refresh_token:i,access_token:a,refresh_token:u,expires_in:c,expires_at:h,token_type:f}=t;if(!a||!c||!u||!f)throw new _n("No session defined in URL");let g=Math.round(Date.now()/1e3),_=parseInt(c),w=g+_;h&&(w=parseInt(h));let A=w-g;A*1e3<=mn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${A}s, should have been closer to ${_}s`);let R=w-_;g-R>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",R,w,g):g-R<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",R,w,g);let{data:k,error:O}=yield this._getUser(a);if(O)throw O;let M={provider_token:s,provider_refresh_token:i,access_token:a,expires_in:_,expires_at:w,refresh_token:u,token_type:f,user:k.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:M,redirectType:t.type},error:null})}catch(s){if(j(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}})}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}_isPKCECallback(t){return p(this,null,function*(){let r=yield qt(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)})}signOut(){return p(this,arguments,function*(t={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){return yield this._signOut(t)}))})}_signOut(){return p(this,arguments,function*({scope:t}={scope:"global"}){return yield this._useSession(r=>p(this,null,function*(){var s;let{data:i,error:a}=r;if(a&&!wo(a))return this._returnResult({error:a});let u=(s=i.session)===null||s===void 0?void 0:s.access_token;if(u){let{error:c}=yield this.admin.signOut(u,t);if(c&&!(hp(c)&&(c.status===404||c.status===401||c.status===403)||wo(c)))return this._returnResult({error:c})}return t!=="others"&&(yield this._removeSession(),yield Te(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})}))})}onAuthStateChange(t){let r=yp(),s={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,s),p(this,null,function*(){yield this.initializePromise,yield this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){this._emitInitialSession(r)}))}),{data:{subscription:s}}}_emitInitialSession(t){return p(this,null,function*(){return yield this._useSession(r=>p(this,null,function*(){var s,i;try{let{data:{session:a},error:u}=r;if(u)throw u;yield(s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",a),this._debug("INITIAL_SESSION","callback id",t,"session",a)}catch(a){yield(i=this.stateChangeEmitters.get(t))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",t,"error",a),console.error(a)}}))})}resetPasswordForEmail(s){return p(this,arguments,function*(t,r={}){let i=null,a=null;this.flowType==="pkce"&&([i,a]=yield bn(this.storage,this.storageKey,!0));try{return yield B(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:i,code_challenge_method:a,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(u){if(yield Te(this.storage,`${this.storageKey}-code-verifier`),j(u))return this._returnResult({data:null,error:u});throw u}})}getUserIdentities(){return p(this,null,function*(){var t;try{let{data:r,error:s}=yield this.getUser();if(s)throw s;return this._returnResult({data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(r){if(j(r))return this._returnResult({data:null,error:r});throw r}})}linkIdentity(t){return p(this,null,function*(){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)})}linkIdentityOAuth(t){return p(this,null,function*(){var r;try{let{data:s,error:i}=yield this._useSession(a=>p(this,null,function*(){var u,c,h,f,g;let{data:_,error:w}=a;if(w)throw w;let A=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(u=t.options)===null||u===void 0?void 0:u.redirectTo,scopes:(c=t.options)===null||c===void 0?void 0:c.scopes,queryParams:(h=t.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return yield B(this.fetch,"GET",A,{headers:this.headers,jwt:(g=(f=_.session)===null||f===void 0?void 0:f.access_token)!==null&&g!==void 0?g:void 0})}));if(i)throw i;return ye()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(s?.url),this._returnResult({data:{provider:t.provider,url:s?.url},error:null})}catch(s){if(j(s))return this._returnResult({data:{provider:t.provider,url:null},error:s});throw s}})}linkIdentityIdToken(t){return p(this,null,function*(){return yield this._useSession(r=>p(this,null,function*(){var s;try{let{error:i,data:{session:a}}=r;if(i)throw i;let{options:u,provider:c,token:h,access_token:f,nonce:g}=t,_=yield B(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=a?.access_token)!==null&&s!==void 0?s:void 0,body:{provider:c,id_token:h,access_token:f,nonce:g,link_identity:!0,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:$e}),{data:w,error:A}=_;return A?this._returnResult({data:{user:null,session:null},error:A}):!w||!w.session||!w.user?this._returnResult({data:{user:null,session:null},error:new Tt}):(w.session&&(yield this._saveSession(w.session),yield this._notifyAllSubscribers("USER_UPDATED",w.session)),this._returnResult({data:w,error:A}))}catch(i){if(yield Te(this.storage,`${this.storageKey}-code-verifier`),j(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}))})}unlinkIdentity(t){return p(this,null,function*(){try{return yield this._useSession(r=>p(this,null,function*(){var s,i;let{data:a,error:u}=r;if(u)throw u;return yield B(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(i=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})}))}catch(r){if(j(r))return this._returnResult({data:null,error:r});throw r}})}_refreshAccessToken(t){return p(this,null,function*(){let r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{let s=Date.now();return yield Tp(i=>p(this,null,function*(){return i>0&&(yield bp(200*Math.pow(2,i-1))),this._debug(r,"refreshing attempt",i),yield B(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:$e})}),(i,a)=>{let u=200*Math.pow(2,i);return a&&vo(a)&&Date.now()+u-s<mn})}catch(s){if(this._debug(r,"error",s),j(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(r,"end")}})}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}_handleProviderSignIn(t,r){return p(this,null,function*(){let s=yield this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",s),ye()&&!r.skipBrowserRedirect&&window.location.assign(s),{data:{provider:t,url:s},error:null}})}_recoverAndRefresh(){return p(this,null,function*(){var t,r;let s="#_recoverAndRefresh()";this._debug(s,"begin");try{let i=yield qt(this.storage,this.storageKey);if(i&&this.userStorage){let u=yield qt(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:i.user},yield vn(this.userStorage,this.storageKey+"-user",u)),i.user=(t=u?.user)!==null&&t!==void 0?t:Io()}else if(i&&!i.user&&!i.user){let u=yield qt(this.storage,this.storageKey+"-user");u&&u?.user?(i.user=u.user,yield Te(this.storage,this.storageKey+"-user"),yield vn(this.storage,this.storageKey,i)):i.user=Io()}if(this._debug(s,"session from storage",i),!this._isValidSession(i)){this._debug(s,"session is not valid"),i!==null&&(yield this._removeSession());return}let a=((r=i.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<go;if(this._debug(s,`session has${a?"":" not"} expired with margin of ${go}s`),a){if(this.autoRefreshToken&&i.refresh_token){let{error:u}=yield this._callRefreshToken(i.refresh_token);u&&(console.error(u),vo(u)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",u),yield this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{let{data:u,error:c}=yield this._getUser(i.access_token);!c&&u?.user?(i.user=u.user,yield this._saveSession(i),yield this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(s,"error getting user data, skipping SIGNED_IN notification",u)}else yield this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(s,"error",i),console.error(i);return}finally{this._debug(s,"end")}})}_callRefreshToken(t){return p(this,null,function*(){var r,s;if(!t)throw new Ie;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let i=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new bs;let{data:a,error:u}=yield this._refreshAccessToken(t);if(u)throw u;if(!a.session)throw new Ie;yield this._saveSession(a.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);let c={data:a.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(a){if(this._debug(i,"error",a),j(a)){let u={data:null,error:a};return vo(a)||(yield this._removeSession()),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(u),u}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(a),a}finally{this.refreshingDeferred=null,this._debug(i,"end")}})}_notifyAllSubscribers(t,r,s=!0){return p(this,null,function*(){let i=`#_notifyAllSubscribers(${t})`;this._debug(i,"begin",r,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:t,session:r});let a=[],u=Array.from(this.stateChangeEmitters.values()).map(c=>p(this,null,function*(){try{yield c.callback(t,r)}catch(h){a.push(h)}}));if(yield Promise.all(u),a.length>0){for(let c=0;c<a.length;c+=1)console.error(a[c]);throw a[0]}}finally{this._debug(i,"end")}})}_saveSession(t){return p(this,null,function*(){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,yield Te(this.storage,`${this.storageKey}-code-verifier`);let r=Object.assign({},t),s=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&r.user&&(yield vn(this.userStorage,this.storageKey+"-user",{user:r.user}));let i=Object.assign({},r);delete i.user;let a=xc(i);yield vn(this.storage,this.storageKey,a)}else{let i=xc(r);yield vn(this.storage,this.storageKey,i)}})}_removeSession(){return p(this,null,function*(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,yield Te(this.storage,this.storageKey),yield Te(this.storage,this.storageKey+"-code-verifier"),yield Te(this.storage,this.storageKey+"-user"),this.userStorage&&(yield Te(this.userStorage,this.storageKey+"-user")),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&ye()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}_startAutoRefresh(){return p(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let t=setInterval(()=>this._autoRefreshTokenTick(),mn);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);let r=setTimeout(()=>p(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0);this.autoRefreshTickTimeout=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r)})}_stopAutoRefresh(){return p(this,null,function*(){this._debug("#_stopAutoRefresh()");let t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);let r=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,r&&clearTimeout(r)})}startAutoRefresh(){return p(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return p(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return p(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>p(this,null,function*(){try{let t=Date.now();try{return yield this._useSession(r=>p(this,null,function*(){let{data:{session:s}}=r;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let i=Math.floor((s.expires_at*1e3-t)/mn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${mn}ms, refresh threshold is ${mo} ticks`),i<=mo&&(yield this._callRefreshToken(s.refresh_token))}))}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(t){if(t.isAcquireTimeout||t instanceof Es)this._debug("auto refresh token tick lock not available");else throw t}})}_handleVisibilityChange(){return p(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!ye()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>p(this,null,function*(){try{yield this._onVisibilityChanged(!1)}catch(t){this._debug("#visibilityChangedCallback","error",t)}}),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}})}_onVisibilityChanged(t){return p(this,null,function*(){let r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(yield this.initializePromise,yield this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}yield this._recoverAndRefresh()})))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(t,r,s){return p(this,null,function*(){let i=[`provider=${encodeURIComponent(r)}`];if(s?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){let[a,u]=yield bn(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(u)}`});i.push(c.toString())}if(s?.queryParams){let a=new URLSearchParams(s.queryParams);i.push(a.toString())}return s?.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${t}?${i.join("&")}`})}_unenroll(t){return p(this,null,function*(){try{return yield this._useSession(r=>p(this,null,function*(){var s;let{data:i,error:a}=r;return a?this._returnResult({data:null,error:a}):yield B(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token})}))}catch(r){if(j(r))return this._returnResult({data:null,error:r});throw r}})}_enroll(t){return p(this,null,function*(){try{return yield this._useSession(r=>p(this,null,function*(){var s,i;let{data:a,error:u}=r;if(u)return this._returnResult({data:null,error:u});let c=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:h,error:f}=yield B(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(s=a?.session)===null||s===void 0?void 0:s.access_token});return f?this._returnResult({data:null,error:f}):(t.factorType==="totp"&&h.type==="totp"&&(!((i=h?.totp)===null||i===void 0)&&i.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),this._returnResult({data:h,error:null}))}))}catch(r){if(j(r))return this._returnResult({data:null,error:r});throw r}})}_verify(t){return p(this,null,function*(){return this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){try{return yield this._useSession(r=>p(this,null,function*(){var s;let{data:i,error:a}=r;if(a)return this._returnResult({data:null,error:a});let u=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?Mp(t.webauthn.credential_response):jp(t.webauthn.credential_response)})}:{code:t.code}),{data:c,error:h}=yield B(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:u,headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return h?this._returnResult({data:null,error:h}):(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),this._returnResult({data:c,error:h}))}))}catch(r){if(j(r))return this._returnResult({data:null,error:r});throw r}}))})}_challenge(t){return p(this,null,function*(){return this._acquireLock(this.lockAcquireTimeout,()=>p(this,null,function*(){try{return yield this._useSession(r=>p(this,null,function*(){var s;let{data:i,error:a}=r;if(a)return this._returnResult({data:null,error:a});let u=yield B(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});if(u.error)return u;let{data:c}=u;if(c.type!=="webauthn")return{data:c,error:null};switch(c.webauthn.type){case"create":return{data:Object.assign(Object.assign({},c),{webauthn:Object.assign(Object.assign({},c.webauthn),{credential_options:Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:Up(c.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},c),{webauthn:Object.assign(Object.assign({},c.webauthn),{credential_options:Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:Fp(c.webauthn.credential_options.publicKey)})})}),error:null}}}))}catch(r){if(j(r))return this._returnResult({data:null,error:r});throw r}}))})}_challengeAndVerify(t){return p(this,null,function*(){let{data:r,error:s}=yield this._challenge({factorId:t.factorId});return s?this._returnResult({data:null,error:s}):yield this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})})}_listFactors(){return p(this,null,function*(){var t;let{data:{user:r},error:s}=yield this.getUser();if(s)return{data:null,error:s};let i={all:[],phone:[],totp:[],webauthn:[]};for(let a of(t=r?.factors)!==null&&t!==void 0?t:[])i.all.push(a),a.status==="verified"&&i[a.factor_type].push(a);return{data:i,error:null}})}_getAuthenticatorAssuranceLevel(t){return p(this,null,function*(){var r,s,i,a;if(t)try{let{payload:A}=Ts(t),R=null;A.aal&&(R=A.aal);let k=R,{data:{user:O},error:M}=yield this.getUser(t);if(M)return this._returnResult({data:null,error:M});((s=(r=O?.factors)===null||r===void 0?void 0:r.filter(z=>z.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(k="aal2");let D=A.amr||[];return{data:{currentLevel:R,nextLevel:k,currentAuthenticationMethods:D},error:null}}catch(A){if(j(A))return this._returnResult({data:null,error:A});throw A}let{data:{session:u},error:c}=yield this.getSession();if(c)return this._returnResult({data:null,error:c});if(!u)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:h}=Ts(u.access_token),f=null;h.aal&&(f=h.aal);let g=f;((a=(i=u.user.factors)===null||i===void 0?void 0:i.filter(A=>A.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(g="aal2");let w=h.amr||[];return{data:{currentLevel:f,nextLevel:g,currentAuthenticationMethods:w},error:null}})}_getAuthorizationDetails(t){return p(this,null,function*(){try{return yield this._useSession(r=>p(this,null,function*(){let{data:{session:s},error:i}=r;return i?this._returnResult({data:null,error:i}):s?yield B(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:s.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new Ie})}))}catch(r){if(j(r))return this._returnResult({data:null,error:r});throw r}})}_approveAuthorization(t,r){return p(this,null,function*(){try{return yield this._useSession(s=>p(this,null,function*(){let{data:{session:i},error:a}=s;if(a)return this._returnResult({data:null,error:a});if(!i)return this._returnResult({data:null,error:new Ie});let u=yield B(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:c=>({data:c,error:null})});return u.data&&u.data.redirect_url&&ye()&&!r?.skipBrowserRedirect&&window.location.assign(u.data.redirect_url),u}))}catch(s){if(j(s))return this._returnResult({data:null,error:s});throw s}})}_denyAuthorization(t,r){return p(this,null,function*(){try{return yield this._useSession(s=>p(this,null,function*(){let{data:{session:i},error:a}=s;if(a)return this._returnResult({data:null,error:a});if(!i)return this._returnResult({data:null,error:new Ie});let u=yield B(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:c=>({data:c,error:null})});return u.data&&u.data.redirect_url&&ye()&&!r?.skipBrowserRedirect&&window.location.assign(u.data.redirect_url),u}))}catch(s){if(j(s))return this._returnResult({data:null,error:s});throw s}})}_listOAuthGrants(){return p(this,null,function*(){try{return yield this._useSession(t=>p(this,null,function*(){let{data:{session:r},error:s}=t;return s?this._returnResult({data:null,error:s}):r?yield B(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Ie})}))}catch(t){if(j(t))return this._returnResult({data:null,error:t});throw t}})}_revokeOAuthGrant(t){return p(this,null,function*(){try{return yield this._useSession(r=>p(this,null,function*(){let{data:{session:s},error:i}=r;return i?this._returnResult({data:null,error:i}):s?(yield B(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ie})}))}catch(r){if(j(r))return this._returnResult({data:null,error:r});throw r}})}fetchJwk(s){return p(this,arguments,function*(t,r={keys:[]}){let i=r.keys.find(h=>h.kid===t);if(i)return i;let a=Date.now();if(i=this.jwks.keys.find(h=>h.kid===t),i&&this.jwks_cached_at+lp>a)return i;let{data:u,error:c}=yield B(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=a,i=u.keys.find(h=>h.kid===t),!i)?null:i})}getClaims(s){return p(this,arguments,function*(t,r={}){try{let i=t;if(!i){let{data:R,error:k}=yield this.getSession();if(k||!R.session)return this._returnResult({data:null,error:k});i=R.session.access_token}let{header:a,payload:u,signature:c,raw:{header:h,payload:f}}=Ts(i);r?.allowExpired||Ip(u.exp);let g=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:yield this.fetchJwk(a.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!g){let{error:R}=yield this.getUser(i);if(R)throw R;return{data:{claims:u,header:a,signature:c},error:null}}let _=Ap(a.alg),w=yield crypto.subtle.importKey("jwk",g,_,!0,["verify"]);if(!(yield crypto.subtle.verify(_,w,c,gp(`${h}.${f}`))))throw new yn("Invalid JWT signature");return{data:{claims:u,header:a,signature:c},error:null}}catch(i){if(j(i))return this._returnResult({data:null,error:i});throw i}})}}return n.nextInstanceID={},n})(),Fc=gw;var _w=Fc,Mc=_w;var yw="2.95.3",Is="";typeof Deno<"u"?Is="deno":typeof document<"u"?Is="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Is="react-native":Is="node";var ww={"X-Client-Info":`supabase-js-${Is}/${yw}`},vw={headers:ww},bw={schema:"public"},Tw={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ew={};function As(n){"@babel/helpers - typeof";return As=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},As(n)}function Iw(n,e){if(As(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(As(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Aw(n){var e=Iw(n,"string");return As(e)=="symbol"?e:e+""}function Sw(n,e,t){return(e=Aw(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Bp(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function le(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Bp(Object(t),!0).forEach(function(r){Sw(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Bp(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var Rw=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),Pw=()=>Headers,kw=(n,e,t)=>{let r=Rw(t),s=Pw();return(i,a)=>p(null,null,function*(){var u;let c=(u=yield e())!==null&&u!==void 0?u:n,h=new s(a?.headers);return h.has("apikey")||h.set("apikey",n),h.has("Authorization")||h.set("Authorization",`Bearer ${c}`),r(i,le(le({},a),{},{headers:h}))})};function xw(n){return n.endsWith("/")?n:n+"/"}function Cw(n,e){var t,r;let{db:s,auth:i,realtime:a,global:u}=n,{db:c,auth:h,realtime:f,global:g}=e,_={db:le(le({},c),s),auth:le(le({},h),i),realtime:le(le({},f),a),storage:{},global:le(le(le({},g),u),{},{headers:le(le({},(t=g?.headers)!==null&&t!==void 0?t:{}),(r=u?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>p(null,null,function*(){return""})};return n.accessToken?_.accessToken=n.accessToken:delete _.accessToken,_}function Ow(n){let e=n?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(xw(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Nw=class extends Mc{constructor(n){super(n)}},Dw=class{constructor(n,e,t){var r,s;this.supabaseUrl=n,this.supabaseKey=e;let i=Ow(n);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);let a=`sb-${i.hostname.split(".")[0]}-auth-token`,u={db:bw,realtime:Ew,auth:le(le({},Tw),{},{storageKey:a}),global:vw},c=Cw(t??{},u);if(this.storageKey=(r=c.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(s=c.global.headers)!==null&&s!==void 0?s:{},c.accessToken)this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(f,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}});else{var h;this.auth=this._initSupabaseAuthClient((h=c.auth)!==null&&h!==void 0?h:{},this.headers,c.global.fetch)}this.fetch=kw(e,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(le({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(f=>this.realtime.setAuth(f)).catch(f=>console.warn("Failed to set initial Realtime auth token:",f)),this.rest=new zf(new URL("rest/v1",i).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch,timeout:c.db.timeout,urlLengthLimit:c.db.urlLengthLimit}),this.storage=new ip(this.storageUrl.href,this.headers,this.fetch,t?.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new os(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,e={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,e,t)}channel(n,e={config:{}}){return this.realtime.channel(n,e)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return p(this,null,function*(){var n=this,e,t;if(n.accessToken)return yield n.accessToken();let{data:r}=yield n.auth.getSession();return(e=(t=r.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:n.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:e,detectSessionInUrl:t,storage:r,userStorage:s,storageKey:i,flowType:a,lock:u,debug:c,throwOnError:h},f,g){let _={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Nw({url:this.authUrl.href,headers:le(le({},_),f),storageKey:i,autoRefreshToken:n,persistSession:e,detectSessionInUrl:t,storage:r,userStorage:s,flowType:a,lock:u,debug:c,throwOnError:h,fetch:g,hasCustomAuthorizationHeader:Object.keys(this.headers).some(w=>w.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new ds(this.realtimeUrl.href,le(le({},n),{},{params:le(le({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,e)=>{this._handleTokenChanged(n,"CLIENT",e?.access_token)})}_handleTokenChanged(n,e,t){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}},$p=(n,e,t)=>new Dw(n,e,t);function Vw(){if(typeof window<"u")return!1;let n=globalThis.process;if(!n)return!1;let e=n.version;if(e==null)return!1;let t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}Vw()&&console.warn("\u26A0\uFE0F  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");var Lw=ss.supabase.url,Uw=ss.supabase.anonKey,jc=class{data={};get length(){return Object.keys(this.data).length}clear(){this.data={},typeof window<"u"&&window.localStorage.clear()}getItem(e){return this.data[e]||(typeof window<"u"?window.localStorage.getItem(e):null)}key(e){return Object.keys(this.data)[e]||null}removeItem(e){delete this.data[e],typeof window<"u"&&window.localStorage.removeItem(e)}setItem(e,t){this.data[e]=t,typeof window<"u"&&window.localStorage.setItem(e,t)}},Fw=typeof window<"u"?new jc:void 0,Sn=$p(Lw,Uw,{auth:{persistSession:!0,detectSessionInUrl:!0,storage:Fw,autoRefreshToken:!0,flowType:"implicit"}});var zp=class n{bucketName="project-media";uploadAndGetURL(e,t,r){let i=`${Date.now()}_${t.name}`,a=`${e}/${r}/${i}`;return console.log("\u{1F4E4} Iniciando carga:",{projectId:e,fileName:i,filePath:a,bucketName:this.bucketName}),De(Sn.storage.from(this.bucketName).upload(a,t,{cacheControl:"3600",upsert:!1})).pipe(zl(u=>{console.log("\u{1F4E6} Respuesta del servidor:",u)}),Ue(u=>{if(u.error)throw console.error("\u274C Error de carga:",u.error),new Error(`Error de carga: ${u.error.message}`);if(!u.data)throw new Error("No se recibi\xF3 confirmaci\xF3n del servidor");console.log("\u2705 Archivo subido:",u.data);let{data:c}=Sn.storage.from(this.bucketName).getPublicUrl(a);return console.log("\u{1F517} URL p\xFAblica generada:",c.publicUrl),c.publicUrl}))}getPublicURL(e,t,r){let s=`${e}/${r}/${t}`,{data:i}=Sn.storage.from(this.bucketName).getPublicUrl(s);return i.publicUrl}deleteFile(e,t,r){let s=`${e}/${r}/${t}`;return De(Sn.storage.from(this.bucketName).remove([s])).pipe(Ue(i=>{if(i.error)throw new Error(i.error.message)}))}listProjectFiles(e){return De(Sn.storage.from(this.bucketName).list(e)).pipe(Ue(t=>{if(t.error)throw new Error(t.error.message);return t.data||[]}))}listCategoryFiles(e,t){return De(Sn.storage.from(this.bucketName).list(`${e}/${t}`)).pipe(Ue(r=>{if(r.error)throw new Error(r.error.message);return r.data||[]}))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Bs({token:n,factory:n.\u0275fac,providedIn:"root"})};export{Mf as a,zp as b};
