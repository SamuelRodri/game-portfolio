import{a as I,b as c,c as L,d as M,e as E,g as O,h as P,m as k,n as U,o as N,p as A}from"./chunk-A7EF4OIB.js";import{Ba as y,H as s,J as d,K as _,O as u,R as m,T as a,U as o,V as g,Y as h,Z as f,Za as S,_ as p,aa as l,ca as v,ra as C,ta as w,w as b,x,za as F}from"./chunk-4OJD6OJG.js";function T(n,r){n&1&&(a(0,"small"),l(1," Email inv\xE1lido "),o())}function q(n,r){n&1&&(a(0,"small"),l(1," La contrase\xF1a es requerida "),o())}function V(n,r){if(n&1){let t=h();a(0,"form",7),f("ngSubmit",function(){b(t);let i=p();return x(i.onLogin())}),a(1,"div",8)(2,"label",9),l(3,"Email"),o(),g(4,"input",10),u(5,T,2,0,"small",11),o(),a(6,"div",8)(7,"label",12),l(8,"Contrase\xF1a"),o(),g(9,"input",13),u(10,q,2,0,"small",11),o(),a(11,"button",14),l(12," Iniciar Sesi\xF3n "),o()()}if(n&2){let t,e,i=p();m("formGroup",i.loginForm),s(5),m("ngIf",((t=i.loginForm.get("email"))==null?null:t.invalid)&&((t=i.loginForm.get("email"))==null?null:t.touched)),s(5),m("ngIf",((e=i.loginForm.get("password"))==null?null:e.invalid)&&((e=i.loginForm.get("password"))==null?null:e.touched)),s(),m("disabled",i.loginForm.invalid)}}function z(n,r){n&1&&(a(0,"div",15)(1,"p"),l(2,"Iniciando sesi\xF3n..."),o()())}function G(n,r){if(n&1&&(a(0,"div",16),l(1),o()),n&2){let t=p();s(),v(" ",t.error," ")}}var R=class n{constructor(r,t,e,i){this.fb=r;this.authService=t;this.router=e;this.route=i}loginForm;isLoading=!1;error=null;returnUrl="/";ngOnInit(){this.loginForm=this.fb.group({email:["",[c.required,c.email]],password:["",[c.required,c.minLength(6)]]}),this.route.queryParams.subscribe(r=>{if(r.returnUrl)this.returnUrl=r.returnUrl;else{let t=document.referrer;if(t&&t.includes(window.location.hostname))try{let e=new URL(t),i=e.pathname+e.search;i.includes("/login")||(this.returnUrl=i)}catch{this.returnUrl="/"}else this.returnUrl="/"}})}onLogin(){if(this.loginForm.invalid)return;this.isLoading=!0,this.error=null;let{email:r,password:t}=this.loginForm.value;this.authService.login(r,t).subscribe({next:e=>{this.isLoading=!1,e&&setTimeout(()=>{this.router.navigateByUrl(this.returnUrl)},500)},error:e=>{this.isLoading=!1,console.error("Error de autenticaci\xF3n:",e),e.message.includes("user-not-found")?this.error="Email no encontrado en Firebase":e.message.includes("wrong-password")?this.error="Contrase\xF1a incorrecta":e.message.includes("too-many-requests")?this.error="Demasiados intentos. Intenta m\xE1s tarde":this.error=`Error: ${e.message}`}})}goBack(){this.router.navigate(["/"])}static \u0275fac=function(t){return new(t||n)(d(U),d(S),d(y),d(F))};static \u0275cmp=_({type:n,selectors:[["app-login"]],decls:11,vars:3,consts:[[1,"login-container"],[1,"login-box"],[1,"subtitle"],[3,"formGroup","ngSubmit",4,"ngIf"],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],[1,"btn-back",3,"click"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","email"],["type","email","id","email","formControlName","email","placeholder","tu@email.com","required",""],[4,"ngIf"],["for","password"],["type","password","id","password","formControlName","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","required",""],["type","submit",1,"btn-login",3,"disabled"],[1,"loading"],[1,"error"]],template:function(t,e){t&1&&(a(0,"div",0)(1,"div",1)(2,"h1"),l(3,"Panel de Administraci\xF3n"),o(),a(4,"p",2),l(5,"Acceso restringido"),o(),u(6,V,13,4,"form",3)(7,z,3,0,"div",4)(8,G,2,1,"div",5),a(9,"button",6),f("click",function(){return e.goBack()}),l(10," \u2190 Volver "),o()()()),t&2&&(s(6),m("ngIf",!e.isLoading),s(),m("ngIf",e.isLoading),s(),m("ngIf",e.error))},dependencies:[w,C,N,E,I,L,M,k,A,O,P],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(135deg,#667eea,#764ba2);padding:20px}.login-box[_ngcontent-%COMP%]{background:#fff;padding:40px;border-radius:10px;box-shadow:0 10px 40px #0000004d;width:100%;max-width:400px}h1[_ngcontent-%COMP%]{text-align:center;color:#333;margin-bottom:10px}.subtitle[_ngcontent-%COMP%]{text-align:center;color:#999;margin-bottom:30px;font-size:14px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;color:#333;font-weight:500}input[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;font-size:14px;box-sizing:border-box}input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea;box-shadow:0 0 5px #667eea4d}small[_ngcontent-%COMP%]{display:block;color:#e74c3c;margin-top:5px;font-size:12px}.btn-login[_ngcontent-%COMP%]{width:100%;padding:12px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:5px;font-size:16px;font-weight:600;cursor:pointer;transition:transform .2s}.btn-login[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px)}.btn-login[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-back[_ngcontent-%COMP%]{width:100%;margin-top:15px;padding:10px;background:#f0f0f0;color:#333;border:none;border-radius:5px;cursor:pointer;font-size:14px}.btn-back[_ngcontent-%COMP%]:hover{background:#e0e0e0}.loading[_ngcontent-%COMP%]{text-align:center;color:#667eea}.error[_ngcontent-%COMP%]{background:#fee;color:#c33;padding:10px;border-radius:5px;margin-bottom:20px;font-size:14px;border-left:4px solid #c33}"]})};export{R as LoginComponent};
