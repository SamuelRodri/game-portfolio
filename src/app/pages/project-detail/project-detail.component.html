<section *ngIf="project; else notFound" class="project-detail">
  <div class="content">
    <div class="main">
      <!-- Imagen/Video principal con navegaci칩n -->
      <div class="media-wrap">
        <ng-container *ngIf="getAllMedia().length > 0 && canDisplayImage(getAllMedia()[selectedImageIndex]); else placeholder">
          <!-- Video -->
          <video *ngIf="isVideo(getAllMedia()[selectedImageIndex]);"
                 [src]="getMediaUrl(getAllMedia()[selectedImageIndex])"
                 controls
                 controlsList="nodownload"
                 class="main-video">
          </video>
          <!-- Imagen -->
          <img *ngIf="!isVideo(getAllMedia()[selectedImageIndex])"
               [src]="getMediaUrl(getAllMedia()[selectedImageIndex])"
               [alt]="project.title"
               (error)="onImageError(getMediaUrl(getAllMedia()[selectedImageIndex]))"
               class="main-image">
        </ng-container>
        <ng-template #placeholder>
          <div class="placeholder">
            <svg viewBox="0 0 600 360" xmlns="http://www.w3.org/2000/svg">
              <rect width="100%" height="100%" fill="#eef3fb" />
              <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#a3b3d1" font-size="28">No hay contenido</text>
            </svg>
          </div>
        </ng-template>

        <!-- Botones de navegaci칩n -->
        <div *ngIf="getAllMedia().length > 1" class="media-controls">
          <button class="control-btn prev-btn" (click)="previousMedia()" aria-label="Anterior">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 19l-7-7 7-7"></path>
            </svg>
          </button>
          <span class="media-counter">{{ selectedImageIndex + 1 }} / {{ getAllMedia().length }}</span>
          <button class="control-btn next-btn" (click)="nextMedia()" aria-label="Siguiente">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 19l7-7-7-7"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Carrusel de miniaturas (Im치genes + Video) -->
      <div *ngIf="getAllMedia().length > 1" class="thumbnails-carousel">
        <div class="thumbnails-container">
          <button *ngFor="let media of getAllMedia(); let i = index"
                  class="thumbnail"
                  [class.active]="selectedImageIndex === i"
                  (click)="selectImage(i)"
                  [attr.aria-label]="(isVideo(media) ? 'Ver video ' : 'Ver imagen ') + (i + 1)">
            <div class="thumbnail-content">
              <img *ngIf="canDisplayImage(media) && !isVideo(media)"
                   [src]="getMediaUrl(media)"
                   [alt]="'Miniatura ' + (i + 1)"
                   (error)="onImageError(getMediaUrl(media))">
              <div *ngIf="isVideo(media)" class="video-thumbnail">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                  <rect width="100" height="100" fill="#333"/>
                  <polygon points="35,25 35,75 75,50" fill="#fff"/>
                </svg>
              </div>
            </div>
          </button>
        </div>
      </div>

      <div class="header-with-status">
        <h1 class="title">{{ project.title }}</h1>
        <span class="status-badge" [ngClass]="'status-' + project.status">{{ getStatusLabel(project.status) }}</span>
      </div>
      <p class="description">{{ project.longDescription }}</p>
    </div>

    <aside class="sidebar">
      <div class="meta"><strong>Motor:</strong> {{ project.engine }}</div>
      <div class="meta"><strong>Lenguaje:</strong> {{ project.language }}</div>
      <div class="meta"><strong>A침o:</strong> {{ project.year }}</div>
      <div class="meta"><strong>Etiquetas:</strong>
        <div class="tags">
          <span class="tag" *ngFor="let t of project.tags">{{ t }}</span>
        </div>
      </div>
      <div class="links">
        <a *ngIf="project.links.github" [href]="project.links.github" target="_blank" rel="noopener">GitHub</a>
        <a *ngIf="project.links.itch" [href]="project.links.itch" target="_blank" rel="noopener">Itch</a>
        <a *ngIf="project.links.demo" [href]="project.links.demo" target="_blank" rel="noopener">Demo</a>
      </div>
    </aside>
  </div>
</section>

<ng-template #notFound>
  <p>Proyecto no encontrado</p>
</ng-template>
